var Zo=Object.defineProperty;var Da=t=>{throw TypeError(t)};var Xo=(t,e,r)=>e in t?Zo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Nt=(t,e,r)=>Xo(t,typeof e!="symbol"?e+"":e,r),Cn=(t,e,r)=>e.has(t)||Da("Cannot "+r);var C=(t,e,r)=>(Cn(t,e,"read from private field"),r?r.call(t):e.get(t)),ke=(t,e,r)=>e.has(t)?Da("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),de=(t,e,r,s)=>(Cn(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),Be=(t,e,r)=>(Cn(t,e,"access private method"),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const Fn=!1;var zs=Array.isArray,Qo=Array.prototype.indexOf,_n=Array.from,Ci=Object.defineProperty,vr=Object.getOwnPropertyDescriptor,Ii=Object.getOwnPropertyDescriptors,el=Object.prototype,tl=Array.prototype,pa=Object.getPrototypeOf,Na=Object.isExtensible;function Zr(t){return typeof t=="function"}const _t=()=>{};function rl(t){return t()}function an(t){for(var e=0;e<t.length;e++)t[e]()}function ji(){var t,e,r=new Promise((s,n)=>{t=s,e=n});return{promise:r,resolve:t,reject:e}}function sl(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const r=[];for(const s of t)if(r.push(s),r.length===e)break;return r}const st=2,ga=4,wn=8,nl=1<<24,Kt=16,ir=32,Lr=64,yn=128,Mt=512,et=1024,dt=2048,Dt=4096,bt=8192,rr=16384,bn=32768,_r=65536,Ua=1<<17,ma=1<<18,fs=1<<19,Pi=1<<20,er=1<<25,Dr=32768,zn=1<<21,_a=1<<22,pr=1<<23,Vt=Symbol("$state"),$i=Symbol("legacy props"),al=Symbol(""),ts=new class extends Error{constructor(){super(...arguments);Nt(this,"name","StaleReactionError");Nt(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},il=11;function kn(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ol(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ll(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function cl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ul(t){throw new Error("https://svelte.dev/e/effect_orphan")}function hl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function dl(t){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function fl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function vl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function pl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function gl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ml(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const _l=1,wl=2,Mi=4,yl=8,bl=16,kl=1,Sl=2,El=4,Tl=8,Ol=16,Al=4,xl=1,Rl=2,nt=Symbol(),Cl="http://www.w3.org/1999/xhtml";function Il(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function jl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Di(t){return t===this.v}function Ni(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Ui(t){return!Ni(t,this.v)}let vs=!1,Pl=!1;function $l(){vs=!0}let xe=null;function ls(t){xe=t}function Ue(t,e=!1,r){xe={p:xe,i:!1,c:null,e:null,s:t,x:null,l:vs&&!e?{s:null,u:null,$:[]}:null}}function Le(t){var e=xe,r=e.e;if(r!==null){e.e=null;for(var s of r)ro(s)}return e.i=!0,xe=e.p,{}}function Vs(){return!vs||xe!==null&&xe.l===null}let Tr=[];function Li(){var t=Tr;Tr=[],an(t)}function qr(t){if(Tr.length===0&&!As){var e=Tr;queueMicrotask(()=>{e===Tr&&Li()})}Tr.push(t)}function Ml(){for(;Tr.length>0;)Li()}function qi(t){var e=Se;if(e===null)return ye.f|=pr,t;if(e.f&bn)cs(t,e);else{if(!(e.f&yn))throw t;e.b.error(t)}}function cs(t,e){for(;e!==null;){if(e.f&yn)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const Ys=new Set;let ge=null,Os=null,Ve=null,At=[],Sn=null,Vn=!1,As=!1;var ns,as,Ar,xr,qs,is,os,tt,Wn,ks,Kn,Bi,Fi;const pn=class pn{constructor(){ke(this,tt);Nt(this,"committed",!1);Nt(this,"current",new Map);Nt(this,"previous",new Map);ke(this,ns,new Set);ke(this,as,new Set);ke(this,Ar,0);ke(this,xr,0);ke(this,qs,null);ke(this,is,new Set);ke(this,os,new Set);Nt(this,"skipped_effects",new Set);Nt(this,"is_fork",!1)}is_deferred(){return this.is_fork||C(this,xr)>0}process(e){var s;At=[],Os=null,this.apply();var r={parent:null,effect:null,effects:[],render_effects:[]};for(const n of e)Be(this,tt,Wn).call(this,n,r);this.is_fork||Be(this,tt,Bi).call(this),this.is_deferred()?(Be(this,tt,ks).call(this,r.effects),Be(this,tt,ks).call(this,r.render_effects)):(Os=this,ge=null,La(r.render_effects),La(r.effects),Os=null,(s=C(this,qs))==null||s.resolve()),Ve=null}capture(e,r){this.previous.has(e)||this.previous.set(e,r),e.f&pr||(this.current.set(e,e.v),Ve==null||Ve.set(e,e.v))}activate(){ge=this,this.apply()}deactivate(){ge===this&&(ge=null,Ve=null)}flush(){if(this.activate(),At.length>0){if(zi(),ge!==null&&ge!==this)return}else C(this,Ar)===0&&this.process([]);this.deactivate()}discard(){for(const e of C(this,as))e(this);C(this,as).clear()}increment(e){de(this,Ar,C(this,Ar)+1),e&&de(this,xr,C(this,xr)+1)}decrement(e){de(this,Ar,C(this,Ar)-1),e&&de(this,xr,C(this,xr)-1),this.revive()}revive(){for(const e of C(this,is))C(this,os).delete(e),rt(e,dt),Nr(e);for(const e of C(this,os))rt(e,Dt),Nr(e);this.flush()}oncommit(e){C(this,ns).add(e)}ondiscard(e){C(this,as).add(e)}settled(){return(C(this,qs)??de(this,qs,ji())).promise}static ensure(){if(ge===null){const e=ge=new pn;Ys.add(ge),As||pn.enqueue(()=>{ge===e&&e.flush()})}return ge}static enqueue(e){qr(e)}apply(){}};ns=new WeakMap,as=new WeakMap,Ar=new WeakMap,xr=new WeakMap,qs=new WeakMap,is=new WeakMap,os=new WeakMap,tt=new WeakSet,Wn=function(e,r){var h;e.f^=et;for(var s=e.first;s!==null;){var n=s.f,a=(n&(ir|Lr))!==0,i=a&&(n&et)!==0,o=i||(n&bt)!==0||this.skipped_effects.has(s);if(s.f&yn&&((h=s.b)!=null&&h.is_pending())&&(r={parent:r,effect:s,effects:[],render_effects:[]}),!o&&s.fn!==null){a?s.f^=et:n&ga?r.effects.push(s):gs(s)&&(s.f&Kt&&C(this,is).add(s),ds(s));var l=s.first;if(l!==null){s=l;continue}}var c=s.parent;for(s=s.next;s===null&&c!==null;)c===r.effect&&(Be(this,tt,ks).call(this,r.effects),Be(this,tt,ks).call(this,r.render_effects),r=r.parent),s=c.next,c=c.parent}},ks=function(e){for(const r of e)r.f&dt?C(this,is).add(r):r.f&Dt&&C(this,os).add(r),Be(this,tt,Kn).call(this,r.deps),rt(r,et)},Kn=function(e){if(e!==null)for(const r of e)!(r.f&st)||!(r.f&Dr)||(r.f^=Dr,Be(this,tt,Kn).call(this,r.deps))},Bi=function(){if(C(this,xr)===0){for(const e of C(this,ns))e();C(this,ns).clear()}C(this,Ar)===0&&Be(this,tt,Fi).call(this)},Fi=function(){var a;if(Ys.size>1){this.previous.clear();var e=Ve,r=!0,s={parent:null,effect:null,effects:[],render_effects:[]};for(const i of Ys){if(i===this){r=!1;continue}const o=[];for(const[c,h]of this.current){if(i.current.has(c))if(r&&h!==i.current.get(c))i.current.set(c,h);else continue;o.push(c)}if(o.length===0)continue;const l=[...i.current.keys()].filter(c=>!this.current.has(c));if(l.length>0){var n=At;At=[];const c=new Set,h=new Map;for(const p of o)Vi(p,l,c,h);if(At.length>0){ge=i,i.apply();for(const p of At)Be(a=i,tt,Wn).call(a,p,s);i.deactivate()}At=n}}ge=null,Ve=e}this.committed=!0,Ys.delete(this)};let tr=pn;function Dl(t){var e=As;As=!0;try{for(var r;;){if(Ml(),At.length===0&&(ge==null||ge.flush(),At.length===0))return Sn=null,r;zi()}}finally{As=e}}function zi(){var t=$r;Vn=!0;var e=null;try{var r=0;for(cn(!0);At.length>0;){var s=tr.ensure();if(r++>1e3){var n,a;Nl()}s.process(At),gr.clear()}}finally{Vn=!1,cn(t),Sn=null}}function Nl(){try{hl()}catch(t){cs(t,Sn)}}let It=null;function La(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var s=t[r++];if(!(s.f&(rr|bt))&&gs(s)&&(It=new Set,ds(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?ao(s):s.fn=null),(It==null?void 0:It.size)>0)){gr.clear();for(const n of It){if(n.f&(rr|bt))continue;const a=[n];let i=n.parent;for(;i!==null;)It.has(i)&&(It.delete(i),a.push(i)),i=i.parent;for(let o=a.length-1;o>=0;o--){const l=a[o];l.f&(rr|bt)||ds(l)}}It.clear()}}It=null}}function Vi(t,e,r,s){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const n of t.reactions){const a=n.f;a&st?Vi(n,e,r,s):a&(_a|Kt)&&!(a&dt)&&Wi(n,e,s)&&(rt(n,dt),Nr(n))}}function Wi(t,e,r){const s=r.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const n of t.deps){if(e.includes(n))return!0;if(n.f&st&&Wi(n,e,r))return r.set(n,!0),!0}return r.set(t,!1),!1}function Nr(t){for(var e=Sn=t;e.parent!==null;){e=e.parent;var r=e.f;if(Vn&&e===Se&&r&Kt&&!(r&ma))return;if(r&(Lr|ir)){if(!(r&et))return;e.f^=et}}At.push(e)}function Ul(t){let e=0,r=Ur(0),s;return()=>{js()&&(u(r),Hs(()=>(e===0&&(s=Gt(()=>t(()=>xs(r)))),e+=1,()=>{qr(()=>{e-=1,e===0&&(s==null||s(),s=void 0,xs(r))})})))}}var Ll=_r|fs|yn;function ql(t,e,r){new Bl(t,e,r)}var Et,Tt,va,Ut,Rr,Lt,Ot,ct,qt,Xt,hr,Cr,dr,Ir,fr,gn,Ze,Fl,zl,Hn,sn,nn,Gn;class Bl{constructor(e,r,s){ke(this,Ze);Nt(this,"parent");ke(this,Et,!1);ke(this,Tt);ke(this,va,null);ke(this,Ut);ke(this,Rr);ke(this,Lt);ke(this,Ot,null);ke(this,ct,null);ke(this,qt,null);ke(this,Xt,null);ke(this,hr,null);ke(this,Cr,0);ke(this,dr,0);ke(this,Ir,!1);ke(this,fr,null);ke(this,gn,Ul(()=>(de(this,fr,Ur(C(this,Cr))),()=>{de(this,fr,null)})));de(this,Tt,e),de(this,Ut,r),de(this,Rr,s),this.parent=Se.b,de(this,Et,!!C(this,Ut).pending),de(this,Lt,Gs(()=>{Se.b=this;{var n=Be(this,Ze,Hn).call(this);try{de(this,Ot,xt(()=>s(n)))}catch(a){this.error(a)}C(this,dr)>0?Be(this,Ze,nn).call(this):de(this,Et,!1)}return()=>{var a;(a=C(this,hr))==null||a.remove()}},Ll))}is_pending(){return C(this,Et)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!C(this,Ut).pending}update_pending_count(e){Be(this,Ze,Gn).call(this,e),de(this,Cr,C(this,Cr)+e),C(this,fr)&&hs(C(this,fr),C(this,Cr))}get_effect_pending(){return C(this,gn).call(this),u(C(this,fr))}error(e){var r=C(this,Ut).onerror;let s=C(this,Ut).failed;if(C(this,Ir)||!r&&!s)throw e;C(this,Ot)&&(ht(C(this,Ot)),de(this,Ot,null)),C(this,ct)&&(ht(C(this,ct)),de(this,ct,null)),C(this,qt)&&(ht(C(this,qt)),de(this,qt,null));var n=!1,a=!1;const i=()=>{if(n){jl();return}n=!0,a&&ml(),tr.ensure(),de(this,Cr,0),C(this,qt)!==null&&Pr(C(this,qt),()=>{de(this,qt,null)}),de(this,Et,this.has_pending_snippet()),de(this,Ot,Be(this,Ze,sn).call(this,()=>(de(this,Ir,!1),xt(()=>C(this,Rr).call(this,C(this,Tt)))))),C(this,dr)>0?Be(this,Ze,nn).call(this):de(this,Et,!1)};var o=ye;try{ut(null),a=!0,r==null||r(e,i),a=!1}catch(l){cs(l,C(this,Lt)&&C(this,Lt).parent)}finally{ut(o)}s&&qr(()=>{de(this,qt,Be(this,Ze,sn).call(this,()=>{tr.ensure(),de(this,Ir,!0);try{return xt(()=>{s(C(this,Tt),()=>e,()=>i)})}catch(l){return cs(l,C(this,Lt).parent),null}finally{de(this,Ir,!1)}}))})}}Et=new WeakMap,Tt=new WeakMap,va=new WeakMap,Ut=new WeakMap,Rr=new WeakMap,Lt=new WeakMap,Ot=new WeakMap,ct=new WeakMap,qt=new WeakMap,Xt=new WeakMap,hr=new WeakMap,Cr=new WeakMap,dr=new WeakMap,Ir=new WeakMap,fr=new WeakMap,gn=new WeakMap,Ze=new WeakSet,Fl=function(){try{de(this,Ot,xt(()=>C(this,Rr).call(this,C(this,Tt))))}catch(e){this.error(e)}de(this,Et,!1)},zl=function(){const e=C(this,Ut).pending;e&&(de(this,ct,xt(()=>e(C(this,Tt)))),tr.enqueue(()=>{var r=Be(this,Ze,Hn).call(this);de(this,Ot,Be(this,Ze,sn).call(this,()=>(tr.ensure(),xt(()=>C(this,Rr).call(this,r))))),C(this,dr)>0?Be(this,Ze,nn).call(this):(Pr(C(this,ct),()=>{de(this,ct,null)}),de(this,Et,!1))}))},Hn=function(){var e=C(this,Tt);return C(this,Et)&&(de(this,hr,sr()),C(this,Tt).before(C(this,hr)),e=C(this,hr)),e},sn=function(e){var r=Se,s=ye,n=xe;Wt(C(this,Lt)),ut(C(this,Lt)),ls(C(this,Lt).ctx);try{return e()}catch(a){return qi(a),null}finally{Wt(r),ut(s),ls(n)}},nn=function(){const e=C(this,Ut).pending;C(this,Ot)!==null&&(de(this,Xt,document.createDocumentFragment()),C(this,Xt).append(C(this,hr)),lo(C(this,Ot),C(this,Xt))),C(this,ct)===null&&de(this,ct,xt(()=>e(C(this,Tt))))},Gn=function(e){var r;if(!this.has_pending_snippet()){this.parent&&Be(r=this.parent,Ze,Gn).call(r,e);return}de(this,dr,C(this,dr)+e),C(this,dr)===0&&(de(this,Et,!1),C(this,ct)&&Pr(C(this,ct),()=>{de(this,ct,null)}),C(this,Xt)&&(C(this,Tt).before(C(this,Xt)),de(this,Xt,null)))};function Vl(t,e,r,s){const n=Vs()?Ws:wa;if(r.length===0&&t.length===0){s(e.map(n));return}var a=ge,i=Se,o=Wl();function l(){Promise.all(r.map(c=>Kl(c))).then(c=>{o();try{s([...e.map(n),...c])}catch(h){i.f&rr||cs(h,i)}a==null||a.deactivate(),on()}).catch(c=>{cs(c,i)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{a==null||a.deactivate(),on()}}):l()}function Wl(){var t=Se,e=ye,r=xe,s=ge;return function(a=!0){Wt(t),ut(e),ls(r),a&&(s==null||s.activate())}}function on(){Wt(null),ut(null),ls(null)}function Ws(t){var e=st|dt,r=ye!==null&&ye.f&st?ye:null;return Se!==null&&(Se.f|=fs),{ctx:xe,deps:null,effects:null,equals:Di,f:e,fn:t,reactions:null,rv:0,v:nt,wv:0,parent:r??Se,ac:null}}function Kl(t,e){let r=Se;r===null&&ol();var s=r.b,n=void 0,a=Ur(nt),i=!ye,o=new Map;return nc(()=>{var d;var l=ji();n=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===ge&&c.committed&&c.deactivate(),on()})}catch(f){l.reject(f),on()}var c=ge;if(i){var h=!s.is_pending();s.update_pending_count(1),c.increment(h),(d=o.get(c))==null||d.reject(ts),o.delete(c),o.set(c,l)}const p=(f,g=void 0)=>{if(c.activate(),g)g!==ts&&(a.f|=pr,hs(a,g));else{a.f&pr&&(a.f^=pr),hs(a,f);for(const[w,v]of o){if(o.delete(w),w===c)break;v.reject(ts)}}i&&(s.update_pending_count(-1),c.decrement(h))};l.promise.then(p,f=>p(null,f||"unknown"))}),En(()=>{for(const l of o.values())l.reject(ts)}),new Promise(l=>{function c(h){function p(){h===n?l(a):c(n)}h.then(p,p)}c(n)})}function us(t){const e=Ws(t);return co(e),e}function wa(t){const e=Ws(t);return e.equals=Ui,e}function Ki(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)ht(e[r])}}function Hl(t){for(var e=t.parent;e!==null;){if(!(e.f&st))return e.f&rr?null:e;e=e.parent}return null}function ya(t){var e,r=Se;Wt(Hl(t));try{t.f&=~Dr,Ki(t),e=vo(t)}finally{Wt(r)}return e}function Hi(t){var e=ya(t);if(t.equals(e)||(ge!=null&&ge.is_fork||(t.v=e),t.wv=ho()),!Br)if(Ve!==null)(js()||ge!=null&&ge.is_fork)&&Ve.set(t,e);else{var r=t.f&Mt?et:Dt;rt(t,r)}}let Jn=new Set;const gr=new Map;let Gi=!1;function Ur(t,e){var r={f:0,v:t,reactions:null,equals:Di,rv:0,wv:0};return r}function T(t,e){const r=Ur(t);return co(r),r}function mr(t,e=!1,r=!0){var n;const s=Ur(t);return e||(s.equals=Ui),vs&&r&&xe!==null&&xe.l!==null&&((n=xe.l).s??(n.s=[])).push(s),s}function m(t,e,r=!1){ye!==null&&(!Ft||ye.f&Ua)&&Vs()&&ye.f&(st|Kt|_a|Ua)&&!(ot!=null&&ot.includes(t))&&gl();let s=r?H(e):e;return hs(t,s)}function hs(t,e){if(!t.equals(e)){var r=t.v;Br?gr.set(t,e):gr.set(t,r),t.v=e;var s=tr.ensure();s.capture(t,r),t.f&st&&(t.f&dt&&ya(t),rt(t,t.f&Mt?et:Dt)),t.wv=ho(),Ji(t,dt),Vs()&&Se!==null&&Se.f&et&&!(Se.f&(ir|Lr))&&(St===null?oc([t]):St.push(t)),!s.is_fork&&Jn.size>0&&!Gi&&Gl()}return e}function Gl(){Gi=!1;var t=$r;cn(!0);const e=Array.from(Jn);try{for(const r of e)r.f&et&&rt(r,Dt),gs(r)&&ds(r)}finally{cn(t)}Jn.clear()}function qa(t,e=1){var r=u(t),s=e===1?r++:r--;return m(t,r),s}function xs(t){m(t,t.v+1)}function Ji(t,e){var r=t.reactions;if(r!==null)for(var s=Vs(),n=r.length,a=0;a<n;a++){var i=r[a],o=i.f;if(!(!s&&i===Se)){var l=(o&dt)===0;if(l&&rt(i,e),o&st){var c=i;Ve==null||Ve.delete(c),o&Dr||(o&Mt&&(i.f|=Dr),Ji(c,Dt))}else l&&(o&Kt&&It!==null&&It.add(i),Nr(i))}}}function H(t){if(typeof t!="object"||t===null||Vt in t)return t;const e=pa(t);if(e!==el&&e!==tl)return t;var r=new Map,s=zs(t),n=T(0),a=Mr,i=o=>{if(Mr===a)return o();var l=ye,c=Mr;ut(null),Wa(a);var h=o();return ut(l),Wa(c),h};return s&&r.set("length",T(t.length)),new Proxy(t,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&vl();var h=r.get(l);return h===void 0?h=i(()=>{var p=T(c.value);return r.set(l,p),p}):m(h,c.value,!0),!0},deleteProperty(o,l){var c=r.get(l);if(c===void 0){if(l in o){const h=i(()=>T(nt));r.set(l,h),xs(n)}}else m(c,nt),xs(n);return!0},get(o,l,c){var f;if(l===Vt)return t;var h=r.get(l),p=l in o;if(h===void 0&&(!p||(f=vr(o,l))!=null&&f.writable)&&(h=i(()=>{var g=H(p?o[l]:nt),w=T(g);return w}),r.set(l,h)),h!==void 0){var d=u(h);return d===nt?void 0:d}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var h=r.get(l);h&&(c.value=u(h))}else if(c===void 0){var p=r.get(l),d=p==null?void 0:p.v;if(p!==void 0&&d!==nt)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(o,l){var d;if(l===Vt)return!0;var c=r.get(l),h=c!==void 0&&c.v!==nt||Reflect.has(o,l);if(c!==void 0||Se!==null&&(!h||(d=vr(o,l))!=null&&d.writable)){c===void 0&&(c=i(()=>{var f=h?H(o[l]):nt,g=T(f);return g}),r.set(l,c));var p=u(c);if(p===nt)return!1}return h},set(o,l,c,h){var O;var p=r.get(l),d=l in o;if(s&&l==="length")for(var f=c;f<p.v;f+=1){var g=r.get(f+"");g!==void 0?m(g,nt):f in o&&(g=i(()=>T(nt)),r.set(f+"",g))}if(p===void 0)(!d||(O=vr(o,l))!=null&&O.writable)&&(p=i(()=>T(void 0)),m(p,H(c)),r.set(l,p));else{d=p.v!==nt;var w=i(()=>H(c));m(p,w)}var v=Reflect.getOwnPropertyDescriptor(o,l);if(v!=null&&v.set&&v.set.call(h,c),!d){if(s&&typeof l=="string"){var k=r.get("length"),R=Number(l);Number.isInteger(R)&&R>=k.v&&m(k,R+1)}xs(n)}return!0},ownKeys(o){u(n);var l=Reflect.ownKeys(o).filter(p=>{var d=r.get(p);return d===void 0||d.v!==nt});for(var[c,h]of r)h.v!==nt&&!(c in o)&&l.push(c);return l},setPrototypeOf(){pl()}})}function Ba(t){try{if(t!==null&&typeof t=="object"&&Vt in t)return t[Vt]}catch{}return t}function Jl(t,e){return Object.is(Ba(t),Ba(e))}var Fa,Yi,Zi,Xi;function Yl(){if(Fa===void 0){Fa=window,Yi=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;Zi=vr(e,"firstChild").get,Xi=vr(e,"nextSibling").get,Na(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Na(r)&&(r.__t=void 0)}}function sr(t=""){return document.createTextNode(t)}function ln(t){return Zi.call(t)}function Ks(t){return Xi.call(t)}function b(t,e){return ln(t)}function Re(t,e=!1){{var r=ln(t);return r instanceof Comment&&r.data===""?Ks(r):r}}function y(t,e=1,r=!1){let s=t;for(;e--;)s=Ks(s);return s}function Zl(t){t.textContent=""}function Qi(){return!1}let za=!1;function Xl(){za||(za=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const r of t.target.elements)(e=r.__on_r)==null||e.call(r)})},{capture:!0}))}function ps(t){var e=ye,r=Se;ut(null),Wt(null);try{return t()}finally{ut(e),Wt(r)}}function eo(t,e,r,s=r){t.addEventListener(e,()=>ps(r));const n=t.__on_r;n?t.__on_r=()=>{n(),s(!0)}:t.__on_r=()=>s(!0),Xl()}function to(t){Se===null&&(ye===null&&ul(),cl()),Br&&ll()}function Ql(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function Ht(t,e,r){var s=Se;s!==null&&s.f&bt&&(t|=bt);var n={ctx:xe,deps:null,nodes:null,f:t|dt|Mt,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{ds(n),n.f|=bn}catch(o){throw ht(n),o}else e!==null&&Nr(n);var a=n;if(r&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&!(a.f&fs)&&(a=a.first,t&Kt&&t&_r&&a!==null&&(a.f|=_r)),a!==null&&(a.parent=s,s!==null&&Ql(a,s),ye!==null&&ye.f&st&&!(t&Lr))){var i=ye;(i.effects??(i.effects=[])).push(a)}return n}function js(){return ye!==null&&!Ft}function En(t){const e=Ht(wn,null,!1);return rt(e,et),e.teardown=t,e}function Oe(t){to();var e=Se.f,r=!ye&&(e&ir)!==0&&(e&bn)===0;if(r){var s=xe;(s.e??(s.e=[])).push(t)}else return ro(t)}function ro(t){return Ht(ga|Pi,t,!1)}function ec(t){return to(),Ht(wn|Pi,t,!0)}function tc(t){tr.ensure();const e=Ht(Lr|fs,t,!0);return(r={})=>new Promise(s=>{r.outro?Pr(e,()=>{ht(e),s(void 0)}):(ht(e),s(void 0))})}function ba(t){return Ht(ga,t,!1)}function rc(t,e){var r=xe,s={effect:null,ran:!1,deps:t};r.l.$.push(s),s.effect=Hs(()=>{t(),!s.ran&&(s.ran=!0,Gt(e))})}function sc(){var t=xe;Hs(()=>{for(var e of t.l.$){e.deps();var r=e.effect;r.f&et&&rt(r,Dt),gs(r)&&ds(r),e.ran=!1}})}function nc(t){return Ht(_a|fs,t,!0)}function Hs(t,e=0){return Ht(wn|e,t,!0)}function fe(t,e=[],r=[],s=[]){Vl(s,e,r,n=>{Ht(wn,()=>t(...n.map(u)),!0)})}function Gs(t,e=0){var r=Ht(Kt|e,t,!0);return r}function xt(t){return Ht(ir|fs,t,!0)}function so(t){var e=t.teardown;if(e!==null){const r=Br,s=ye;Va(!0),ut(null);try{e.call(null)}finally{Va(r),ut(s)}}}function no(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const n=r.ac;n!==null&&ps(()=>{n.abort(ts)});var s=r.next;r.f&Lr?r.parent=null:ht(r,e),r=s}}function ac(t){for(var e=t.first;e!==null;){var r=e.next;e.f&ir||ht(e),e=r}}function ht(t,e=!0){var r=!1;(e||t.f&ma)&&t.nodes!==null&&t.nodes.end!==null&&(ic(t.nodes.start,t.nodes.end),r=!0),no(t,e&&!r),un(t,0),rt(t,rr);var s=t.nodes&&t.nodes.t;if(s!==null)for(const a of s)a.stop();so(t);var n=t.parent;n!==null&&n.first!==null&&ao(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function ic(t,e){for(;t!==null;){var r=t===e?null:Ks(t);t.remove(),t=r}}function ao(t){var e=t.parent,r=t.prev,s=t.next;r!==null&&(r.next=s),s!==null&&(s.prev=r),e!==null&&(e.first===t&&(e.first=s),e.last===t&&(e.last=r))}function Pr(t,e,r=!0){var s=[];io(t,s,!0);var n=()=>{r&&ht(t),e&&e()},a=s.length;if(a>0){var i=()=>--a||n();for(var o of s)o.out(i)}else n()}function io(t,e,r){if(!(t.f&bt)){t.f^=bt;var s=t.nodes&&t.nodes.t;if(s!==null)for(const o of s)(o.is_global||r)&&e.push(o);for(var n=t.first;n!==null;){var a=n.next,i=(n.f&_r)!==0||(n.f&ir)!==0&&(t.f&Kt)!==0;io(n,e,i?r:!1),n=a}}}function ka(t){oo(t,!0)}function oo(t,e){if(t.f&bt){t.f^=bt,t.f&et||(rt(t,dt),Nr(t));for(var r=t.first;r!==null;){var s=r.next,n=(r.f&_r)!==0||(r.f&ir)!==0;oo(r,n?e:!1),r=s}var a=t.nodes&&t.nodes.t;if(a!==null)for(const i of a)(i.is_global||e)&&i.in()}}function lo(t,e){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end;r!==null;){var n=r===s?null:Ks(r);e.append(r),r=n}}let $r=!1;function cn(t){$r=t}let Br=!1;function Va(t){Br=t}let ye=null,Ft=!1;function ut(t){ye=t}let Se=null;function Wt(t){Se=t}let ot=null;function co(t){ye!==null&&(ot===null?ot=[t]:ot.push(t))}let it=null,pt=0,St=null;function oc(t){St=t}let uo=1,Ps=0,Mr=Ps;function Wa(t){Mr=t}function ho(){return++uo}function gs(t){var e=t.f;if(e&dt)return!0;if(e&st&&(t.f&=~Dr),e&Dt){var r=t.deps;if(r!==null)for(var s=r.length,n=0;n<s;n++){var a=r[n];if(gs(a)&&Hi(a),a.wv>t.wv)return!0}e&Mt&&Ve===null&&rt(t,et)}return!1}function fo(t,e,r=!0){var s=t.reactions;if(s!==null&&!(ot!=null&&ot.includes(t)))for(var n=0;n<s.length;n++){var a=s[n];a.f&st?fo(a,e,!1):e===a&&(r?rt(a,dt):a.f&et&&rt(a,Dt),Nr(a))}}function vo(t){var g;var e=it,r=pt,s=St,n=ye,a=ot,i=xe,o=Ft,l=Mr,c=t.f;it=null,pt=0,St=null,ye=c&(ir|Lr)?null:t,ot=null,ls(t.ctx),Ft=!1,Mr=++Ps,t.ac!==null&&(ps(()=>{t.ac.abort(ts)}),t.ac=null);try{t.f|=zn;var h=t.fn,p=h(),d=t.deps;if(it!==null){var f;if(un(t,pt),d!==null&&pt>0)for(d.length=pt+it.length,f=0;f<it.length;f++)d[pt+f]=it[f];else t.deps=d=it;if(js()&&t.f&Mt)for(f=pt;f<d.length;f++)((g=d[f]).reactions??(g.reactions=[])).push(t)}else d!==null&&pt<d.length&&(un(t,pt),d.length=pt);if(Vs()&&St!==null&&!Ft&&d!==null&&!(t.f&(st|Dt|dt)))for(f=0;f<St.length;f++)fo(St[f],t);return n!==null&&n!==t&&(Ps++,St!==null&&(s===null?s=St:s.push(...St))),t.f&pr&&(t.f^=pr),p}catch(w){return qi(w)}finally{t.f^=zn,it=e,pt=r,St=s,ye=n,ot=a,ls(i),Ft=o,Mr=l}}function lc(t,e){let r=e.reactions;if(r!==null){var s=Qo.call(r,t);if(s!==-1){var n=r.length-1;n===0?r=e.reactions=null:(r[s]=r[n],r.pop())}}r===null&&e.f&st&&(it===null||!it.includes(e))&&(rt(e,Dt),e.f&Mt&&(e.f^=Mt,e.f&=~Dr),Ki(e),un(e,0))}function un(t,e){var r=t.deps;if(r!==null)for(var s=e;s<r.length;s++)lc(t,r[s])}function ds(t){var e=t.f;if(!(e&rr)){rt(t,et);var r=Se,s=$r;Se=t,$r=!0;try{e&(Kt|nl)?ac(t):no(t),so(t);var n=vo(t);t.teardown=typeof n=="function"?n:null,t.wv=uo;var a;Fn&&Pl&&t.f&dt&&t.deps}finally{$r=s,Se=r}}}async function po(){await Promise.resolve(),Dl()}function u(t){var e=t.f,r=(e&st)!==0;if(ye!==null&&!Ft){var s=Se!==null&&(Se.f&rr)!==0;if(!s&&!(ot!=null&&ot.includes(t))){var n=ye.deps;if(ye.f&zn)t.rv<Ps&&(t.rv=Ps,it===null&&n!==null&&n[pt]===t?pt++:it===null?it=[t]:it.includes(t)||it.push(t));else{(ye.deps??(ye.deps=[])).push(t);var a=t.reactions;a===null?t.reactions=[ye]:a.includes(ye)||a.push(ye)}}}if(Br){if(gr.has(t))return gr.get(t);if(r){var i=t,o=i.v;return(!(i.f&et)&&i.reactions!==null||mo(i))&&(o=ya(i)),gr.set(i,o),o}}else r&&(!(Ve!=null&&Ve.has(t))||ge!=null&&ge.is_fork&&!js())&&(i=t,gs(i)&&Hi(i),$r&&js()&&!(i.f&Mt)&&go(i));if(Ve!=null&&Ve.has(t))return Ve.get(t);if(t.f&pr)throw t.v;return t.v}function go(t){if(t.deps!==null){t.f^=Mt;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),e.f&st&&!(e.f&Mt)&&go(e)}}function mo(t){if(t.v===nt)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(gr.has(e)||e.f&st&&mo(e))return!0;return!1}function Gt(t){var e=Ft;try{return Ft=!0,t()}finally{Ft=e}}const cc=-7169;function rt(t,e){t.f=t.f&cc|e}function _o(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Vt in t)Yn(t);else if(!Array.isArray(t))for(let e in t){const r=t[e];typeof r=="object"&&r&&Vt in r&&Yn(r)}}}function Yn(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let s in t)try{Yn(t[s],e)}catch{}const r=pa(t);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const s=Ii(r);for(let n in s){const a=s[n].get;if(a)try{a.call(t)}catch{}}}}}const uc=["touchstart","touchmove"];function hc(t){return uc.includes(t)}const wo=new Set,Zn=new Set;function dc(t,e,r,s={}){function n(a){if(s.capture||Ss.call(e,a),!a.cancelBubble)return ps(()=>r==null?void 0:r.call(this,a))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?qr(()=>{e.addEventListener(t,n,s)}):e.addEventListener(t,n,s),n}function lt(t,e,r,s,n){var a={capture:s,passive:n},i=dc(t,e,r,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&En(()=>{e.removeEventListener(t,i,a)})}function Fr(t){for(var e=0;e<t.length;e++)wo.add(t[e]);for(var r of Zn)r(t)}let Ka=null;function Ss(t){var v;var e=this,r=e.ownerDocument,s=t.type,n=((v=t.composedPath)==null?void 0:v.call(t))||[],a=n[0]||t.target;Ka=t;var i=0,o=Ka===t&&t.__root;if(o){var l=n.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=n.indexOf(e);if(c===-1)return;l<=c&&(i=l)}if(a=n[i]||t.target,a!==e){Ci(t,"currentTarget",{configurable:!0,get(){return a||r}});var h=ye,p=Se;ut(null),Wt(null);try{for(var d,f=[];a!==null;){var g=a.assignedSlot||a.parentNode||a.host||null;try{var w=a["__"+s];w!=null&&(!a.disabled||t.target===a)&&w.call(a,t)}catch(k){d?f.push(k):d=k}if(t.cancelBubble||g===e||g===null)break;a=g}if(d){for(let k of f)queueMicrotask(()=>{throw k});throw d}}finally{t.__root=e,delete t.currentTarget,ut(h),Wt(p)}}}function fc(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Xn(t,e){var r=Se;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function z(t,e){var r=(e&xl)!==0,s=(e&Rl)!==0,n,a=!t.startsWith("<!>");return()=>{n===void 0&&(n=fc(a?t:"<!>"+t),r||(n=ln(n)));var i=s||Yi?document.importNode(n,!0):n.cloneNode(!0);if(r){var o=ln(i),l=i.lastChild;Xn(o,l)}else Xn(i,i);return i}}function Sa(t){return()=>vc(t())}function vc(t){const e=t.nodeType===il,r=t.tagName==="SCRIPT"?[t]:t.querySelectorAll("script"),s=Se;for(const a of r){const i=document.createElement("script");for(var n of a.attributes)i.setAttribute(n.name,n.value);i.textContent=a.textContent,(e?t.firstChild===a:t===a)&&(s.nodes.start=i),(e?t.lastChild===a:t===a)&&(s.nodes.end=i),a.replaceWith(i)}return t}function nr(){var t=document.createDocumentFragment(),e=document.createComment(""),r=sr();return t.append(e,r),Xn(e,r),t}function N(t,e){t!==null&&t.before(e)}let Qn=!0;function re(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=r,t.nodeValue=r+"")}function pc(t,e){return gc(t,e)}const zr=new Map;function gc(t,{target:e,anchor:r,props:s={},events:n,context:a,intro:i=!0}){Yl();var o=new Set,l=p=>{for(var d=0;d<p.length;d++){var f=p[d];if(!o.has(f)){o.add(f);var g=hc(f);e.addEventListener(f,Ss,{passive:g});var w=zr.get(f);w===void 0?(document.addEventListener(f,Ss,{passive:g}),zr.set(f,1)):zr.set(f,w+1)}}};l(_n(wo)),Zn.add(l);var c=void 0,h=tc(()=>{var p=r??e.appendChild(sr());return ql(p,{pending:()=>{}},d=>{if(a){Ue({});var f=xe;f.c=a}n&&(s.$$events=n),Qn=i,c=t(d,s)||{},Qn=!0,a&&Le()}),()=>{var g;for(var d of o){e.removeEventListener(d,Ss);var f=zr.get(d);--f===0?(document.removeEventListener(d,Ss),zr.delete(d)):zr.set(d,f)}Zn.delete(l),p!==r&&((g=p.parentNode)==null||g.removeChild(p))}});return mc.set(c,h),c}let mc=new WeakMap;var Pt,Bt,gt,jr,Bs,Fs,mn;class yo{constructor(e,r=!0){Nt(this,"anchor");ke(this,Pt,new Map);ke(this,Bt,new Map);ke(this,gt,new Map);ke(this,jr,new Set);ke(this,Bs,!0);ke(this,Fs,()=>{var e=ge;if(C(this,Pt).has(e)){var r=C(this,Pt).get(e),s=C(this,Bt).get(r);if(s)ka(s),C(this,jr).delete(r);else{var n=C(this,gt).get(r);n&&(C(this,Bt).set(r,n.effect),C(this,gt).delete(r),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),s=n.effect)}for(const[a,i]of C(this,Pt)){if(C(this,Pt).delete(a),a===e)break;const o=C(this,gt).get(i);o&&(ht(o.effect),C(this,gt).delete(i))}for(const[a,i]of C(this,Bt)){if(a===r||C(this,jr).has(a))continue;const o=()=>{if(Array.from(C(this,Pt).values()).includes(a)){var c=document.createDocumentFragment();lo(i,c),c.append(sr()),C(this,gt).set(a,{effect:i,fragment:c})}else ht(i);C(this,jr).delete(a),C(this,Bt).delete(a)};C(this,Bs)||!s?(C(this,jr).add(a),Pr(i,o,!1)):o()}}});ke(this,mn,e=>{C(this,Pt).delete(e);const r=Array.from(C(this,Pt).values());for(const[s,n]of C(this,gt))r.includes(s)||(ht(n.effect),C(this,gt).delete(s))});this.anchor=e,de(this,Bs,r)}ensure(e,r){var s=ge,n=Qi();if(r&&!C(this,Bt).has(e)&&!C(this,gt).has(e))if(n){var a=document.createDocumentFragment(),i=sr();a.append(i),C(this,gt).set(e,{effect:xt(()=>r(i)),fragment:a})}else C(this,Bt).set(e,xt(()=>r(this.anchor)));if(C(this,Pt).set(s,e),n){for(const[o,l]of C(this,Bt))o===e?s.skipped_effects.delete(l):s.skipped_effects.add(l);for(const[o,l]of C(this,gt))o===e?s.skipped_effects.delete(l.effect):s.skipped_effects.add(l.effect);s.oncommit(C(this,Fs)),s.ondiscard(C(this,mn))}else C(this,Fs).call(this)}}Pt=new WeakMap,Bt=new WeakMap,gt=new WeakMap,jr=new WeakMap,Bs=new WeakMap,Fs=new WeakMap,mn=new WeakMap;function ve(t,e,r=!1){var s=new yo(t),n=r?_r:0;function a(i,o){s.ensure(i,o)}Gs(()=>{var i=!1;e((o,l=!0)=>{i=!0,a(l,o)}),i||a(!1,null)},n)}function $e(t,e){return e}function _c(t,e,r){for(var s=[],n=e.length,a,i=e.length,o=0;o<n;o++){let p=e[o];Pr(p,()=>{if(a){if(a.pending.delete(p),a.done.add(p),a.pending.size===0){var d=t.outrogroups;ea(_n(a.done)),d.delete(a),d.size===0&&(t.outrogroups=null)}}else i-=1},!1)}if(i===0){var l=s.length===0&&r!==null;if(l){var c=r,h=c.parentNode;Zl(h),h.append(c),t.items.clear()}ea(e,!l)}else a={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(a)}function ea(t,e=!0){for(var r=0;r<t.length;r++)ht(t[r],e)}var Ha;function Me(t,e,r,s,n,a=null){var i=t,o=new Map,l=(e&Mi)!==0;if(l){var c=t;i=c.appendChild(sr())}var h=null,p=wa(()=>{var k=r();return zs(k)?k:k==null?[]:_n(k)}),d,f=!0;function g(){v.fallback=h,wc(v,d,i,e,s),h!==null&&(d.length===0?h.f&er?(h.f^=er,Es(h,null,i)):ka(h):Pr(h,()=>{h=null}))}var w=Gs(()=>{d=u(p);for(var k=d.length,R=new Set,O=ge,E=Qi(),A=0;A<k;A+=1){var x=d[A],j=s(x,A),I=f?null:o.get(j);I?(I.v&&hs(I.v,x),I.i&&hs(I.i,A),E&&O.skipped_effects.delete(I.e)):(I=yc(o,f?i:Ha??(Ha=sr()),x,j,A,n,e,r),f||(I.e.f|=er),o.set(j,I)),R.add(j)}if(k===0&&a&&!h&&(f?h=xt(()=>a(i)):(h=xt(()=>a(Ha??(Ha=sr()))),h.f|=er)),!f)if(E){for(const[P,M]of o)R.has(P)||O.skipped_effects.add(M.e);O.oncommit(g),O.ondiscard(()=>{})}else g();u(p)}),v={effect:w,items:o,outrogroups:null,fallback:h};f=!1}function wc(t,e,r,s,n){var M,G,W,$,L,q,J,ae,B;var a=(s&yl)!==0,i=e.length,o=t.items,l=t.effect.first,c,h=null,p,d=[],f=[],g,w,v,k;if(a)for(k=0;k<i;k+=1)g=e[k],w=n(g,k),v=o.get(w).e,v.f&er||((G=(M=v.nodes)==null?void 0:M.a)==null||G.measure(),(p??(p=new Set)).add(v));for(k=0;k<i;k+=1){if(g=e[k],w=n(g,k),v=o.get(w).e,t.outrogroups!==null)for(const Z of t.outrogroups)Z.pending.delete(v),Z.done.delete(v);if(v.f&er)if(v.f^=er,v===l)Es(v,null,r);else{var R=h?h.next:l;v===t.effect.last&&(t.effect.last=v.prev),v.prev&&(v.prev.next=v.next),v.next&&(v.next.prev=v.prev),lr(t,h,v),lr(t,v,R),Es(v,R,r),h=v,d=[],f=[],l=h.next;continue}if(v.f&bt&&(ka(v),a&&(($=(W=v.nodes)==null?void 0:W.a)==null||$.unfix(),(p??(p=new Set)).delete(v))),v!==l){if(c!==void 0&&c.has(v)){if(d.length<f.length){var O=f[0],E;h=O.prev;var A=d[0],x=d[d.length-1];for(E=0;E<d.length;E+=1)Es(d[E],O,r);for(E=0;E<f.length;E+=1)c.delete(f[E]);lr(t,A.prev,x.next),lr(t,h,A),lr(t,x,O),l=O,h=x,k-=1,d=[],f=[]}else c.delete(v),Es(v,l,r),lr(t,v.prev,v.next),lr(t,v,h===null?t.effect.first:h.next),lr(t,h,v),h=v;continue}for(d=[],f=[];l!==null&&l!==v;)(c??(c=new Set)).add(l),f.push(l),l=l.next;if(l===null)continue}v.f&er||d.push(v),h=v,l=v.next}if(t.outrogroups!==null){for(const Z of t.outrogroups)Z.pending.size===0&&(ea(_n(Z.done)),(L=t.outrogroups)==null||L.delete(Z));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||c!==void 0){var j=[];if(c!==void 0)for(v of c)v.f&bt||j.push(v);for(;l!==null;)!(l.f&bt)&&l!==t.fallback&&j.push(l),l=l.next;var I=j.length;if(I>0){var P=s&Mi&&i===0?r:null;if(a){for(k=0;k<I;k+=1)(J=(q=j[k].nodes)==null?void 0:q.a)==null||J.measure();for(k=0;k<I;k+=1)(B=(ae=j[k].nodes)==null?void 0:ae.a)==null||B.fix()}_c(t,j,P)}}a&&qr(()=>{var Z,S;if(p!==void 0)for(v of p)(S=(Z=v.nodes)==null?void 0:Z.a)==null||S.apply()})}function yc(t,e,r,s,n,a,i,o){var l=i&_l?i&bl?Ur(r):mr(r,!1,!1):null,c=i&wl?Ur(n):null;return{v:l,i:c,e:xt(()=>(a(e,l??r,c??n,o),()=>{t.delete(s)}))}}function Es(t,e,r){if(t.nodes)for(var s=t.nodes.start,n=t.nodes.end,a=e&&!(e.f&er)?e.nodes.start:r;s!==null;){var i=Ks(s);if(a.before(s),s===n)return;s=i}}function lr(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function Ga(t,e,r){var s=new yo(t);Gs(()=>{var n=e()??null;s.ensure(n,n&&(a=>r(a,n)))},_r)}const bc=()=>performance.now(),Qt={tick:t=>requestAnimationFrame(t),now:()=>bc(),tasks:new Set};function bo(){const t=Qt.now();Qt.tasks.forEach(e=>{e.c(t)||(Qt.tasks.delete(e),e.f())}),Qt.tasks.size!==0&&Qt.tick(bo)}function kc(t){let e;return Qt.tasks.size===0&&Qt.tick(bo),{promise:new Promise(r=>{Qt.tasks.add(e={c:t,f:r})}),abort(){Qt.tasks.delete(e)}}}function Zs(t,e){ps(()=>{t.dispatchEvent(new CustomEvent(e))})}function Sc(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function Ja(t){const e={},r=t.split(";");for(const s of r){const[n,a]=s.split(":");if(!n||a===void 0)break;const i=Sc(n.trim());e[i]=a.trim()}return e}const Ec=t=>t;function Tc(t,e,r,s){var v;var n=(t&Al)!==0,a="both",i,o=e.inert,l=e.style.overflow,c,h;function p(){return ps(()=>i??(i=r()(e,(s==null?void 0:s())??{},{direction:a})))}var d={is_global:n,in(){e.inert=o,Zs(e,"introstart"),c=ta(e,p(),h,1,()=>{Zs(e,"introend"),c==null||c.abort(),c=i=void 0,e.style.overflow=l})},out(k){e.inert=!0,Zs(e,"outrostart"),h=ta(e,p(),c,0,()=>{Zs(e,"outroend"),k==null||k()})},stop:()=>{c==null||c.abort(),h==null||h.abort()}},f=Se;if(((v=f.nodes).t??(v.t=[])).push(d),Qn){var g=n;if(!g){for(var w=f.parent;w&&w.f&_r;)for(;(w=w.parent)&&!(w.f&Kt););g=!w||(w.f&bn)!==0}g&&ba(()=>{Gt(()=>d.in())})}}function ta(t,e,r,s,n){var a=s===1;if(Zr(e)){var i,o=!1;return qr(()=>{if(!o){var v=e({direction:a?"in":"out"});i=ta(t,v,r,s,n)}}),{abort:()=>{o=!0,i==null||i.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(r==null||r.deactivate(),!(e!=null&&e.duration))return n(),{abort:_t,deactivate:_t,reset:_t,t:()=>s};const{delay:l=0,css:c,tick:h,easing:p=Ec}=e;var d=[];if(a&&r===void 0&&(h&&h(0,1),c)){var f=Ja(c(0,1));d.push(f,f)}var g=()=>1-s,w=t.animate(d,{duration:l,fill:"forwards"});return w.onfinish=()=>{w.cancel();var v=(r==null?void 0:r.t())??1-s;r==null||r.abort();var k=s-v,R=e.duration*Math.abs(k),O=[];if(R>0){var E=!1;if(c)for(var A=Math.ceil(R/16.666666666666668),x=0;x<=A;x+=1){var j=v+k*p(x/A),I=Ja(c(j,1-j));O.push(I),E||(E=I.overflow==="hidden")}E&&(t.style.overflow="hidden"),g=()=>{var P=w.currentTime;return v+k*p(P/R)},h&&kc(()=>{if(w.playState!=="running")return!1;var P=g();return h(P,1-P),!0})}w=t.animate(O,{duration:R,fill:"forwards"}),w.onfinish=()=>{g=()=>s,h==null||h(s,1-s),n()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=_t)},deactivate:()=>{n=_t},reset:()=>{s===0&&(h==null||h(1,0))},t:()=>g()}}function Ea(t,e){var r;r=document.head.appendChild(sr());try{Gs(()=>e(r),ma)}finally{}}function ko(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=ko(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function Oc(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=ko(t))&&(s&&(s+=" "),s+=e);return s}function hn(t){return typeof t=="object"?Oc(t):t??""}const Ya=[...` 	
\r\fÂ \v\uFEFF`];function Ac(t,e,r){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),r){for(var n in r)if(r[n])s=s?s+" "+n:n;else if(s.length)for(var a=n.length,i=0;(i=s.indexOf(n,i))>=0;){var o=i+a;(i===0||Ya.includes(s[i-1]))&&(o===s.length||Ya.includes(s[o]))?s=(i===0?"":s.substring(0,i))+s.substring(o+1):i=o}}return s===""?null:s}function xc(t,e){return t==null?null:String(t)}function mt(t,e,r,s,n,a){var i=t.__className;if(i!==r||i===void 0){var o=Ac(r,s,a);o==null?t.removeAttribute("class"):t.className=o,t.__className=r}else if(a&&n!==a)for(var l in a){var c=!!a[l];(n==null||c!==!!n[l])&&t.classList.toggle(l,c)}return a}function Rc(t,e,r,s){var n=t.__style;if(n!==e){var a=xc(e);a==null?t.removeAttribute("style"):t.style.cssText=a,t.__style=e}return s}function So(t,e,r=!1){if(t.multiple){if(e==null)return;if(!zs(e))return Il();for(var s of t.options)s.selected=e.includes(Rs(s));return}for(s of t.options){var n=Rs(s);if(Jl(n,e)){s.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function Cc(t){var e=new MutationObserver(()=>{So(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),En(()=>{e.disconnect()})}function at(t,e,r=e){var s=new WeakSet,n=!0;eo(t,"change",a=>{var i=a?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(i),Rs);else{var l=t.querySelector(i)??t.querySelector("option:not([disabled])");o=l&&Rs(l)}r(o),ge!==null&&s.add(ge)}),ba(()=>{var a=e();if(t===document.activeElement){var i=Os??ge;if(s.has(i))return}if(So(t,a,n),n&&a===void 0){var o=t.querySelector(":checked");o!==null&&(a=Rs(o),r(a))}t.__value=a,n=!1}),Cc(t)}function Rs(t){return"__value"in t?t.__value:t.value}const Ic=Symbol("is custom element"),jc=Symbol("is html");function He(t,e,r,s){var n=Pc(t);n[e]!==(n[e]=r)&&(e==="loading"&&(t[al]=r),r==null?t.removeAttribute(e):typeof r!="string"&&$c(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function Pc(t){return t.__attributes??(t.__attributes={[Ic]:t.nodeName.includes("-"),[jc]:t.namespaceURI===Cl})}var Za=new Map;function $c(t){var e=t.getAttribute("is")||t.nodeName,r=Za.get(e);if(r)return r;Za.set(e,r=[]);for(var s,n=t,a=Element.prototype;a!==n;){s=Ii(n);for(var i in s)s[i].set&&r.push(i);n=pa(n)}return r}function Rt(t,e,r=e){var s=new WeakSet;eo(t,"input",async n=>{var a=n?t.defaultValue:t.value;if(a=In(t)?jn(a):a,r(a),ge!==null&&s.add(ge),await po(),a!==(a=e())){var i=t.selectionStart,o=t.selectionEnd,l=t.value.length;if(t.value=a??"",o!==null){var c=t.value.length;i===o&&o===l&&c>l?(t.selectionStart=c,t.selectionEnd=c):(t.selectionStart=i,t.selectionEnd=Math.min(o,c))}}}),Gt(e)==null&&t.value&&(r(In(t)?jn(t.value):t.value),ge!==null&&s.add(ge)),Hs(()=>{var n=e();if(t===document.activeElement){var a=Os??ge;if(s.has(a))return}In(t)&&n===jn(t.value)||t.type==="date"&&!n&&!t.value||n!==t.value&&(t.value=n??"")})}function In(t){var e=t.type;return e==="number"||e==="range"}function jn(t){return t===""?null:+t}function Xa(t,e){return t===e||(t==null?void 0:t[Vt])===e}function zt(t={},e,r,s){return ba(()=>{var n,a;return Hs(()=>{n=a,a=[],Gt(()=>{t!==r(...a)&&(e(t,...a),n&&Xa(r(...n),t)&&e(null,...n))})}),()=>{qr(()=>{a&&Xa(r(...a),t)&&e(null,...a)})}}),t}function Ta(t=!1){const e=xe,r=e.l.u;if(!r)return;let s=()=>_o(e.s);if(t){let n=0,a={};const i=Ws(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==a[c]&&(a[c]=l[c],o=!0);return o&&n++,n});s=()=>u(i)}r.b.length&&ec(()=>{Qa(e,s),an(r.b)}),Oe(()=>{const n=Gt(()=>r.m.map(rl));return()=>{for(const a of n)typeof a=="function"&&a()}}),r.a.length&&Oe(()=>{Qa(e,s),an(r.a)})}function Qa(t,e){if(t.l.s)for(const r of t.l.s)u(r);e()}function ei(t,e){var a;var r=(a=t.$$events)==null?void 0:a[e.type],s=zs(r)?r.slice():r==null?[]:[r];for(var n of s)n.call(this,e)}function Oa(t,e,r){if(t==null)return e(void 0),r&&r(void 0),_t;const s=Gt(()=>t.subscribe(e,r));return s.unsubscribe?()=>s.unsubscribe():s}const Vr=[];function Eo(t,e){return{subscribe:To(t,e).subscribe}}function To(t,e=_t){let r=null;const s=new Set;function n(o){if(Ni(t,o)&&(t=o,r)){const l=!Vr.length;for(const c of s)c[1](),Vr.push(c,t);if(l){for(let c=0;c<Vr.length;c+=2)Vr[c][0](Vr[c+1]);Vr.length=0}}}function a(o){n(o(t))}function i(o,l=_t){const c=[o,l];return s.add(c),s.size===1&&(r=e(n,a)||_t),o(t),()=>{s.delete(c),s.size===0&&r&&(r(),r=null)}}return{set:n,update:a,subscribe:i}}function Oo(t,e,r){const s=!Array.isArray(t),n=s?[t]:t;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return Eo(r,(i,o)=>{let l=!1;const c=[];let h=0,p=_t;const d=()=>{if(h)return;p();const g=e(s?c[0]:c,i,o);a?i(g):p=typeof g=="function"?g:_t},f=n.map((g,w)=>Oa(g,v=>{c[w]=v,h&=~(1<<w),l&&d()},()=>{h|=1<<w}));return l=!0,d(),function(){an(f),p(),l=!1}})}function Mc(t){let e;return Oa(t,r=>e=r)(),e}let Xs=!1,ra=Symbol();function ms(t,e,r){const s=r[e]??(r[e]={store:null,source:mr(void 0),unsubscribe:_t});if(s.store!==t&&!(ra in r))if(s.unsubscribe(),s.store=t??null,t==null)s.source.v=void 0,s.unsubscribe=_t;else{var n=!0;s.unsubscribe=Oa(t,a=>{n?s.source.v=a:m(s.source,a)}),n=!1}return t&&ra in r?Mc(t):u(s.source)}function _s(){const t={};function e(){En(()=>{for(var r in t)t[r].unsubscribe();Ci(t,ra,{enumerable:!1,value:!0})})}return[t,e]}function Dc(t){var e=Xs;try{return Xs=!1,[t(),Xs]}finally{Xs=e}}const Nc={get(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(Zr(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s)return s[e]}},set(t,e,r){let s=t.props.length;for(;s--;){let n=t.props[s];Zr(n)&&(n=n());const a=vr(n,e);if(a&&a.set)return a.set(r),!0}return!1},getOwnPropertyDescriptor(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(Zr(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s){const n=vr(s,e);return n&&!n.configurable&&(n.configurable=!0),n}}},has(t,e){if(e===Vt||e===$i)return!1;for(let r of t.props)if(Zr(r)&&(r=r()),r!=null&&e in r)return!0;return!1},ownKeys(t){const e=[];for(let r of t.props)if(Zr(r)&&(r=r()),!!r){for(const s in r)e.includes(s)||e.push(s);for(const s of Object.getOwnPropertySymbols(r))e.includes(s)||e.push(s)}return e}};function ti(...t){return new Proxy({props:t},Nc)}function Ee(t,e,r,s){var O;var n=!vs||(r&Sl)!==0,a=(r&Tl)!==0,i=(r&Ol)!==0,o=s,l=!0,c=()=>(l&&(l=!1,o=i?Gt(s):s),o),h;if(a){var p=Vt in t||$i in t;h=((O=vr(t,e))==null?void 0:O.set)??(p&&e in t?E=>t[e]=E:void 0)}var d,f=!1;a?[d,f]=Dc(()=>t[e]):d=t[e],d===void 0&&s!==void 0&&(d=c(),h&&(n&&fl(),h(d)));var g;if(n?g=()=>{var E=t[e];return E===void 0?c():(l=!0,E)}:g=()=>{var E=t[e];return E!==void 0&&(o=void 0),E===void 0?o:E},n&&!(r&El))return g;if(h){var w=t.$$legacy;return function(E,A){return arguments.length>0?((!n||!A||w||f)&&h(A?g():E),E):g()}}var v=!1,k=(r&kl?Ws:wa)(()=>(v=!1,g()));a&&u(k);var R=Se;return function(E,A){if(arguments.length>0){const x=A?u(k):n&&a?H(E):E;return m(k,x),v=!0,o!==void 0&&(o=x),E}return Br&&v||R.f&rr?k.v:u(k)}}function ft(t){xe===null&&kn(),vs&&xe.l!==null?Ao(xe).m.push(t):Oe(()=>{const e=Gt(t);if(typeof e=="function")return e})}function Uc(t){xe===null&&kn(),ft(()=>()=>Gt(t))}function Lc(t,e,{bubbles:r=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:s})}function qc(){const t=xe;return t===null&&kn(),(e,r,s)=>{var a;const n=(a=t.s.$$events)==null?void 0:a[e];if(n){const i=zs(n)?n.slice():[n],o=Lc(e,r,s);for(const l of i)l.call(t.x,o);return!o.defaultPrevented}return!0}}function Bc(t){xe===null&&kn(),xe.l===null&&dl(),Ao(xe).a.push(t)}function Ao(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const Fc="5";var Ri;typeof window<"u"&&((Ri=window.__svelte??(window.__svelte={})).v??(Ri.v=new Set)).add(Fc);function Tn(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(r[s[n]]=t[s[n]]);return r}function zc(t,e,r,s){function n(a){return a instanceof r?a:new r(function(i){i(a)})}return new(r||(r=Promise))(function(a,i){function o(h){try{c(s.next(h))}catch(p){i(p)}}function l(h){try{c(s.throw(h))}catch(p){i(p)}}function c(h){h.done?a(h.value):n(h.value).then(o,l)}c((s=s.apply(t,e||[])).next())})}const Vc=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Aa extends Error{constructor(e,r="FunctionsError",s){super(e),this.name=r,this.context=s}}class Wc extends Aa{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ri extends Aa{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class si extends Aa{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var sa;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(sa||(sa={}));class Kc{constructor(e,{headers:r={},customFetch:s,region:n=sa.Any}={}){this.url=e,this.headers=r,this.region=n,this.fetch=Vc(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return zc(this,arguments,void 0,function*(r,s={}){var n;let a,i;try{const{headers:o,method:l,body:c,signal:h,timeout:p}=s;let d={},{region:f}=s;f||(f=this.region);const g=new URL(`${this.url}/${r}`);f&&f!=="any"&&(d["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let w;c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",w=c):typeof c=="string"?(d["Content-Type"]="text/plain",w=c):typeof FormData<"u"&&c instanceof FormData?w=c:(d["Content-Type"]="application/json",w=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?w=JSON.stringify(c):w=c;let v=h;p&&(i=new AbortController,a=setTimeout(()=>i.abort(),p),h?(v=i.signal,h.addEventListener("abort",()=>i.abort())):v=i.signal);const k=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),o),body:w,signal:v}).catch(A=>{throw new Wc(A)}),R=k.headers.get("x-relay-error");if(R&&R==="true")throw new ri(k);if(!k.ok)throw new si(k);let O=((n=k.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),E;return O==="application/json"?E=yield k.json():O==="application/octet-stream"||O==="application/pdf"?E=yield k.blob():O==="text/event-stream"?E=k:O==="multipart/form-data"?E=yield k.formData():E=yield k.text(),{data:E,error:null,response:k}}catch(o){return{data:null,error:o,response:o instanceof si||o instanceof ri?o.context:void 0}}finally{a&&clearTimeout(a)}})}}var Hc=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},Gc=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{let i=null,o=null,l=null,c=a.status,h=a.statusText;if(a.ok){var p,d;if(r.method!=="HEAD"){var f;const k=await a.text();k===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((f=r.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?o=k:o=JSON.parse(k))}const w=(p=r.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),v=(d=a.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");w&&v&&v.length>1&&(l=parseInt(v[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,h="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var g;const w=await a.text();try{i=JSON.parse(w),Array.isArray(i)&&a.status===404&&(o=[],i=null,c=200,h="OK")}catch{a.status===404&&w===""?(c=204,h="No Content"):i={message:w}}if(i&&r.isMaybeSingle&&(!(i==null||(g=i.details)===null||g===void 0)&&g.includes("0 rows"))&&(i=null,c=200,h="OK"),i&&r.shouldThrowOnError)throw new Hc(i)}return{error:i,data:o,count:l,status:c,statusText:h}});return this.shouldThrowOnError||(n=n.catch(a=>{var i;let o="";const l=a==null?void 0:a.cause;if(l){var c,h,p,d;const g=(c=l==null?void 0:l.message)!==null&&c!==void 0?c:"",w=(h=l==null?void 0:l.code)!==null&&h!==void 0?h:"";o=`${(p=a==null?void 0:a.name)!==null&&p!==void 0?p:"FetchError"}: ${a==null?void 0:a.message}`,o+=`

Caused by: ${(d=l==null?void 0:l.name)!==null&&d!==void 0?d:"Error"}: ${g}`,w&&(o+=` (${w})`),l!=null&&l.stack&&(o+=`
${l.stack}`)}else{var f;o=(f=a==null?void 0:a.stack)!==null&&f!==void 0?f:""}return{error:{message:`${(i=a==null?void 0:a.name)!==null&&i!==void 0?i:"FetchError"}: ${a==null?void 0:a.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(t,e)}returns(){return this}overrideTypes(){return this}},Jc=class extends Gc{select(t){let e=!1;const r=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.order`:"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${i?`${i},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(a,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:a="text"}={}){var i;const o=[t?"analyze":null,e?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(i=this.headers.get("Accept"))!==null&&i!==void 0?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const ni=new RegExp("[,()]");var Xr=class extends Jc{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&ni.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&ni.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${n}fts${a}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},Yc=class{constructor(t,{headers:e={},schema:r,fetch:s}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:s}=e??{},n=r?"HEAD":"GET";let a=!1;const i=(t??"*").split("").map(c=>/\s/.test(c)&&!a?"":(c==='"'&&(a=!a),c)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",i),s&&l.append("Prefer",`count=${s}`),new Xr({method:n,url:o,headers:l,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var s;const n="POST",{url:a,headers:i}=this.cloneRequestState();if(e&&i.append("Prefer",`count=${e}`),r||i.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);a.searchParams.set("columns",l.join(","))}}return new Xr({method:n,url:a,headers:i,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var a;const i="POST",{url:o,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&o.searchParams.set("on_conflict",e),s&&l.append("Prefer",`count=${s}`),n||l.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(c.length>0){const h=[...new Set(c)].map(p=>`"${p}"`);o.searchParams.set("columns",h.join(","))}}return new Xr({method:i,url:o,headers:l,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}update(t,{count:e}={}){var r;const s="PATCH",{url:n,headers:a}=this.cloneRequestState();return e&&a.append("Prefer",`count=${e}`),new Xr({method:s,url:n,headers:a,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var e;const r="DELETE",{url:s,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new Xr({method:r,url:s,headers:n,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},Zc=class xo{constructor(e,{headers:r={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(r),this.schemaName=s,this.fetch=n}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Yc(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new xo(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:s=!1,get:n=!1,count:a}={}){var i;let o;const l=new URL(`${this.url}/rpc/${e}`);let c;const h=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(h)),p=s&&Object.values(r).some(h);p?(o="POST",c=r):s||n?(o=s?"HEAD":"GET",Object.entries(r).filter(([f,g])=>g!==void 0).map(([f,g])=>[f,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([f,g])=>{l.searchParams.append(f,g)})):(o="POST",c=r);const d=new Headers(this.headers);return p?d.set("Prefer",a?`count=${a},return=minimal`:"return=minimal"):a&&d.set("Prefer",`count=${a}`),new Xr({method:o,url:l,headers:d,schema:this.schemaName,body:c,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};class Xc{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const s=r.versions;if(s&&s.node){const n=s.node,a=parseInt(n.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const s=this.getWebSocketConstructor();return new s(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Qc="2.90.1",eu=`realtime-js/${Qc}`,Ro="1.0.0",tu="2.0.0",ai=Ro,na=1e4,ru=1e3,su=100;var cr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(cr||(cr={}));var Ke;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ke||(Ke={}));var $t;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})($t||($t={}));var aa;(function(t){t.websocket="websocket"})(aa||(aa={}));var Sr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Sr||(Sr={}));class nu{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:{},i=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,i)}_encodeUserBroadcastPush(e,r,s){var n,a;const i=e.topic,o=(n=e.ref)!==null&&n!==void 0?n:"",l=(a=e.join_ref)!==null&&a!==void 0?a:"",c=e.payload.event,h=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},p=Object.keys(h).length===0?"":JSON.stringify(h);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`metadata length ${p.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+o.length+i.length+c.length+p.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let g=new DataView(f),w=0;g.setUint8(w++,this.KINDS.userBroadcastPush),g.setUint8(w++,l.length),g.setUint8(w++,o.length),g.setUint8(w++,i.length),g.setUint8(w++,c.length),g.setUint8(w++,p.length),g.setUint8(w++,r),Array.from(l,k=>g.setUint8(w++,k.charCodeAt(0))),Array.from(o,k=>g.setUint8(w++,k.charCodeAt(0))),Array.from(i,k=>g.setUint8(w++,k.charCodeAt(0))),Array.from(c,k=>g.setUint8(w++,k.charCodeAt(0))),Array.from(p,k=>g.setUint8(w++,k.charCodeAt(0)));var v=new Uint8Array(f.byteLength+s.byteLength);return v.set(new Uint8Array(f),0),v.set(new Uint8Array(s),f.byteLength),v.buffer}decode(e,r){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return r(s)}if(typeof e=="string"){const s=JSON.parse(e),[n,a,i,o,l]=s;return r({join_ref:n,ref:a,topic:i,event:o,payload:l})}return r({})}_binaryDecode(e){const r=new DataView(e),s=r.getUint8(0),n=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,r,n)}}_decodeUserBroadcast(e,r,s){const n=r.getUint8(1),a=r.getUint8(2),i=r.getUint8(3),o=r.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(e.slice(l,l+n));l=l+n;const h=s.decode(e.slice(l,l+a));l=l+a;const p=s.decode(e.slice(l,l+i));l=l+i;const d=e.slice(l,e.byteLength),f=o===this.JSON_ENCODING?JSON.parse(s.decode(d)):d,g={type:this.BROADCAST_EVENT,event:h,payload:f};return i>0&&(g.meta=JSON.parse(p)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e==null?void 0:e.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>r.includes(s)))}}class Co{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ie;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ie||(Ie={}));const ii=(t,e,r={})=>{var s;const n=(s=r.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((a,i)=>(a[i]=au(i,t,e,n),a),{}):{}},au=(t,e,r,s)=>{const n=e.find(o=>o.name===t),a=n==null?void 0:n.type,i=r[t];return a&&!s.includes(a)?Io(a,i):ia(i)},Io=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return cu(e,r)}switch(t){case Ie.bool:return iu(e);case Ie.float4:case Ie.float8:case Ie.int2:case Ie.int4:case Ie.int8:case Ie.numeric:case Ie.oid:return ou(e);case Ie.json:case Ie.jsonb:return lu(e);case Ie.timestamp:return uu(e);case Ie.abstime:case Ie.date:case Ie.daterange:case Ie.int4range:case Ie.int8range:case Ie.money:case Ie.reltime:case Ie.text:case Ie.time:case Ie.timestamptz:case Ie.timetz:case Ie.tsrange:case Ie.tstzrange:return ia(e);default:return ia(e)}},ia=t=>t,iu=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ou=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},lu=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},cu=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,s=t[r];if(t[0]==="{"&&s==="}"){let a;const i=t.slice(1,r);try{a=JSON.parse("["+i+"]")}catch{a=i?i.split(","):[]}return a.map(o=>Io(e,o))}return t},uu=t=>typeof t=="string"?t.replace(" ","T"):t,jo=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Pn{constructor(e,r,s={},n=na){this.channel=e,this.event=r,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var s;return this._hasReceived(e)&&r((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var oi;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(oi||(oi={}));class Cs{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:a,onLeave:i,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Cs.syncState(this.state,n,a,i),this.pendingDiffs.forEach(l=>{this.state=Cs.syncDiff(this.state,l,a,i)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:a,onLeave:i,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Cs.syncDiff(this.state,n,a,i),o())}),this.onJoin((n,a,i)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:a,newPresences:i})}),this.onLeave((n,a,i)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:a,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,s,n){const a=this.cloneDeep(e),i=this.transformState(r),o={},l={};return this.map(a,(c,h)=>{i[c]||(l[c]=h)}),this.map(i,(c,h)=>{const p=a[c];if(p){const d=h.map(v=>v.presence_ref),f=p.map(v=>v.presence_ref),g=h.filter(v=>f.indexOf(v.presence_ref)<0),w=p.filter(v=>d.indexOf(v.presence_ref)<0);g.length>0&&(o[c]=g),w.length>0&&(l[c]=w)}else o[c]=h}),this.syncDiff(a,{joins:o,leaves:l},s,n)}static syncDiff(e,r,s,n){const{joins:a,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(a,(o,l)=>{var c;const h=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),h.length>0){const p=e[o].map(f=>f.presence_ref),d=h.filter(f=>p.indexOf(f.presence_ref)<0);e[o].unshift(...d)}s(o,h,l)}),this.map(i,(o,l)=>{let c=e[o];if(!c)return;const h=l.map(p=>p.presence_ref);c=c.filter(p=>h.indexOf(p.presence_ref)<0),e[o]=c,n(o,c,l),c.length===0&&delete e[o]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(s=>r(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,s)=>{const n=e[s];return"metas"in n?r[s]=n.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):r[s]=n,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var li;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(li||(li={}));var Is;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Is||(Is={}));var Zt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Zt||(Zt={}));class rs{constructor(e,r={config:{}},s){var n,a;if(this.topic=e,this.params=r,this.socket=s,this.bindings={},this.state=Ke.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Pn(this,$t.join,this.params,this.timeout),this.rejoinTimer=new Co(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ke.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ke.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ke.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ke.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ke.errored,this.rejoinTimer.scheduleTimeout())}),this._on($t.reply,{},(i,o)=>{this._trigger(this._replyEventName(o),i)}),this.presence=new Cs(this),this.broadcastEndpointURL=jo(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var s,n,a;if(this.socket.isConnected()||this.socket.connect(),this.state==Ke.closed){const{config:{broadcast:i,presence:o,private:l}}=this.params,c=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&n!==void 0?n:[],h=!!this.bindings[Is.PRESENCE]&&this.bindings[Is.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,p={},d={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:h}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Zt.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Zt.CLOSED)),this.updateJoinPayload(Object.assign({config:d},p)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e==null||e(Zt.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,v=(g=w==null?void 0:w.length)!==null&&g!==void 0?g:0,k=[];for(let R=0;R<v;R++){const O=w[R],{filter:{event:E,schema:A,table:x,filter:j}}=O,I=f&&f[R];if(I&&I.event===E&&rs.isFilterValueEqual(I.schema,A)&&rs.isFilterValueEqual(I.table,x)&&rs.isFilterValueEqual(I.filter,j))k.push(Object.assign(Object.assign({},O),{id:I.id}));else{this.unsubscribe(),this.state=Ke.errored,e==null||e(Zt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=k,e&&e(Zt.SUBSCRIBED);return}}).receive("error",f=>{this.state=Ke.errored,e==null||e(Zt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Zt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,s){return this.state===Ke.joined&&e===Is.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,s)}async httpSend(e,r,s={}){var n;if(r==null)return Promise.reject("Payload is required for httpSend()");const a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,i,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{const c=await o.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,r={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var i,o,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(i=this.params)===null||i===void 0?void 0:i.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&a("ok"),c.receive("ok",()=>a("ok")),c.receive("error",()=>a("error")),c.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ke.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger($t.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Pn(this,$t.leave,{},e),s.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ke.closed,this.bindings={}}async _fetchWithTimeout(e,r,s){const n=new AbortController,a=setTimeout(()=>n.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:n.signal}));return clearTimeout(a),i}_push(e,r,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Pn(this,e,r,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>su){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,s){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,s){var n,a;const i=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:h}=$t;if(s&&[o,l,c,h].indexOf(i)>=0&&s!==this._joinRef())return;let d=this._onMessage(i,r,s);if(r&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var g,w,v;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(w=f.filter)===null||w===void 0?void 0:w.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(f=>f.callback(d,s)):(a=this.bindings[i])===null||a===void 0||a.filter(f=>{var g,w,v,k,R,O,E,A;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){const x=f.id,j=(g=f.filter)===null||g===void 0?void 0:g.event;return x&&((w=r.ids)===null||w===void 0?void 0:w.includes(x))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))&&(!(!((k=f.filter)===null||k===void 0)&&k.table)||f.filter.table===((R=r.data)===null||R===void 0?void 0:R.table))}else{const x=(E=(O=f==null?void 0:f.filter)===null||O===void 0?void 0:O.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return x==="*"||x===((A=r==null?void 0:r.event)===null||A===void 0?void 0:A.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof d=="object"&&"ids"in d){const g=d.data,{schema:w,table:v,commit_timestamp:k,type:R,errors:O}=g;d=Object.assign(Object.assign({},{schema:w,table:v,commit_timestamp:k,eventType:R,new:{},old:{},errors:O}),this._getPayloadRecords(g))}f.callback(d,s)})}_isClosed(){return this.state===Ke.closed}_isJoined(){return this.state===Ke.joined}_isJoining(){return this.state===Ke.joining}_isLeaving(){return this.state===Ke.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,s){const n=e.toLocaleLowerCase(),a={type:n,filter:r,callback:s};return this.bindings[n]?this.bindings[n].push(a):this.bindings[n]=[a],this}_off(e,r){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var a;return!(((a=n.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===s&&rs.isEqual(n.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(e[s]!==r[s])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on($t.close,{},e)}_onError(e){this._on($t.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ke.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=ii(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=ii(e.columns,e.old_record)),r}}const $n=()=>{},Qs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},hu=[1e3,2e3,5e3,1e4],du=1e4,fu=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class vu{constructor(e,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=na,this.transport=null,this.heartbeatIntervalMs=Qs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$n,this.ref=0,this.reconnectTimer=null,this.vsn=ai,this.logger=$n,this.conn=null,this.sendBuffer=[],this.serializer=new nu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...a)=>n(...a):(...a)=>fetch(...a),!(!((s=r==null?void 0:r.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${aa.websocket}`,this.httpEndpoint=jo(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Xc.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,s){this.logger(e,r,s)}connectionState(){switch(this.conn&&this.conn.readyState){case cr.connecting:return Sr.Connecting;case cr.open:return Sr.Open;case cr.closing:return Sr.Closing;default:return Sr.Closed}}isConnected(){return this.connectionState()===Sr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(a=>a.topic===s);if(n)return n;{const a=new rs(`realtime:${e}`,r,this);return this.channels.push(a),a}}push(e){const{topic:r,event:s,payload:n,ref:a}=e,i=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${r} ${s} (${a})`,n),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ru,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Qs.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",c)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:n,payload:a,ref:i}=r,o=i?`(${i})`:"",l=a.status||"";this.log("receive",`${l} ${s} ${n} ${o}`.trim(),a),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(n,a,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===cr.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===cr.open||this.conn.readyState===cr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger($t.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(r);return`${e}${s}${n}`}_workerObjectUrl(e){let r;if(e)r=e;else{const s=new Blob([fu],{type:"application/javascript"});r=URL.createObjectURL(s)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,s=!1;if(e)r=e,s=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),r=this.accessTokenValue}else r=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const a={access_token:r,version:eu};r&&n.updateJoinPayload(a),n.joinedOnce&&n._isJoined()&&n._push($t.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(r)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Co(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Qs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,s,n,a,i,o,l,c,h,p,d,f;switch(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:na,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:Qs.HEARTBEAT_INTERVAL,this.worker=(a=e==null?void 0:e.worker)!==null&&a!==void 0?a:!1,this.accessToken=(i=e==null?void 0:e.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:$n,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:ai,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:g=>hu[g-1]||du,this.vsn){case Ro:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:(g,w)=>w(JSON.stringify(g)),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:(g,w)=>w(JSON.parse(g));break;case tu:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var $s=class extends Error{constructor(t,e){var r;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((r=e.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function pu(t,e,r){const s=new URL(e,t);if(r)for(const[n,a]of Object.entries(r))a!==void 0&&s.searchParams.set(n,a);return s.toString()}async function gu(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function mu(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:a,headers:i}){const o=pu(t.baseUrl,s,n),l=await gu(t.auth),c=await e(o,{method:r,headers:{...a?{"Content-Type":"application/json"}:{},...l,...i},body:a?JSON.stringify(a):void 0}),h=await c.text(),p=(c.headers.get("content-type")||"").includes("application/json"),d=p&&h?JSON.parse(h):h;if(!c.ok){const f=p?d:void 0,g=f==null?void 0:f.error;throw new $s((g==null?void 0:g.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:f})}return{status:c.status,headers:c.headers,data:d}}}}function en(t){return t.join("")}var _u=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:en(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${en(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${en(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${en(t.namespace)}`}),!0}catch(e){if(e instanceof $s&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof $s&&r.status===409)return;throw r}}};function Wr(t){return t.join("")}var wu=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Wr(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Wr(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Wr(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Wr(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Wr(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Wr(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof $s&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof $s&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},yu=class{constructor(t){var s;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=mu({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(s=t.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new _u(this.client,e),this.tableOps=new wu(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},On=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Pe(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var bu=class extends On{constructor(t,e,r){super(t),this.name="StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},oa=class extends On{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const xa=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),ku=()=>Response,la=t=>{if(Array.isArray(t))return t.map(r=>la(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,s])=>{const n=r.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[n]=la(s)}),e},Su=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Eu=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function Ms(t){"@babel/helpers - typeof";return Ms=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ms(t)}function Tu(t,e){if(Ms(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(Ms(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ou(t){var e=Tu(t,"string");return Ms(e)=="symbol"?e:e+""}function Au(t,e,r){return(e=Ou(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ci(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function ce(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ci(Object(r),!0).forEach(function(s){Au(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ci(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const Mn=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},xu=async(t,e,r)=>{t instanceof await ku()&&!(r!=null&&r.noResolveJson)?t.json().then(s=>{const n=t.status||500,a=(s==null?void 0:s.statusCode)||n+"";e(new bu(Mn(s),n,a))}).catch(s=>{e(new oa(Mn(s),s))}):e(new oa(Mn(t),t))},Ru=(t,e,r,s)=>{const n={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!s?n:(Su(s)?(n.headers=ce({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,e!=null&&e.duplex&&(n.duplex=e.duplex),ce(ce({},n),r))};async function Js(t,e,r,s,n,a){return new Promise((i,o)=>{t(r,Ru(e,s,n,a)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>xu(l,o,s))})}async function Ds(t,e,r,s){return Js(t,"GET",e,r,s)}async function jt(t,e,r,s,n){return Js(t,"POST",e,s,n,r)}async function ca(t,e,r,s,n){return Js(t,"PUT",e,s,n,r)}async function Cu(t,e,r,s){return Js(t,"HEAD",e,ce(ce({},r),{},{noResolveJson:!0}),s)}async function Ra(t,e,r,s,n){return Js(t,"DELETE",e,s,n,r)}var Iu=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}}};let Po;Po=Symbol.toStringTag;var ju=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Po]="BlobDownloadBuilder",this.promise=null}asStream(){return new Iu(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}}};const Pu={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ui={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var $u=class{constructor(t,e={},r,s){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=r,this.fetch=xa(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,r,s){var n=this;try{let a;const i=ce(ce({},ui),s);let o=ce(ce({},n.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",i.cacheControl),l&&a.append("metadata",n.encodeMetadata(l)),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.has("cacheControl")||a.append("cacheControl",i.cacheControl),l&&!a.has("metadata")&&a.append("metadata",n.encodeMetadata(l))):(a=r,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,l&&(o["x-metadata"]=n.toBase64(n.encodeMetadata(l))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!i.duplex&&(i.duplex="half")),s!=null&&s.headers&&(o=ce(ce({},o),s.headers));const c=n._removeEmptyFolders(e),h=n._getFinalPath(c),p=await(t=="PUT"?ca:jt)(n.fetch,`${n.url}/object/${h}`,a,ce({headers:o},i!=null&&i.duplex?{duplex:i.duplex}:{}));return{data:{path:c,id:p.Id,fullPath:p.Key},error:null}}catch(a){if(n.shouldThrowOnError)throw a;if(Pe(a))return{data:null,error:a};throw a}}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,s){var n=this;const a=n._removeEmptyFolders(t),i=n._getFinalPath(a),o=new URL(n.url+`/object/upload/sign/${i}`);o.searchParams.set("token",e);try{let l;const c=ce({upsert:ui.upsert},s),h=ce(ce({},n.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType),{data:{path:a,fullPath:(await ca(n.fetch,o.toString(),l,{headers:h})).Key},error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(Pe(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var r=this;try{let s=r._getFinalPath(t);const n=ce({},r.headers);e!=null&&e.upsert&&(n["x-upsert"]="true");const a=await jt(r.fetch,`${r.url}/object/upload/sign/${s}`,{},{headers:n}),i=new URL(r.url+a.url),o=i.searchParams.get("token");if(!o)throw new On("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:o},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(Pe(s))return{data:null,error:s};throw s}}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var s=this;try{return{data:await jt(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:s.headers}),error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(Pe(n))return{data:null,error:n};throw n}}async copy(t,e,r){var s=this;try{return{data:{path:(await jt(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:s.headers})).Key},error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(Pe(n))return{data:null,error:n};throw n}}async createSignedUrl(t,e,r){var s=this;try{let n=s._getFinalPath(t),a=await jt(s.fetch,`${s.url}/object/sign/${n}`,ce({expiresIn:e},r!=null&&r.transform?{transform:r.transform}:{}),{headers:s.headers});const i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return a={signedUrl:encodeURI(`${s.url}${a.signedURL}${i}`)},{data:a,error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(Pe(n))return{data:null,error:n};throw n}}async createSignedUrls(t,e,r){var s=this;try{const n=await jt(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:t},{headers:s.headers}),a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(i=>ce(ce({},i),{},{signedUrl:i.signedURL?encodeURI(`${s.url}${i.signedURL}${a}`):null})),error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(Pe(n))return{data:null,error:n};throw n}}download(t,e){const r=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),n=s?`?${s}`:"",a=this._getFinalPath(t),i=()=>Ds(this.fetch,`${this.url}/${r}/${a}${n}`,{headers:this.headers,noResolveJson:!0});return new ju(i,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);try{return{data:la(await Ds(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})),error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Pe(s))return{data:null,error:s};throw s}}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await Cu(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Pe(s)&&s instanceof oa){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}}getPublicUrl(t,e){const r=this._getFinalPath(t),s=[],n=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";n!==""&&s.push(n);const a=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});i!==""&&s.push(i);let o=s.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${o}`)}}}async remove(t){var e=this;try{return{data:await Ra(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}async list(t,e,r){var s=this;try{const n=ce(ce(ce({},Pu),e),{},{prefix:t||""});return{data:await jt(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},r),error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(Pe(n))return{data:null,error:n};throw n}}async listV2(t,e){var r=this;try{const s=ce({},t);return{data:await jt(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,s,{headers:r.headers},e),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(Pe(s))return{data:null,error:s};throw s}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const $o="2.90.1",Mo={"X-Client-Info":`storage-js/${$o}`};var Mu=class{constructor(t,e={},r,s){this.shouldThrowOnError=!1;const n=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=ce(ce({},Mo),e),this.fetch=xa(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const r=e.listBucketOptionsToQueryString(t);return{data:await Ds(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}async getBucket(t){var e=this;try{return{data:await Ds(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}async createBucket(t,e={public:!1}){var r=this;try{return{data:await jt(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(Pe(s))return{data:null,error:s};throw s}}async updateBucket(t,e){var r=this;try{return{data:await ca(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(Pe(s))return{data:null,error:s};throw s}}async emptyBucket(t){var e=this;try{return{data:await jt(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await Ra(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Du=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=ce(ce({},Mo),e),this.fetch=xa(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await jt(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}async listBuckets(t){var e=this;try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const s=r.toString(),n=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return{data:await Ds(e.fetch,n,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await Ra(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}}from(t){var e=this;if(!Eu(t))throw new On("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new yu({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(n,a){const i=n[a];return typeof i!="function"?i:async(...o)=>{try{return{data:await i.apply(n,o),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}};const Ca={"X-Client-Info":`storage-js/${$o}`,"Content-Type":"application/json"};var Do=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function wt(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var Dn=class extends Do{constructor(t,e,r){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Nu=class extends Do{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Ia=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Uu=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},hi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Lu=async(t,e,r)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(r!=null&&r.noResolveJson)){const s=t.status||500,n=t;if(typeof n.json=="function")n.json().then(a=>{const i=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||s+"";e(new Dn(hi(a),s,i))}).catch(()=>{const a=s+"";e(new Dn(n.statusText||`HTTP ${s} error`,s,a))});else{const a=s+"";e(new Dn(n.statusText||`HTTP ${s} error`,s,a))}}else e(new Nu(hi(t),t))},qu=(t,e,r,s)=>{const n={method:t,headers:(e==null?void 0:e.headers)||{}};return s?(Uu(s)?(n.headers=ce({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,ce(ce({},n),r)):n};async function Bu(t,e,r,s,n,a){return new Promise((i,o)=>{t(r,qu(e,s,n,a)).then(l=>{if(!l.ok)throw l;if(s!=null&&s.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>i(l)).catch(l=>Lu(l,o,s))})}async function yt(t,e,r,s,n){return Bu(t,"POST",e,s,n,r)}var Fu=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=ce(ce({},Ca),e),this.fetch=Ia(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async getIndex(t,e){var r=this;try{return{data:await yt(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(wt(s))return{data:null,error:s};throw s}}async listIndexes(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async deleteIndex(t,e){var r=this;try{return{data:await yt(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(wt(s))return{data:null,error:s};throw s}}},zu=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=ce(ce({},Ca),e),this.fetch=Ia(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await yt(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async getVectors(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await yt(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async queryVectors(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await yt(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}},Vu=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=ce(ce({},Ca),e),this.fetch=Ia(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async getBucket(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async listBuckets(t={}){var e=this;try{return{data:await yt(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await yt(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}},Wu=class extends Vu{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new Ku(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},Ku=class extends Fu{constructor(t,e,r,s){super(t,e,s),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new Hu(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},Hu=class extends zu{constructor(t,e,r,s,n){super(t,e,n),this.vectorBucketName=r,this.indexName=s}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,ce(ce({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},Gu=class extends Mu{constructor(t,e={},r,s){super(t,e,r,s)}from(t){return new $u(this.url,this.headers,t,this.fetch)}get vectors(){return new Wu(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Du(this.url+"/iceberg",this.headers,this.fetch)}};const No="2.90.1",Qr=30*1e3,ua=3,Nn=ua*Qr,Ju="http://localhost:9999",Yu="supabase.auth.token",Zu={"X-Client-Info":`gotrue-js/${No}`},ha="X-Supabase-Api-Version",Uo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Xu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Qu=10*60*1e3;class Ns extends Error{constructor(e,r,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=s}}function ee(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class eh extends Ns{constructor(e,r,s){super(e,r,s),this.name="AuthApiError",this.status=r,this.code=s}}function th(t){return ee(t)&&t.name==="AuthApiError"}class Er extends Ns{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class or extends Ns{constructor(e,r,s,n){super(e,s,n),this.name=r,this.status=s}}class vt extends or{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function rh(t){return ee(t)&&t.name==="AuthSessionMissingError"}class Kr extends or{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class tn extends or{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class rn extends or{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function sh(t){return ee(t)&&t.name==="AuthImplicitGrantRedirectError"}class di extends or{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class nh extends or{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class da extends or{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Un(t){return ee(t)&&t.name==="AuthRetryableFetchError"}class fi extends or{constructor(e,r,s){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=s}}class fa extends or{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const dn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),vi=` 	
\r=`.split(""),ah=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<vi.length;e+=1)t[vi[e].charCodeAt(0)]=-2;for(let e=0;e<dn.length;e+=1)t[dn[e].charCodeAt(0)]=e;return t})();function pi(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(dn[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(dn[s]),e.queuedBits-=6}}function Lo(t,e,r){const s=ah[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function gi(t){const e=[],r=i=>{e.push(String.fromCodePoint(i))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},a=i=>{lh(i,s,r)};for(let i=0;i<t.length;i+=1)Lo(t.charCodeAt(i),n,a);return e.join("")}function ih(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function oh(t,e){for(let r=0;r<t.length;r+=1){let s=t.charCodeAt(r);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(t.charCodeAt(r+1)-56320&65535|n)+65536,r+=1}ih(s,e)}}function lh(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let s=1;s<6;s+=1)if(!(t>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function ss(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)Lo(t.charCodeAt(n),r,s);return new Uint8Array(e)}function ch(t){const e=[];return oh(t,r=>e.push(r)),new Uint8Array(e)}function Or(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};return t.forEach(n=>pi(n,r,s)),pi(null,r,s),e.join("")}function uh(t){return Math.round(Date.now()/1e3)+t}function hh(){return Symbol("auth-callback")}const Qe=()=>typeof window<"u"&&typeof document<"u",yr={tested:!1,writable:!1},qo=()=>{if(!Qe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(yr.tested)return yr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),yr.tested=!0,yr.writable=!0}catch{yr.tested=!0,yr.writable=!1}return yr.writable};function dh(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,a)=>{e[a]=n})}catch{}return r.searchParams.forEach((s,n)=>{e[n]=s}),e}const Bo=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),fh=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",es=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},br=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Xe=async(t,e)=>{await t.removeItem(e)};class An{constructor(){this.promise=new An.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}An.promiseConstructor=Promise;function Ln(t){const e=t.split(".");if(e.length!==3)throw new fa("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!Xu.test(e[s]))throw new fa("JWT not in base64url format");return{header:JSON.parse(gi(e[0])),payload:JSON.parse(gi(e[1])),signature:ss(e[2]),raw:{header:e[0],payload:e[1]}}}async function vh(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function ph(t,e){return new Promise((s,n)=>{(async()=>{for(let a=0;a<1/0;a++)try{const i=await t(a);if(!e(a,null,i)){s(i);return}}catch(i){if(!e(a,i)){n(i);return}}})()})}function gh(t){return("0"+t.toString(16)).substr(-2)}function mh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=r.length;let n="";for(let a=0;a<56;a++)n+=r.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,gh).join("")}async function _h(t){const r=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",r),n=new Uint8Array(s);return Array.from(n).map(a=>String.fromCharCode(a)).join("")}async function wh(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await _h(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hr(t,e,r=!1){const s=mh();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await es(t,`${e}-code-verifier`,n);const a=await wh(s);return[a,s===a?"plain":"s256"]}const yh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function bh(t){const e=t.headers.get(ha);if(!e||!e.match(yh))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function kh(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Sh(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Eh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Gr(t){if(!Eh.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function qn(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Th(t,e){return new Proxy(t,{get:(r,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,s,n)}})}function mi(t){return JSON.parse(JSON.stringify(t))}const kr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Oh=[502,503,504];async function _i(t){var e;if(!fh(t))throw new da(kr(t),0);if(Oh.includes(t.status))throw new da(kr(t),t.status);let r;try{r=await t.json()}catch(a){throw new Er(kr(a),a)}let s;const n=bh(t);if(n&&n.getTime()>=Uo["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?s=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(s=r.error_code),s){if(s==="weak_password")throw new fi(kr(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new vt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((a,i)=>a&&typeof i=="string",!0))throw new fi(kr(r),t.status,r.weak_password.reasons);throw new eh(kr(r),t.status||500,s)}const Ah=(t,e,r,s)=>{const n={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))};async function le(t,e,r,s){var n;const a=Object.assign({},s==null?void 0:s.headers);a[ha]||(a[ha]=Uo["2024-01-01"].name),s!=null&&s.jwt&&(a.Authorization=`Bearer ${s.jwt}`);const i=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(i.redirect_to=s.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await xh(t,e,r+o,{headers:a,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function xh(t,e,r,s,n,a){const i=Ah(e,s,n,a);let o;try{o=await t(r,Object.assign({},i))}catch(l){throw console.error(l),new da(kr(l),0)}if(o.ok||await _i(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(l){await _i(l)}}function Ct(t){var e;let r=null;Ih(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=uh(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:s},error:null}}function wi(t){const e=Ct(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function ur(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Rh(t){return{data:t,error:null}}function Ch(t){const{action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a}=t,i=Tn(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a},l=Object.assign({},i);return{data:{properties:o,user:l},error:null}}function yi(t){return t}function Ih(t){return t.access_token&&t.refresh_token&&t.expires_in}const Bn=["global","local","others"];class jh{constructor({url:e="",headers:r={},fetch:s}){this.url=e,this.headers=r,this.fetch=Bo(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=Bn[0]){if(Bn.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Bn.join(", ")}`);try{return await le(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ee(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,r={}){try{return await le(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:ur})}catch(s){if(ee(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:r}=e,s=Tn(e,["options"]),n=Object.assign(Object.assign({},s),r);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ch,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(ee(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await le(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ur})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,s,n,a,i,o,l;try{const c={nextPage:null,lastPage:0,total:0},h=await le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(a=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&a!==void 0?a:""},xform:yi});if(h.error)throw h.error;const p=await h.json(),d=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const w=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=w}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},p),c),error:null}}catch(c){if(ee(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Gr(e);try{return await le(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ur})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Gr(e);try{return await le(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:ur})}catch(s){if(ee(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,r=!1){Gr(e);try{return await le(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:ur})}catch(s){if(ee(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Gr(e.userId);try{const{data:r,error:s}=await le(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:r,error:s}}catch(r){if(ee(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Gr(e.userId),Gr(e.id);try{return{data:await le(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(ee(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,s,n,a,i,o,l;try{const c={nextPage:null,lastPage:0,total:0},h=await le(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(a=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&a!==void 0?a:""},xform:yi});if(h.error)throw h.error;const p=await h.json(),d=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const w=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=w}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},p),c),error:null}}catch(c){if(ee(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await le(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ee(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await le(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ee(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await le(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ee(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await le(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ee(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await le(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ee(r))return{data:null,error:r};throw r}}}function bi(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const Jr={debug:!!(globalThis&&qo()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Fo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ph extends Fo{}async function $h(t,e,r){Jr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Jr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Jr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await r()}finally{Jr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(e===0)throw Jr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Ph(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Jr.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Mh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function zo(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Dh(t){return parseInt(t,16)}function Nh(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function Uh(t){var e;const{chainId:r,domain:s,expirationTime:n,issuedAt:a=new Date,nonce:i,notBefore:o,requestId:l,resources:c,scheme:h,uri:p,version:d}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!p)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=zo(t.address),g=h?`${h}://${s}`:s,w=t.statement?`${t.statement}
`:"",v=`${g} wants you to sign in with your Ethereum account:
${f}

${w}`;let k=`URI: ${p}
Version: ${d}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${a.toISOString()}`;if(n&&(k+=`
Expiration Time: ${n.toISOString()}`),o&&(k+=`
Not Before: ${o.toISOString()}`),l&&(k+=`
Request ID: ${l}`),c){let R=`
Resources:`;for(const O of c){if(!O||typeof O!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${O}`);R+=`
- ${O}`}k+=R}return`${v}
${k}`}class ze extends Error{constructor({message:e,code:r,cause:s,name:n}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(a=n??(s instanceof Error?s.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=r}}class fn extends ze{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function Lh({error:t,options:e}){var r,s,n;const{publicKey:a}=e;if(!a)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ze({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=a.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new ze({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=a.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new ze({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((n=a.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new ze({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new ze({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new ze({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return a.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new ze({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new ze({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const i=window.location.hostname;if(Vo(i)){if(a.rp.id!==i)return new ze({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ze({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new ze({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new ze({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ze({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function qh({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ze({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new ze({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(Vo(s)){if(r.rpId!==s)return new ze({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ze({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new ze({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ze({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class Bh{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Fh=new Bh;function zh(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:s}=t,n=Tn(t,["challenge","user","excludeCredentials"]),a=ss(e).buffer,i=Object.assign(Object.assign({},r),{id:ss(r.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:a,user:i});if(s&&s.length>0){o.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];o.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:ss(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function Vh(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,s=Tn(t,["challenge","allowCredentials"]),n=ss(e).buffer,a=Object.assign(Object.assign({},s),{challenge:n});if(r&&r.length>0){a.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const o=r[i];a.allowCredentials[i]=Object.assign(Object.assign({},o),{id:ss(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return a}function Wh(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Or(new Uint8Array(t.response.attestationObject)),clientDataJSON:Or(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Kh(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,s=t.getClientExtensionResults(),n=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Or(new Uint8Array(n.authenticatorData)),clientDataJSON:Or(new Uint8Array(n.clientDataJSON)),signature:Or(new Uint8Array(n.signature)),userHandle:n.userHandle?Or(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Vo(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function ki(){var t,e;return!!(Qe()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Hh(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fn("Browser returned unexpected credential type",e)}:{data:null,error:new fn("Empty credential response",e)}}catch(e){return{data:null,error:Lh({error:e,options:t})}}}async function Gh(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fn("Browser returned unexpected credential type",e)}:{data:null,error:new fn("Empty credential response",e)}}catch(e){return{data:null,error:qh({error:e,options:t})}}}const Jh={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Yh={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function vn(...t){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),r=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of t)if(n)for(const a in n){const i=n[a];if(i!==void 0)if(Array.isArray(i))s[a]=i;else if(r(i))s[a]=i;else if(e(i)){const o=s[a];e(o)?s[a]=vn(o,i):s[a]=vn(i)}else s[a]=i}return s}function Zh(t,e){return vn(Jh,t,e||{})}function Xh(t,e){return vn(Yh,t,e||{})}class Qh{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:s,signal:n},a){try{const{data:i,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!i)return{data:null,error:o};const l=n??Fh.createNewAbortSignal();if(i.webauthn.type==="create"){const{user:c}=i.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${s}`),c.displayName||(c.displayName=c.name)}switch(i.webauthn.type){case"create":{const c=Zh(i.webauthn.credential_options.publicKey,a==null?void 0:a.create),{data:h,error:p}=await Hh({publicKey:c,signal:l});return h?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:h}},error:null}:{data:null,error:p}}case"request":{const c=Xh(i.webauthn.credential_options.publicKey,a==null?void 0:a.request),{data:h,error:p}=await Gh(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:c,signal:l}));return h?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:h}},error:null}:{data:null,error:p}}}}catch(i){return ee(i)?{data:null,error:i}:{data:null,error:new Er("Unexpected error in challenge",i)}}}async _verify({challengeId:e,factorId:r,webauthn:s}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},a){if(!r)return{data:null,error:new Ns("rpId is required for WebAuthn authentication")};try{if(!ki())return{data:null,error:new Er("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:s},signal:n},{request:a});if(!i)return{data:null,error:o};const{webauthn:l}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:s,credential_response:l.credential_response}})}catch(i){return ee(i)?{data:null,error:i}:{data:null,error:new Er("Unexpected error in authenticate",i)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},a){if(!r)return{data:null,error:new Ns("rpId is required for WebAuthn registration")};try{if(!ki())return{data:null,error:new Er("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(h=>{var p;return(p=h.data)===null||p===void 0?void 0:p.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:o};const{data:l,error:c}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:n},{create:a});return l?this._verify({factorId:i.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(i){return ee(i)?{data:null,error:i}:{data:null,error:new Er("Unexpected error in register",i)}}}}Mh();const ed={url:Ju,storageKey:Yu,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Zu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Si(t,e,r){return await r()}const Yr={};class Us{get jwks(){var e,r;return(r=(e=Yr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Yr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{cachedAt:e})}constructor(e){var r,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},ed),e);if(this.storageKey=a.storageKey,this.instanceID=(r=Us.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Us.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&Qe()){const i=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(i),this.logDebugMessages&&console.trace(i)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new jh({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Bo(a.fetch),this.lock=a.lock||Si,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&Qe()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=$h:this.lock=Si,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Qh(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:qo()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=bi(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=bi(this.memoryStorage)),Qe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${No}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},s="none";if(Qe()&&(r=dh(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":await this._isPKCECallback(r)&&(s="pkce")),Qe()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:a}=await this._getSessionFromURL(r,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),sh(a)){const l=(e=a.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:a}}return{error:a}}const{session:i,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return ee(r)?this._returnResult({error:r}):this._returnResult({error:new Er("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,s,n;try{const a=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:Ct}),{data:i,error:o}=a;if(o||!i)return this._returnResult({data:{user:null,session:null},error:o});const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(a){if(ee(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var r,s,n;try{let a;if("email"in e){const{email:h,password:p,options:d}=e;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Hr(this.storage,this.storageKey)),a=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:h,password:p,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:g},xform:Ct})}else if("phone"in e){const{phone:h,password:p,options:d}=e;a=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:p,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(n=d==null?void 0:d.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Ct})}else throw new tn("You must provide either an email or phone number and a password");const{data:i,error:o}=a;if(o||!i)return await Xe(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(a){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let r;if("email"in e){const{email:a,password:i,options:o}=e;r=await le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:wi})}else if("phone"in e){const{phone:a,password:i,options:o}=e;r=await le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:wi})}else throw new tn("You must provide either an email or phone number and a password");const{data:s,error:n}=r;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){const a=new Kr;return this._returnResult({data:{user:null,session:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(r){if(ee(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,s,n,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,s,n,a,i,o,l,c,h,p,d;let f,g;if("message"in e)f=e.message,g=e.signature;else{const{chain:w,wallet:v,statement:k,options:R}=e;let O;if(Qe())if(typeof v=="object")O=v;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")O=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(R!=null&&R.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=v}const E=new URL((r=R==null?void 0:R.url)!==null&&r!==void 0?r:window.location.href),A=await O.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!A||A.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const x=zo(A[0]);let j=(s=R==null?void 0:R.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!j){const P=await O.request({method:"eth_chainId"});j=Dh(P)}const I={domain:E.host,address:x,statement:k,uri:E.href,version:"1",chainId:j,nonce:(n=R==null?void 0:R.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(i=(a=R==null?void 0:R.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(o=R==null?void 0:R.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=R==null?void 0:R.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=R==null?void 0:R.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(h=R==null?void 0:R.signInWithEthereum)===null||h===void 0?void 0:h.resources};f=Uh(I),g=await O.request({method:"personal_sign",params:[Nh(f),x]})}try{const{data:w,error:v}=await le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:Ct});if(v)throw v;if(!w||!w.session||!w.user){const k=new Kr;return this._returnResult({data:{user:null,session:null},error:k})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:v})}catch(w){if(ee(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(e){var r,s,n,a,i,o,l,c,h,p,d,f;let g,w;if("message"in e)g=e.message,w=e.signature;else{const{chain:v,wallet:k,statement:R,options:O}=e;let E;if(Qe())if(typeof k=="object")E=k;else{const x=window;if("solana"in x&&typeof x.solana=="object"&&("signIn"in x.solana&&typeof x.solana.signIn=="function"||"signMessage"in x.solana&&typeof x.solana.signMessage=="function"))E=x.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof k!="object"||!(O!=null&&O.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=k}const A=new URL((r=O==null?void 0:O.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in E&&E.signIn){const x=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},O==null?void 0:O.signInWithSolana),{version:"1",domain:A.host,uri:A.href}),R?{statement:R}:null));let j;if(Array.isArray(x)&&x[0]&&typeof x[0]=="object")j=x[0];else if(x&&typeof x=="object"&&"signedMessage"in x&&"signature"in x)j=x;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in j&&"signature"in j&&(typeof j.signedMessage=="string"||j.signedMessage instanceof Uint8Array)&&j.signature instanceof Uint8Array)g=typeof j.signedMessage=="string"?j.signedMessage:new TextDecoder().decode(j.signedMessage),w=j.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${A.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...R?["",R,""]:[""],"Version: 1",`URI: ${A.href}`,`Issued At: ${(n=(s=O==null?void 0:O.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((a=O==null?void 0:O.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${O.signInWithSolana.notBefore}`]:[],...!((i=O==null?void 0:O.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${O.signInWithSolana.expirationTime}`]:[],...!((o=O==null?void 0:O.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${O.signInWithSolana.chainId}`]:[],...!((l=O==null?void 0:O.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${O.signInWithSolana.nonce}`]:[],...!((c=O==null?void 0:O.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${O.signInWithSolana.requestId}`]:[],...!((p=(h=O==null?void 0:O.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||p===void 0)&&p.length?["Resources",...O.signInWithSolana.resources.map(j=>`- ${j}`)]:[]].join(`
`);const x=await E.signMessage(new TextEncoder().encode(g),"utf8");if(!x||!(x instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=x}}try{const{data:v,error:k}=await le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Or(w)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Ct});if(k)throw k;if(!v||!v.session||!v.user){const R=new Kr;return this._returnResult({data:{user:null,session:null},error:R})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:k})}catch(v){if(ee(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const r=await br(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(r??"").split("/");try{if(!s&&this.flowType==="pkce")throw new nh;const{data:a,error:i}=await le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Ct});if(await Xe(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!a||!a.session||!a.user){const o=new Kr;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:n??null}),error:i})}catch(a){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:r,provider:s,token:n,access_token:a,nonce:i}=e,o=await le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:a,nonce:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Ct}),{data:l,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const h=new Kr;return this._returnResult({data:{user:null,session:null},error:h})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(r){if(ee(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,s,n,a,i;try{if("email"in e){const{email:o,options:l}=e;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await Hr(this.storage,this.storageKey));const{error:p}=await le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:p})}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:h}=await le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(a=l==null?void 0:l.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(i=l==null?void 0:l.channel)!==null&&i!==void 0?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:h})}throw new tn("You must provide either an email or phone number.")}catch(o){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var r,s;try{let n,a;"options"in e&&(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo,a=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:i,error:o}=await le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:n,xform:Ct});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if(ee(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var r,s,n,a,i;try{let o=null,l=null;this.flowType==="pkce"&&([o,l]=await Hr(this.storage,this.storageKey));const c=await le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:l}),headers:this.headers,xform:Rh});return!((a=c.data)===null||a===void 0)&&a.url&&Qe()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(o){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;if(s)throw s;if(!r)throw new vt;const{error:n}=await le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(ee(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:a}=e,{error:i}=await le(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}else if("phone"in e){const{phone:s,type:n,options:a}=e,{data:i,error:o}=await le(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:o})}throw new tn("You must provide either an email or phone number and a type")}catch(r){if(ee(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await r()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=r();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await br(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Nn:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const i=await br(this.userStorage,this.storageKey+"-user");i!=null&&i.user?e.user=i.user:e.user=qn()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const i={value:this.suppressGetSessionWarning};e.user=Th(e.user,i),i.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ur}):await this._useSession(async r=>{var s,n,a;const{data:i,error:o}=r;if(o)throw o;return!(!((s=i.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new vt}:await le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0,xform:ur})})}catch(r){if(ee(r))return rh(r)&&(await this._removeSession(),await Xe(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async s=>{const{data:n,error:a}=s;if(a)throw a;if(!n.session)throw new vt;const i=n.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Hr(this.storage,this.storageKey));const{data:c,error:h}=await le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:i.access_token,xform:ur});if(h)throw h;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(s){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new vt;const r=Date.now()/1e3;let s=r,n=!0,a=null;const{payload:i}=Ln(e.access_token);if(i.exp&&(s=i.exp,n=s<=r),n){const{data:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o)return{data:{user:null,session:null},error:null};a=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;a={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-r,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(r){if(ee(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var s;if(!e){const{data:i,error:o}=r;if(o)throw o;e=(s=i.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new vt;const{data:n,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(ee(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!Qe())throw new rn("No browser detected.");if(e.error||e.error_description||e.error_code)throw new rn(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new di("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new rn("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new di("No code detected.");const{data:R,error:O}=await this._exchangeCodeForSession(e.code);if(O)throw O;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:R.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:a,refresh_token:i,expires_in:o,expires_at:l,token_type:c}=e;if(!a||!o||!i||!c)throw new rn("No session defined in URL");const h=Math.round(Date.now()/1e3),p=parseInt(o);let d=h+p;l&&(d=parseInt(l));const f=d-h;f*1e3<=Qr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${p}s`);const g=d-p;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,d,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,d,h);const{data:w,error:v}=await this._getUser(a);if(v)throw v;const k={provider_token:s,provider_refresh_token:n,access_token:a,expires_in:p,expires_at:d,refresh_token:i,token_type:c,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:k,redirectType:e.type},error:null})}catch(s){if(ee(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await br(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var s;const{data:n,error:a}=r;if(a)return this._returnResult({error:a});const i=(s=n.session)===null||s===void 0?void 0:s.access_token;if(i){const{error:o}=await this.admin.signOut(i,e);if(o&&!(th(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await Xe(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=hh(),s={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async r=>{var s,n;try{const{data:{session:a},error:i}=r;if(i)throw i;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,r={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Hr(this.storage,this.storageKey,!0));try{return await le(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(a){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:r,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:s,error:n}=await this._useSession(async a=>{var i,o,l,c,h;const{data:p,error:d}=a;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await le(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(c=p.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(n)throw n;return Qe()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(ee(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var s;try{const{error:n,data:{session:a}}=r;if(n)throw n;const{options:i,provider:o,token:l,access_token:c,nonce:h}=e,p=await le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=a==null?void 0:a.access_token)!==null&&s!==void 0?s:void 0,body:{provider:o,id_token:l,access_token:c,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Ct}),{data:d,error:f}=p;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new Kr}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(n){if(await Xe(this.storage,`${this.storageKey}-code-verifier`),ee(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var s,n;const{data:a,error:i}=r;if(i)throw i;return await le(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const s=Date.now();return await ph(async n=>(n>0&&await vh(200*Math.pow(2,n-1)),this._debug(r,"refreshing attempt",n),await le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ct})),(n,a)=>{const i=200*Math.pow(2,n);return a&&Un(a)&&Date.now()+i-s<Qr})}catch(s){if(this._debug(r,"error",s),ee(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",s),Qe()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await br(this.storage,this.storageKey);if(n&&this.userStorage){let i=await br(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:n.user},await es(this.userStorage,this.storageKey+"-user",i)),n.user=(e=i==null?void 0:i.user)!==null&&e!==void 0?e:qn()}else if(n&&!n.user&&!n.user){const i=await br(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(n.user=i.user,await Xe(this.storage,this.storageKey+"-user"),await es(this.storage,this.storageKey,n)):n.user=qn()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const a=((r=n.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Nn;if(this._debug(s,`session has${a?"":" not"} expired with margin of ${Nn}s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:i}=await this._callRefreshToken(n.refresh_token);i&&(console.error(i),Un(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:o}=await this._getUser(n.access_token);!o&&(i!=null&&i.user)?(n.user=i.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(s,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var r,s;if(!e)throw new vt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new An;const{data:a,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!a.session)throw new vt;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const o={data:a.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(a){if(this._debug(n,"error",a),ee(a)){const i={data:null,error:a};return Un(a)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,r,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:r});const a=[],i=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,r)}catch(l){a.push(l)}});if(await Promise.all(i),a.length>0){for(let o=0;o<a.length;o+=1)console.error(a[o]);throw a[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Xe(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&await es(this.userStorage,this.storageKey+"-user",{user:r.user});const n=Object.assign({},r);delete n.user;const a=mi(n);await es(this.storage,this.storageKey,a)}else{const n=mi(r);await es(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Xe(this.storage,this.storageKey),await Xe(this.storage,this.storageKey+"-code-verifier"),await Xe(this.storage,this.storageKey+"-user"),this.userStorage&&await Xe(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Qe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Qr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Qr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Qr}ms, refresh threshold is ${ua} ticks`),n<=ua&&await this._callRefreshToken(s.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Fo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Qe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,s){const n=[`provider=${encodeURIComponent(r)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[a,i]=await Hr(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(i)}`});n.push(o.toString())}if(s!=null&&s.queryParams){const a=new URLSearchParams(s.queryParams);n.push(a.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var s;const{data:n,error:a}=r;return a?this._returnResult({data:null,error:a}):await le(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var s,n;const{data:a,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await le(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=a==null?void 0:a.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:a}=r;if(a)return this._returnResult({data:null,error:a});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Wh(e.webauthn.credential_response):Kh(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:l}=await le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:l}))})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:a}=r;if(a)return this._returnResult({data:null,error:a});const i=await le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});if(i.error)return i;const{data:o}=i;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:zh(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Vh(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const a of(e=r==null?void 0:r.factors)!==null&&e!==void 0?e:[])n.all.push(a),a.status==="verified"&&n[a.factor_type].push(a);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,r;const{data:{session:s},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Ln(s.access_token);let i=null;a.aal&&(i=a.aal);let o=i;((r=(e=s.user.factors)===null||e===void 0?void 0:e.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(o="aal2");const c=a.amr||[];return{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?await le(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new vt})})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!n)return this._returnResult({data:null,error:new vt});const i=await le(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return i.data&&i.data.redirect_url&&Qe()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(s){if(ee(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!n)return this._returnResult({data:null,error:new vt});const i=await le(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return i.data&&i.data.redirect_url&&Qe()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(s){if(ee(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;return s?this._returnResult({data:null,error:s}):r?await le(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new vt})})}catch(e){if(ee(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?(await le(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new vt})})}catch(r){if(ee(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let s=r.keys.find(o=>o.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+Qu>n)return s;const{data:a,error:i}=await le(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=n,s=a.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,r={}){try{let s=e;if(!s){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});s=f.session.access_token}const{header:n,payload:a,signature:i,raw:{header:o,payload:l}}=Ln(s);r!=null&&r.allowExpired||kh(a.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!c){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:a,header:n,signature:i},error:null}}const h=Sh(n.alg),p=await crypto.subtle.importKey("jwk",c,h,!0,["verify"]);if(!await crypto.subtle.verify(h,p,i,ch(`${o}.${l}`)))throw new fa("Invalid JWT signature");return{data:{claims:a,header:n,signature:i},error:null}}catch(s){if(ee(s))return this._returnResult({data:null,error:s});throw s}}}Us.nextInstanceID={};const td=Us,rd="2.90.1";let Ts="";typeof Deno<"u"?Ts="deno":typeof document<"u"?Ts="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ts="react-native":Ts="node";const sd={"X-Client-Info":`supabase-js-${Ts}/${rd}`},nd={headers:sd},ad={schema:"public"},id={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},od={};function Ls(t){"@babel/helpers - typeof";return Ls=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ls(t)}function ld(t,e){if(Ls(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(Ls(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function cd(t){var e=ld(t,"string");return Ls(e)=="symbol"?e:e+""}function ud(t,e,r){return(e=cd(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ei(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Ne(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ei(Object(r),!0).forEach(function(s){ud(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ei(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const hd=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),dd=()=>Headers,fd=(t,e,r)=>{const s=hd(r),n=dd();return async(a,i)=>{var o;const l=(o=await e())!==null&&o!==void 0?o:t;let c=new n(i==null?void 0:i.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(a,Ne(Ne({},i),{},{headers:c}))}};function vd(t){return t.endsWith("/")?t:t+"/"}function pd(t,e){var r,s;const{db:n,auth:a,realtime:i,global:o}=t,{db:l,auth:c,realtime:h,global:p}=e,d={db:Ne(Ne({},l),n),auth:Ne(Ne({},c),a),realtime:Ne(Ne({},h),i),storage:{},global:Ne(Ne(Ne({},p),o),{},{headers:Ne(Ne({},(r=p==null?void 0:p.headers)!==null&&r!==void 0?r:{}),(s=o==null?void 0:o.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}function gd(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(vd(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var md=class extends td{constructor(t){super(t)}},_d=class{constructor(t,e,r){var s,n;this.supabaseUrl=t,this.supabaseKey=e;const a=gd(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const i=`sb-${a.hostname.split(".")[0]}-auth-token`,o={db:ad,realtime:od,auth:Ne(Ne({},id),{},{storageKey:i}),global:nd},l=pd(r??{},o);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=l.global.headers)!==null&&n!==void 0?n:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=fd(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Ne({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new Zc(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Gu(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Kc(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:s}=await t.auth.getSession();return(e=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:a,flowType:i,lock:o,debug:l,throwOnError:c},h,p){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new md({url:this.authUrl.href,headers:Ne(Ne({},d),h),storageKey:a,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,flowType:i,lock:o,debug:l,throwOnError:c,fetch:p,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new vu(this.realtimeUrl.href,Ne(Ne({},t),{},{params:Ne(Ne({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const wd=(t,e,r)=>new _d(t,e,r);function yd(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}yd()&&console.warn("â ï¸  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const bd="https://ibgkltqlgbafpoljizdu.supabase.co",kd="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImliZ2tsdHFsZ2JhZnBvbGppemR1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMjU1NzksImV4cCI6MjA2NDkwMTU3OX0.Awa-Gdd3b4uR_1MnQySyA5s6hfVfyZB6jlVS1Jj_Afk",me=wd(bd,kd);$l();var Sd=z('<button class="open-sidebar-icon icon svelte-1hv2e3s">â¡</button> <aside><div class="sidebar-header svelte-1hv2e3s"><img src="https://raw.githubusercontent.com/Ewan-Dev/ewan.is-a.dev/refs/heads/main/frontend/static/loquela.png" class="logo svelte-1hv2e3s" alt="loquela logo"/> <button class="close-sidebar-icon icon svelte-1hv2e3s">X</button></div> <nav class="sidebar-nav svelte-1hv2e3s"><a href="./#/app/home"><span class="material-symbols-rounded svelte-1hv2e3s">home</span> Home</a> <a href="./#/app/music"><span class="material-symbols-rounded svelte-1hv2e3s">music_note</span> Music</a> <a href="./#/app/videos"><span class="material-symbols-rounded svelte-1hv2e3s">movie</span> Videos</a> <a href="./#/app/upload"><span class="material-symbols-rounded svelte-1hv2e3s">upload</span> Upload</a> <a href="./#/app/flashcards"><span class="material-symbols-rounded svelte-1hv2e3s">cards_star</span> Flashcards</a> <a href="./#/app/ai-chat"><span class="material-symbols-rounded svelte-1hv2e3s">chat</span> AI Chat</a></nav></aside>',1);function Jt(t,e){let r=Ee(e,"currentPage",8,""),s=mr(!1);function n(){m(s,!u(s))}var a=Sd(),i=Re(a);i.__click=n;var o=y(i,2);let l;var c=b(o),h=y(b(c),2);h.__click=n;var p=y(c,2),d=b(p);let f;var g=y(d,2);let w;var v=y(g,2);let k;var R=y(v,2);let O;var E=y(R,2);let A;var x=y(E,2);let j;fe(()=>{l=mt(o,1,"sidebar svelte-1hv2e3s",null,l,{show:u(s)}),f=mt(d,1,"svelte-1hv2e3s",null,f,{selected:r()==="/home"}),w=mt(g,1,"svelte-1hv2e3s",null,w,{selected:r()==="/music"}),k=mt(v,1,"svelte-1hv2e3s",null,k,{selected:r()==="/videos"}),O=mt(R,1,"svelte-1hv2e3s",null,O,{selected:r()==="/upload"}),A=mt(E,1,"svelte-1hv2e3s",null,A,{selected:r()==="/flashcards"}),j=mt(x,1,"svelte-1hv2e3s",null,j,{selected:r()==="/ai-chat"})}),N(t,a)}Fr(["click"]);var Ed=z('<main class="route svelte-1nmp6pz"><!> <section class="main-page"><h1 class="page-header">Home</h1> <section class="main-content"><h1>ð Hello, welcome back.</h1></section></section></main>');function Td(t,e){Ue(e,!1),ft(async()=>{const{data:{user:n}}=await me.auth.getUser();console.log(n)}),Ta();var r=Ed(),s=b(r);Jt(s,{currentPage:"/home"}),N(t,r),Le()}const Od=t=>t;function Ad(t,{delay:e=0,duration:r=400,easing:s=Od}={}){const n=+getComputedStyle(t).opacity;return{delay:e,duration:r,easing:s,css:a=>`opacity: ${a*n}`}}var xd=z('<section role="status"><span> </span> <p> </p></section>');function ar(t,e){Ue(e,!0);let r=Ee(e,"type",3,"info"),s=Ee(e,"message",3,"Information"),n=Ee(e,"width",3,"100%"),a={info:"info",error:"error",success:"check_circle",warn:"warning"},i,o=T(!0);Oe(()=>(m(o,!1),s()&&(m(o,!0),clearTimeout(i),i=setTimeout(()=>{m(o,!1)},5e3)),()=>{m(o,!1),clearTimeout(i)}));var l=nr(),c=Re(l);{var h=p=>{var d=xd(),f=b(d),g=b(f),w=y(f,2),v=b(w);fe(()=>{Rc(d,`width:${n()??""};`),mt(d,1,hn(r()),"svelte-1o9ullj"),mt(f,1,`${r()} material-symbols-rounded`,"svelte-1o9ullj"),re(g,a[r()]),mt(w,1,hn(r()),"svelte-1o9ullj"),re(v,s())}),Tc(3,d,()=>Ad,()=>({duration:400})),N(p,d)};ve(c,p=>{u(o)&&p(h)})}N(t,l),Le()}var ja={};(function t(e,r,s,n){var a=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),i=typeof Path2D=="function"&&typeof DOMMatrix=="function",o=function(){if(!e.OffscreenCanvas)return!1;try{var S=new OffscreenCanvas(1,1),_=S.getContext("2d");_.fillRect(0,0,1,1);var U=S.transferToImageBitmap();_.createPattern(U,"no-repeat")}catch{return!1}return!0}();function l(){}function c(S){var _=r.exports.Promise,U=_!==void 0?_:e.Promise;return typeof U=="function"?new U(S):(S(l,l),null)}var h=function(S,_){return{transform:function(U){if(S)return U;if(_.has(U))return _.get(U);var K=new OffscreenCanvas(U.width,U.height),Y=K.getContext("2d");return Y.drawImage(U,0,0),_.set(U,K),K},clear:function(){_.clear()}}}(o,new Map),p=function(){var S=Math.floor(16.666666666666668),_,U,K={},Y=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(_=function(X){var ne=Math.random();return K[ne]=requestAnimationFrame(function D(V){Y===V||Y+S-1<V?(Y=V,delete K[ne],X()):K[ne]=requestAnimationFrame(D)}),ne},U=function(X){K[X]&&cancelAnimationFrame(K[X])}):(_=function(X){return setTimeout(X,S)},U=function(X){return clearTimeout(X)}),{frame:_,cancel:U}}(),d=function(){var S,_,U={};function K(Y){function X(ne,D){Y.postMessage({options:ne||{},callback:D})}Y.init=function(D){var V=D.transferControlToOffscreen();Y.postMessage({canvas:V},[V])},Y.fire=function(D,V,se){if(_)return X(D,null),_;var ie=Math.random().toString(36).slice(2);return _=c(function(oe){function ue(Te){Te.data.callback===ie&&(delete U[ie],Y.removeEventListener("message",ue),_=null,h.clear(),se(),oe())}Y.addEventListener("message",ue),X(D,ie),U[ie]=ue.bind(null,{data:{callback:ie}})}),_},Y.reset=function(){Y.postMessage({reset:!0});for(var D in U)U[D](),delete U[D]}}return function(){if(S)return S;if(!s&&a){var Y=["var CONFETTI, SIZE = {}, module = {};","("+t.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{S=new Worker(URL.createObjectURL(new Blob([Y])))}catch(X){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ð Could not load worker",X),null}K(S)}return S}}(),f={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function g(S,_){return _?_(S):S}function w(S){return S!=null}function v(S,_,U){return g(S&&w(S[_])?S[_]:f[_],U)}function k(S){return S<0?0:Math.floor(S)}function R(S,_){return Math.floor(Math.random()*(_-S))+S}function O(S){return parseInt(S,16)}function E(S){return S.map(A)}function A(S){var _=String(S).replace(/[^0-9a-f]/gi,"");return _.length<6&&(_=_[0]+_[0]+_[1]+_[1]+_[2]+_[2]),{r:O(_.substring(0,2)),g:O(_.substring(2,4)),b:O(_.substring(4,6))}}function x(S){var _=v(S,"origin",Object);return _.x=v(_,"x",Number),_.y=v(_,"y",Number),_}function j(S){S.width=document.documentElement.clientWidth,S.height=document.documentElement.clientHeight}function I(S){var _=S.getBoundingClientRect();S.width=_.width,S.height=_.height}function P(S){var _=document.createElement("canvas");return _.style.position="fixed",_.style.top="0px",_.style.left="0px",_.style.pointerEvents="none",_.style.zIndex=S,_}function M(S,_,U,K,Y,X,ne,D,V){S.save(),S.translate(_,U),S.rotate(X),S.scale(K,Y),S.arc(0,0,1,ne,D,V),S.restore()}function G(S){var _=S.angle*(Math.PI/180),U=S.spread*(Math.PI/180);return{x:S.x,y:S.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:S.startVelocity*.5+Math.random()*S.startVelocity,angle2D:-_+(.5*U-Math.random()*U),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:S.color,shape:S.shape,tick:0,totalTicks:S.ticks,decay:S.decay,drift:S.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:S.gravity*3,ovalScalar:.6,scalar:S.scalar,flat:S.flat}}function W(S,_){_.x+=Math.cos(_.angle2D)*_.velocity+_.drift,_.y+=Math.sin(_.angle2D)*_.velocity+_.gravity,_.velocity*=_.decay,_.flat?(_.wobble=0,_.wobbleX=_.x+10*_.scalar,_.wobbleY=_.y+10*_.scalar,_.tiltSin=0,_.tiltCos=0,_.random=1):(_.wobble+=_.wobbleSpeed,_.wobbleX=_.x+10*_.scalar*Math.cos(_.wobble),_.wobbleY=_.y+10*_.scalar*Math.sin(_.wobble),_.tiltAngle+=.1,_.tiltSin=Math.sin(_.tiltAngle),_.tiltCos=Math.cos(_.tiltAngle),_.random=Math.random()+2);var U=_.tick++/_.totalTicks,K=_.x+_.random*_.tiltCos,Y=_.y+_.random*_.tiltSin,X=_.wobbleX+_.random*_.tiltCos,ne=_.wobbleY+_.random*_.tiltSin;if(S.fillStyle="rgba("+_.color.r+", "+_.color.g+", "+_.color.b+", "+(1-U)+")",S.beginPath(),i&&_.shape.type==="path"&&typeof _.shape.path=="string"&&Array.isArray(_.shape.matrix))S.fill(ae(_.shape.path,_.shape.matrix,_.x,_.y,Math.abs(X-K)*.1,Math.abs(ne-Y)*.1,Math.PI/10*_.wobble));else if(_.shape.type==="bitmap"){var D=Math.PI/10*_.wobble,V=Math.abs(X-K)*.1,se=Math.abs(ne-Y)*.1,ie=_.shape.bitmap.width*_.scalar,oe=_.shape.bitmap.height*_.scalar,ue=new DOMMatrix([Math.cos(D)*V,Math.sin(D)*V,-Math.sin(D)*se,Math.cos(D)*se,_.x,_.y]);ue.multiplySelf(new DOMMatrix(_.shape.matrix));var Te=S.createPattern(h.transform(_.shape.bitmap),"no-repeat");Te.setTransform(ue),S.globalAlpha=1-U,S.fillStyle=Te,S.fillRect(_.x-ie/2,_.y-oe/2,ie,oe),S.globalAlpha=1}else if(_.shape==="circle")S.ellipse?S.ellipse(_.x,_.y,Math.abs(X-K)*_.ovalScalar,Math.abs(ne-Y)*_.ovalScalar,Math.PI/10*_.wobble,0,2*Math.PI):M(S,_.x,_.y,Math.abs(X-K)*_.ovalScalar,Math.abs(ne-Y)*_.ovalScalar,Math.PI/10*_.wobble,0,2*Math.PI);else if(_.shape==="star")for(var he=Math.PI/2*3,je=4*_.scalar,We=8*_.scalar,qe=_.x,Ge=_.y,Je=5,Fe=Math.PI/Je;Je--;)qe=_.x+Math.cos(he)*We,Ge=_.y+Math.sin(he)*We,S.lineTo(qe,Ge),he+=Fe,qe=_.x+Math.cos(he)*je,Ge=_.y+Math.sin(he)*je,S.lineTo(qe,Ge),he+=Fe;else S.moveTo(Math.floor(_.x),Math.floor(_.y)),S.lineTo(Math.floor(_.wobbleX),Math.floor(Y)),S.lineTo(Math.floor(X),Math.floor(ne)),S.lineTo(Math.floor(K),Math.floor(_.wobbleY));return S.closePath(),S.fill(),_.tick<_.totalTicks}function $(S,_,U,K,Y){var X=_.slice(),ne=S.getContext("2d"),D,V,se=c(function(ie){function oe(){D=V=null,ne.clearRect(0,0,K.width,K.height),h.clear(),Y(),ie()}function ue(){s&&!(K.width===n.width&&K.height===n.height)&&(K.width=S.width=n.width,K.height=S.height=n.height),!K.width&&!K.height&&(U(S),K.width=S.width,K.height=S.height),ne.clearRect(0,0,K.width,K.height),X=X.filter(function(Te){return W(ne,Te)}),X.length?D=p.frame(ue):oe()}D=p.frame(ue),V=oe});return{addFettis:function(ie){return X=X.concat(ie),se},canvas:S,promise:se,reset:function(){D&&p.cancel(D),V&&V()}}}function L(S,_){var U=!S,K=!!v(_||{},"resize"),Y=!1,X=v(_,"disableForReducedMotion",Boolean),ne=a&&!!v(_||{},"useWorker"),D=ne?d():null,V=U?j:I,se=S&&D?!!S.__confetti_initialized:!1,ie=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,oe;function ue(he,je,We){for(var qe=v(he,"particleCount",k),Ge=v(he,"angle",Number),Je=v(he,"spread",Number),Fe=v(he,"startVelocity",Number),te=v(he,"decay",Number),pe=v(he,"gravity",Number),we=v(he,"drift",Number),F=v(he,"colors",E),Q=v(he,"ticks",Number),_e=v(he,"shapes"),De=v(he,"scalar"),be=!!v(he,"flat"),Ae=x(he),Ye=qe,Ce=[],Yt=S.width*Ae.x,kt=S.height*Ae.y;Ye--;)Ce.push(G({x:Yt,y:kt,angle:Ge,spread:Je,startVelocity:Fe,color:F[Ye%F.length],shape:_e[R(0,_e.length)],ticks:Q,decay:te,gravity:pe,drift:we,scalar:De,flat:be}));return oe?oe.addFettis(Ce):(oe=$(S,Ce,V,je,We),oe.promise)}function Te(he){var je=X||v(he,"disableForReducedMotion",Boolean),We=v(he,"zIndex",Number);if(je&&ie)return c(function(Fe){Fe()});U&&oe?S=oe.canvas:U&&!S&&(S=P(We),document.body.appendChild(S)),K&&!se&&V(S);var qe={width:S.width,height:S.height};D&&!se&&D.init(S),se=!0,D&&(S.__confetti_initialized=!0);function Ge(){if(D){var Fe={getBoundingClientRect:function(){if(!U)return S.getBoundingClientRect()}};V(Fe),D.postMessage({resize:{width:Fe.width,height:Fe.height}});return}qe.width=qe.height=null}function Je(){oe=null,K&&(Y=!1,e.removeEventListener("resize",Ge)),U&&S&&(document.body.contains(S)&&document.body.removeChild(S),S=null,se=!1)}return K&&!Y&&(Y=!0,e.addEventListener("resize",Ge,!1)),D?D.fire(he,qe,Je):ue(he,qe,Je)}return Te.reset=function(){D&&D.reset(),oe&&oe.reset()},Te}var q;function J(){return q||(q=L(null,{useWorker:!0,resize:!0})),q}function ae(S,_,U,K,Y,X,ne){var D=new Path2D(S),V=new Path2D;V.addPath(D,new DOMMatrix(_));var se=new Path2D;return se.addPath(V,new DOMMatrix([Math.cos(ne)*Y,Math.sin(ne)*Y,-Math.sin(ne)*X,Math.cos(ne)*X,U,K])),se}function B(S){if(!i)throw new Error("path confetti are not supported in this browser");var _,U;typeof S=="string"?_=S:(_=S.path,U=S.matrix);var K=new Path2D(_),Y=document.createElement("canvas"),X=Y.getContext("2d");if(!U){for(var ne=1e3,D=ne,V=ne,se=0,ie=0,oe,ue,Te=0;Te<ne;Te+=2)for(var he=0;he<ne;he+=2)X.isPointInPath(K,Te,he,"nonzero")&&(D=Math.min(D,Te),V=Math.min(V,he),se=Math.max(se,Te),ie=Math.max(ie,he));oe=se-D,ue=ie-V;var je=10,We=Math.min(je/oe,je/ue);U=[We,0,0,We,-Math.round(oe/2+D)*We,-Math.round(ue/2+V)*We]}return{type:"path",path:_,matrix:U}}function Z(S){var _,U=1,K="#000000",Y='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof S=="string"?_=S:(_=S.text,U="scalar"in S?S.scalar:U,Y="fontFamily"in S?S.fontFamily:Y,K="color"in S?S.color:K);var X=10*U,ne=""+X+"px "+Y,D=new OffscreenCanvas(X,X),V=D.getContext("2d");V.font=ne;var se=V.measureText(_),ie=Math.ceil(se.actualBoundingBoxRight+se.actualBoundingBoxLeft),oe=Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent),ue=2,Te=se.actualBoundingBoxLeft+ue,he=se.actualBoundingBoxAscent+ue;ie+=ue+ue,oe+=ue+ue,D=new OffscreenCanvas(ie,oe),V=D.getContext("2d"),V.font=ne,V.fillStyle=K,V.fillText(_,Te,he);var je=1/U;return{type:"bitmap",bitmap:D.transferToImageBitmap(),matrix:[je,0,0,je,-ie*je/2,-oe*je/2]}}r.exports=function(){return J().apply(this,arguments)},r.exports.reset=function(){J().reset()},r.exports.create=L,r.exports.shapeFromPath=B,r.exports.shapeFromText=Z})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),ja,!1);const ws=ja.exports;ja.exports.create;var Rd=z(`<main class="svelte-1lzp8li"><h1>Signup</h1> <form class="svelte-1lzp8li"><label for="email" class="svelte-1lzp8li">Email:</label> <input class="email svelte-1lzp8li" type="email"/> <label for="password" class="svelte-1lzp8li">Password:</label> <input class="password svelte-1lzp8li" type="password"/> <button class="sign-up svelte-1lzp8li" type="submit">Sign up</button> <!></form> <p style="color:red;">Please use a well established mail client such as Outlook or Gmail as temporary email services don't allow the link to work properly.</p></main>`);function Cd(t,e){Ue(e,!0);let r=T(""),s=T(""),n="",a=T(H(n.statusError)),i=T(H(n.statusType));async function o(){await l()}async function l(){console.log("Signing up...");let{data:v,error:k}=await me.auth.signUp({email:u(r),password:u(s),options:{emailRedirectTo:"https://ewan.is-a.dev/#/app/login/"}});k&&k.message.includes("Password should contain at least one character of each")?(m(a,""),m(i,""),m(a,"Password must contain capital letters, lowercase letters, numbers and special characters."),m(i,"warn")):k&&k.message?(m(i,""),m(i,"error"),m(a,""),m(a,k.message,!0)):v&&!k&&(m(a,"Signup successful! Check your email to confirm."),m(i,"success"),console.log("User signed up successfully",v),c())}function c(){ws({particleCount:200,spread:70,origin:{y:.6}})}var h=Rd(),p=y(b(h),2),d=y(b(p),2),f=y(d,4),g=y(f,4);{var w=v=>{ar(v,{get type(){return u(i)},get message(){return u(a)}})};ve(g,v=>{u(a)&&u(i)&&v(w)})}lt("submit",p,v=>{v.preventDefault(),o()}),Rt(d,()=>u(r),v=>m(r,v)),Rt(f,()=>u(s),v=>m(s,v)),N(t,h),Le()}var Id=z('<!> <p>Continue <a href="./#/app/home">here</a></p>',1),jd=z('<main class="route svelte-1x05zx6"><section class="main-page"><h1 class="page-header">Login</h1> <section class="main-content"><form class="svelte-1x05zx6"><label for="email" class="svelte-1x05zx6">Email:</label> <input class="email svelte-1x05zx6" type="email"/> <label for="password" class="svelte-1x05zx6">Password:</label> <input class="password svelte-1x05zx6" type="password"/> <button class="log-in svelte-1x05zx6" type="submit">Sign in</button> <!> <!></form></section></section></main>');function Ti(t,e){Ue(e,!0);let r=T(""),s=T(""),n="",a=T(""),i=T("");async function o(){let{data:E,error:A}=await me.auth.signInWithPassword({email:u(r),password:u(s)});A?(A&&A.message.includes("profiles_email_key")&&m(a,""),m(a,A.message,!0)):(m(i,E,!0),console.log("Login successful",n),m(a,""),c(),l(E.user.email))}async function l(E){const{error:A}=await me.from("profiles").insert({email:E});A&&A.message?console.error(A.message):A||(m(a,""),console.log("User added to profiles table"))}function c(){ws({particleCount:200,spread:70,origin:{y:.6}})}var h=jd(),p=b(h),d=y(b(p),2),f=b(d),g=y(b(f),2),w=y(g,4),v=y(w,4);{var k=E=>{ar(E,{type:"error",get message(){return u(a)}})};ve(v,E=>{u(a)&&E(k)})}var R=y(v,2);{var O=E=>{var A=Id(),x=Re(A);ar(x,{type:"success",message:"Login successful!",width:"15em"}),N(E,A)};ve(R,E=>{!u(a)&&u(i)&&E(O)})}lt("submit",f,E=>{E.preventDefault(),o()}),Rt(g,()=>u(r),E=>m(r,E)),Rt(w,()=>u(s),E=>m(s,E)),N(t,h),Le()}var Pd=z('<!> <p>Continue <a href="./#/app/home">here</a></p>',1),$d=z('<main class="route svelte-6jdv1j"><section class="main-page"><h1 class="page-header">Login</h1> <section class="main-content"><form class="svelte-6jdv1j"><label for="email" class="svelte-6jdv1j">Email:</label> <input class="email svelte-6jdv1j" type="email"/> <label for="password" class="svelte-6jdv1j">Password:</label> <input class="password svelte-6jdv1j" type="password"/> <button class="log-in svelte-6jdv1j" type="submit">Sign in</button> <!> <!></form></section></section></main>');function Md(t,e){Ue(e,!0);let r=T(""),s=T(""),n="",a=T(""),i=T("");async function o(){let{data:E,error:A}=await me.auth.signInWithPassword({email:u(r),password:u(s)});A?(A&&A.message.includes("profiles_email_key")&&m(a,""),m(a,A.message,!0)):(m(i,E,!0),console.log("Login successful",n),m(a,""),c(),l(E.user.email))}async function l(E){const{error:A}=await me.from("profiles").insert({email:E});A&&A.message?console.error(A.message):A||(m(a,""),console.log("User added to profiles table"))}function c(){ws({particleCount:200,spread:70,origin:{y:.6}})}var h=$d(),p=b(h),d=y(b(p),2),f=b(d),g=y(b(f),2),w=y(g,4),v=y(w,4);{var k=E=>{ar(E,{type:"error",get message(){return u(a)}})};ve(v,E=>{u(a)&&E(k)})}var R=y(v,2);{var O=E=>{var A=Pd(),x=Re(A);ar(x,{type:"success",message:"Login successful!",width:"15em"}),N(E,A)};ve(R,E=>{!u(a)&&u(i)&&E(O)})}lt("submit",f,E=>{E.preventDefault(),o()}),Rt(g,()=>u(r),E=>m(r,E)),Rt(w,()=>u(s),E=>m(s,E)),N(t,h),Le()}var Dd=z('<div><span class="material-symbols-rounded svelte-hct3vs"> </span> <p> </p></div>');function Oi(t,e){let r=Ee(e,"type",8,""),s=Ee(e,"message",8,""),n=Ee(e,"symbol",8,"");var a=Dd(),i=b(a),o=b(i),l=y(i,2),c=b(l);fe(()=>{mt(a,1,`media-tag ${r()}`,"svelte-hct3vs"),re(o,n()),re(c,s())}),N(t,a)}var Nd=z('<div><img alt="Album cover"/> <span class="svelte-1pu170t"><!> <!></span> <a class="svelte-1pu170t"><b> </b></a> <a class="svelte-1pu170t"> </a></div>');function Wo(t,e){let r=Ee(e,"name",8,null),s=Ee(e,"artist",8,null),n=Ee(e,"cover",8,null),a=Ee(e,"level",8,null),i=Ee(e,"rating",8,null),o=Ee(e,"link",8,null),l=Ee(e,"type",8,null);var c=Nd(),h=b(c),p=y(h,2),d=b(p);Oi(d,{type:"level",get message(){return a()}});var f=y(d,2);Oi(f,{type:"rating",get message(){return i()},symbol:"thumb_up"});var g=y(p,2),w=b(g),v=b(w),k=y(g,2),R=b(k);fe(()=>{mt(c,1,hn(l()),"svelte-1pu170t"),He(h,"src",n()),mt(h,1,hn(l()),"svelte-1pu170t"),He(g,"href",o()),re(v,r()),re(R,s())}),N(t,c)}var Ud=z("<option> </option>"),Ld=z("<option> </option>"),qd=z('<span><label for="language">Select further detail:</label> <select class="language" required><option>--Select--</option><!></select></span>'),Bd=z('<p class="not-found svelte-1d376ng">:/ Oops! No songs found; try uploading your own or try again later.</p>'),Fd=z("<p>Try selecting a language to show media. If no languages show up, come back later as the servers may be down.</p>"),zd=z('<main class="route svelte-1d376ng"><!> <section class="main-page"><h1 class="page-header">Songs</h1> <section class="main-content svelte-1d376ng"><select></select> <!> <section class="media-container svelte-1d376ng"><!> <!> <!></section></section></section></main>');function Vd(t,e){Ue(e,!0);let r=T(H([])),s=T(H([])),n=T(""),a=T(""),i=T("");async function o(I){const{data:P,error:M}=await me.from("media").select("*").eq("language",I).eq("media_type","music");M?console.error("Error fetching songs:",M):(console.log(u(r)),console.log(P),P.forEach(G=>{u(r).push(G||[])}),console.log(u(r)))}Oe(()=>{console.log(u(r))});async function l(){const{data:I,error:P}=await me.from("languages").select("*");if(I)return m(s,I,!0),console.log(u(s)),I;if(P)throw P}ft(()=>{l()}),Oe(()=>{m(r,[],!0),Array.isArray(u(n))&&u(n).forEach(I=>{console.log(I),o(I)})});let c=T(void 0),h=T(void 0);Oe(()=>{var I;m(c,u(s).find(P=>P.short===u(a)),!0),m(h,(I=u(c))==null?void 0:I.sub_options,!0),console.log(u(h))}),Oe(()=>{u(a).length===1?m(n,u(a),!0):m(n,u(i),!0)}),Oe(()=>{console.log(u(n))});var p=zd(),d=b(p);Jt(d,{currentPage:"/music"});var f=y(d,2),g=y(b(f),2),w=b(g);Me(w,21,()=>u(s),$e,(I,P,M,G)=>{var W=Ud(),$=b(W),L={};fe(()=>{re($,`${u(P).emoji??""} ${u(P).name??""}`),L!==(L=u(P).short)&&(W.value=(W.__value=u(P).short)??"")}),N(I,W)});var v=y(w,2);{var k=I=>{var P=qd(),M=y(b(P),2),G=b(M);G.value=G.__value="";var W=y(G);Me(W,17,()=>u(h),$e,($,L)=>{var q=Ld(),J=b(q),ae={};fe(()=>{re(J,u(L).name),ae!==(ae=u(L).codes)&&(q.value=(q.__value=u(L).codes)??"")}),N($,q)}),at(M,()=>u(i),$=>m(i,$)),N(I,P)};ve(v,I=>{u(a).length>1&&I(k)})}var R=y(v,2),O=b(R);{var E=I=>{var P=Bd();N(I,P)};ve(O,I=>{!u(r)[0]&&u(n)&&I(E)})}var A=y(O,2);{var x=I=>{var P=Fd();N(I,P)};ve(A,I=>{u(a)||I(x)})}var j=y(A,2);Me(j,17,()=>u(r),$e,(I,P)=>{{let M=us(()=>`#/app/songs/${u(P).id}`);Wo(I,{get name(){return u(P).name},get artist(){return u(P).artist},get cover(){return u(P).cover},get level(){return u(P).level},get rating(){return u(P).rating},get link(){return u(M)},type:"song"})}}),at(w,()=>u(a),I=>m(a,I)),N(t,p),Le()}var Wd=z('<span class="svelte-1wzg23z"><h1 class="song svelte-1wzg23z"> </h1><h1 class="artist svelte-1wzg23z"> </h1></span>');function Ko(t,e){let r=Ee(e,"song",8,"Loading..."),s=Ee(e,"artist",8,"Loading...");var n=Wd(),a=b(n),i=b(a),o=y(a),l=b(o);fe(()=>{re(i,r()),re(l,s())}),N(t,n)}var Kd=z('<i><p class="romanisation svelte-1m7wp3l"> </p></i>'),Hd=z("<option> </option>"),Gd=z(`<span class="flashcard-functions svelte-1m7wp3l"><span class="flashcard-upload svelte-1m7wp3l"><button class="add-to-deck flashcard-btn svelte-1m7wp3l"><span class="material-symbols-rounded svelte-1m7wp3l">library_add</span></button> <select class="svelte-1m7wp3l"></select></span> <button class="info-flashcards-btn flashcard-btn svelte-1m7wp3l"><span class="material-symbols-rounded svelte-1m7wp3l">info</span></button></span> <dialog class="info-flashcards-container svelte-1m7wp3l"><strong class="definition-info-header">Where's my deck?</strong> <p class="definition-info-body svelte-1m7wp3l">This is as you may not yet have a deck for the language you are curretly studying; You can only add words to decks of the same language</p> <button class="close-dialog svelte-1m7wp3l">OK</button></dialog>`,1),Jd=z('<section class="svelte-1m7wp3l"><h1 class="svelte-1m7wp3l"> </h1> <!> <p class="part-of-speech svelte-1m7wp3l"> </p> <p class="svelte-1m7wp3l"> </p> <!> <!></section>');function Ho(t,e){Ue(e,!0);let r=T(H({message:"",type:""})),s=T(void 0),n=T(H([])),a=T(H(HTMLObjectElement)),i=T("");ft(async()=>{h()}),Oe(async()=>{u(i)?(m(n,await c(u(i)),!0),console.log(u(n))):m(n,[],!0)});async function o(g){const{data:w,error:v}=await me.from("flashcard_decks").select("content").eq("id",g);return v?(m(r,{type:"error",message:v.message},!0),[]):w[0].content}async function l(g){const w=await o(g);w.push({word:e.word,definition:e.definition,partOfSpeech:e.partOfSpeech,romanisation:e.romanisation});const{error:v}=await me.from("flashcard_decks").update({content:w}).eq("id",g);if(v&&v.message==='invalid input syntax for type bigint: "undefined"')return m(r,{type:"error",message:"You haven't selected a deck. Try making one on 'Flashcards' page"},!0),v;if(v)return m(r,{type:"error",message:gerror.message},!0),v;m(r,{type:"success",message:"Added!"},!0)}async function c(g){const{data:w,error:v}=await me.from("flashcard_decks").select("*").eq("author",g).eq("language",e.language);return v?(console.error(v),m(r,{type:"error",message:v.message},!0),v):(console.log(w),w)}async function h(){const{data:g,error:w}=await me.auth.getSession(),v=g;w?console.error("Error fetching session:",w):v&&m(i,v.session.user.id,!0)}var p=nr(),d=Re(p);{var f=g=>{var w=Jd(),v=b(w),k=b(v),R=y(v,2);{var O=G=>{var W=Kd(),$=b(W),L=b($);fe(()=>re(L,e.romanisation)),N(G,W)};ve(R,G=>{e.romanisation&&G(O)})}var E=y(R,2),A=b(E),x=y(E,2),j=b(x),I=y(x,2);{var P=G=>{var W=Gd(),$=Re(W),L=b($),q=b(L),J=y(q,2);Me(J,21,()=>u(n),$e,(U,K)=>{var Y=Hd(),X=b(Y),ne={};fe(()=>{re(X,u(K).name),ne!==(ne=u(K).id)&&(Y.value=(Y.__value=u(K).id)??"")}),N(U,Y)});var ae=y(L,2),B=us(()=>u(a).showModal()),Z=y($,2),S=y(b(Z),4),_=us(()=>u(a).close());zt(Z,U=>m(a,U),()=>u(a)),lt("click",q,()=>l(u(s))),at(J,()=>u(s),U=>m(s,U)),lt("click",ae,function(...U){var K;(K=u(B))==null||K.apply(this,U)}),lt("click",S,function(...U){var K;(K=u(_))==null||K.apply(this,U)}),N(G,W)};ve(I,G=>{u(n)&&G(P)})}var M=y(I,2);ar(M,{get type(){return u(r).type},get message(){return u(r).message}}),fe(()=>{re(k,e.word),re(A,e.partOfSpeech),re(j,e.definition)}),N(g,w)};ve(d,g=>{e.word&&g(f)})}N(t,p),Le()}var Yd=z('<p class="current-line svelte-61xipn"> </p>'),Zd=z('<!> <span class="svelte-61xipn"><span class="main-subtitles svelte-61xipn"></span> <p class="full-translate svelte-61xipn"> </p> <button class="show-translations-btn svelte-61xipn">Show translations</button></span>',1);function Pa(t,e){Ue(e,!0);const r=Ee(e,"currentLine",3,"Play the video to see live subtitles. Click on an individual word for a definition!"),s=Ee(e,"targetLanguage",3,""),n=Ee(e,"nativeLanguage",3,"en");let a="",i=T(H(a.term)),o=T(H(a.definition)),l=T(H(a.partOfSpeech)),c=T(H(a.original)),h=T(H(a.translated)),p=T(H(a.romanisation)),d=!0,f=T(H([]));Oe(()=>{const I=new Intl.Segmenter("zh",{granularity:"word"});m(f,[...I.segment(r())].map(P=>P.segment),!0),w(r())});async function g(I,P){const M=P.join(" "),G=`you are being used as an AI to give a definition of a word based of context for a language learning software the language of the word and context is ${s()} and the user's native language is ${n()} the word is ${I} and the context is ${M} so give your definition in ${n()} and as part of your just definition NOT the partOfSpeech add helpful notes such as if its plural and its singular or its case/tense and its infintive etc. but keep it simple and short return as raw json with no backtick MD markers as your respone will be directly parsed into json respond with attributes word, partOfSpeech, romanisation and definition but do NOT return romanisation where it is not necessary`,$=await(await fetch(`https://text.pollinations.ai/${G}`)).json();console.log($),m(i,$.word,!0),m(o,$.definition,!0),m(l,$.partOfSpeech,!0),m(p,$.romanisation,!0)}async function w(I){const P=`Translate from ISO 639-2 ${s()} to ${n()}. Sentence: "${I}". Respond only with raw JSON: { "original": "...", "translated": "..." }. No comments, markdown, or extra text`,M=await fetch(`https://text.pollinations.ai/${P}`);console.log(M);const G=await M.json();console.log(G),m(c,G.original,!0),m(h,G.translated,!0)}async function v(){const I=document.getElementsByClassName("full-translate"),P=document.getElementsByClassName("show-translations-btn");d=!d,Array.from(I).forEach(M=>{d===!0?M.style.display="block":M.style.display="none"}),Array.from(P).forEach(M=>{d===!0?M.style.display="none":M.style.display="block"})}var k=Zd(),R=Re(k);Ho(R,{get word(){return u(i)},get definition(){return u(o)},get partOfSpeech(){return u(l)},get romanisation(){return u(p)},get language(){return s()}});var O=y(R,2),E=b(O);Me(E,21,()=>u(f),$e,(I,P)=>{var M=Yd(),G=b(M);fe(()=>re(G,u(P))),lt("click",M,()=>g(u(P),u(f))),N(I,M)});var A=y(E,2),x=b(A),j=y(A,2);fe(()=>re(x,u(h))),lt("click",A,()=>v()),lt("click",j,()=>v()),N(t,k),Le()}var Xd=z('<span class="author-tag svelte-2mqmtf"><span class="material-symbols-rounded svelte-2mqmtf">person</span> <span class="author-text-container svelte-2mqmtf"><p class="svelte-2mqmtf">Uploaded by:</p> <p class="author svelte-2mqmtf"> </p></span></span>');function Go(t,e){let r=Ee(e,"author",3,"Loading...");var s=Xd(),n=y(b(s),2),a=y(b(n),2),i=b(a);fe(()=>re(i,r())),N(t,s)}function Qd(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,n,a,i=[],o="",l=t.split("/");for(l[0]||l.shift();n=l.shift();)r=n[0],r==="*"?(i.push("wild"),o+="/(.*)"):r===":"?(s=n.indexOf("?",1),a=n.indexOf(".",1),i.push(n.substring(1,~s?s:~a?a:n.length)),o+=~s&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(o+=(~s?"?":"")+"\\"+n.substring(a))):o+="/"+n;return{keys:i,pattern:new RegExp("^"+o+"/?$","i")}}function Ai(){const t=window.location.href.indexOf("#/");let e=t>-1?window.location.href.substr(t+1):"/";const r=e.indexOf("?");let s="";return r>-1&&(s=e.substr(r+1),e=e.substr(0,r)),{location:e,querystring:s}}const $a=Eo(null,function(e){e(Ai());const r=()=>{e(Ai())};return window.addEventListener("hashchange",r,!1),function(){window.removeEventListener("hashchange",r,!1)}}),ys=Oo($a,t=>t.location);Oo($a,t=>t.querystring);const xi=To(void 0);function ef(t){t?window.scrollTo(t.__svelte_spa_router_scrollX,t.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function tf(t,e){Ue(e,!1);let r=Ee(e,"routes",24,()=>({})),s=Ee(e,"prefix",8,""),n=Ee(e,"restoreScrollState",8,!1);class a{constructor(x,j){if(!j||typeof j!="function"&&(typeof j!="object"||j._sveltesparouter!==!0))throw Error("Invalid component object");if(!x||typeof x=="string"&&(x.length<1||x.charAt(0)!="/"&&x.charAt(0)!="*")||typeof x=="object"&&!(x instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:I,keys:P}=Qd(x);this.path=x,typeof j=="object"&&j._sveltesparouter===!0?(this.component=j.component,this.conditions=j.conditions||[],this.userData=j.userData,this.props=j.props||{}):(this.component=()=>Promise.resolve(j),this.conditions=[],this.props={}),this._pattern=I,this._keys=P}match(x){if(s()){if(typeof s()=="string")if(x.startsWith(s()))x=x.substr(s().length)||"/";else return null;else if(s()instanceof RegExp){const M=x.match(s());if(M&&M[0])x=x.substr(M[0].length)||"/";else return null}}const j=this._pattern.exec(x);if(j===null)return null;if(this._keys===!1)return j;const I={};let P=0;for(;P<this._keys.length;){try{I[this._keys[P]]=decodeURIComponent(j[P+1]||"")||null}catch{I[this._keys[P]]=null}P++}return I}async checkConditions(x){for(let j=0;j<this.conditions.length;j++)if(!await this.conditions[j](x))return!1;return!0}}const i=[];r()instanceof Map?r().forEach((A,x)=>{i.push(new a(x,A))}):Object.keys(r()).forEach(A=>{i.push(new a(A,r()[A]))});let o=mr(null),l=mr(null),c=mr({});const h=qc();async function p(A,x){await po(),h(A,x)}let d=null,f=null;n()&&(f=A=>{A.state&&(A.state.__svelte_spa_router_scrollY||A.state.__svelte_spa_router_scrollX)?d=A.state:d=null},window.addEventListener("popstate",f),Bc(()=>{ef(d)}));let g=null,w=null;const v=$a.subscribe(async A=>{g=A;let x=0;for(;x<i.length;){const j=i[x].match(A.location);if(!j){x++;continue}const I={route:i[x].path,location:A.location,querystring:A.querystring,userData:i[x].userData,params:j&&typeof j=="object"&&Object.keys(j).length?j:null};if(!await i[x].checkConditions(I)){m(o,null),w=null,p("conditionsFailed",I);return}p("routeLoading",Object.assign({},I));const P=i[x].component;if(w!=P){P.loading?(m(o,P.loading),w=P,m(l,P.loadingParams),m(c,{}),p("routeLoaded",Object.assign({},I,{component:u(o),name:u(o).name,params:u(l)}))):(m(o,null),w=null);const M=await P();if(A!=g)return;m(o,M&&M.default||M),w=P}j&&typeof j=="object"&&Object.keys(j).length?m(l,j):m(l,null),m(c,i[x].props),p("routeLoaded",Object.assign({},I,{component:u(o),name:u(o).name,params:u(l)})).then(()=>{xi.set(u(l))});return}m(o,null),w=null,xi.set(void 0)});Uc(()=>{v(),f&&window.removeEventListener("popstate",f)}),rc(()=>_o(n()),()=>{history.scrollRestoration=n()?"manual":"auto"}),sc(),Ta();var k=nr(),R=Re(k);{var O=A=>{var x=nr(),j=Re(x);Ga(j,()=>u(o),(I,P)=>{P(I,ti({get params(){return u(l)}},()=>u(c),{$$events:{routeEvent(M){ei.call(this,e,M)}}}))}),N(A,x)},E=A=>{var x=nr(),j=Re(x);Ga(j,()=>u(o),(I,P)=>{P(I,ti(()=>u(c),{$$events:{routeEvent(M){ei.call(this,e,M)}}}))}),N(A,x)};ve(R,A=>{u(l)?A(O):A(E,!1)})}N(t,k),Le()}var rf=Sa(z('<script src="https://www.youtube.com/iframe_api"><\/script><!>',1)),sf=z('<main class="route svelte-bcry69"><!> <section class="main-page svelte-bcry69"><h1 class="page-header svelte-bcry69">Music</h1> <section class="main-content svelte-bcry69"><span class="heading svelte-bcry69"><!></span> <!> <iframe id="player" frameborder="0" allowfullscreen="" class="svelte-bcry69"></iframe> <!></section></section></main>');function nf(t,e){Ue(e,!0);const r=()=>ms(ys,"$location",s),[s,n]=_s();let a=T(H(r().split("/").pop())),i,o=T("Loading..."),l=T("Loading..."),c=T("Loading..."),h=T("https://img.youtube.com/vi/loquela/maxresdefault.jpg"),p=T("Unknown Level"),d=T("No Rating"),f=T(""),g=T(H([])),w=T(void 0),v=T("https://youtu.be/zabswqP6xEM");Oe(()=>{const $=r().split("/").pop();$!=u(a)&&m(a,$,!0),k().then(()=>{window.YT?O():window.onYouTubeIframeAPIReady=O})}),ft(()=>{fetchLanguages()});async function k(){const{data:$,error:L}=await me.from("media").select("*").eq("id",u(a)).single();if($){const q=$;m(o,q.name,!0),m(l,q.artist,!0),m(c,q.author_username,!0),m(h,q.cover,!0),m(p,q.level,!0),m(d,q.rating,!0),m(f,q.language,!0),m(v,q.embed_link,!0),m(g,q.content.events,!0),console.log(u(g)),console.log(`${u(v)}?enablejsapi=1`)}else m(o,"Unknown Song"),m(l,"Unknown Artist"),m(h,"https://img.youtube.com/vi/loquela/maxresdefault.jpg"),m(p,"Unknown Level"),m(d,"No Rating"),m(v,"https://youtu.be/zabswqP6xEM")}function R($){let L=0;u(g).forEach(q=>{$>q.tStartMs&&$<u(g)[L+1].tStartMs&&q.segs.forEach(J=>{u(w)!==J.utf8&&m(w,J.utf8,!0)}),L++})}function O(){i=new YT.Player("player",{events:{onReady:()=>{setInterval(()=>{const $=i.getCurrentTime(),L=Math.round($*1e3);R(L)},1)}}})}var E=sf();Ea("bcry69",$=>{var L=rf();y(Re(L)),N($,L)});var A=b(E);Jt(A,{currentPage:"/music"});var x=y(A,2),j=y(b(x),2),I=b(j),P=b(I);Ko(P,{get song(){return u(o)},get artist(){return u(l)}});var M=y(I,2);Go(M,{get author(){return u(c)}});var G=y(M,2),W=y(G,2);Pa(W,{get currentLine(){return u(w)},get targetLanguage(){return u(f)}}),fe(()=>{He(G,"src",`${u(v)}?enablejsapi=1`),He(G,"title",u(o))}),N(t,E),Le(),n()}var af=z('<option class="svelte-1xupfpx"> </option>'),of=z('<option class="svelte-1xupfpx"> </option>'),lf=z('<span class="svelte-1xupfpx"><label for="language">* Select further detail:</label> <select class="language svelte-1xupfpx" required><option class="svelte-1xupfpx">--Select--</option><!></select></span>'),cf=z('<option class="svelte-1xupfpx"> </option>'),uf=z('<main class="route  svelte-1xupfpx"><!> <section class="main-page"><h1 class="page-header">Upload</h1> <section class="notice svelte-1xupfpx"><h3 class="notice-text svelte-1xupfpx">Notice</h3> <p class="notice-text svelte-1xupfpx">Please ensure video has subtitles enabled by creator!</p></section> <section class="main-content svelte-1xupfpx"><form class="svelte-1xupfpx"><div class="vertical-container svelte-1xupfpx"><span class="svelte-1xupfpx"><label for="media">* Select media type:</label> <select class="media svelte-1xupfpx" required><option class="svelte-1xupfpx">--Pick the medium category--</option><option class="svelte-1xupfpx">ðº YT Video</option><option class="svelte-1xupfpx">ð§ Music</option></select></span> <span class="svelte-1xupfpx"><label for="language">* Select language of content:</label> <select class="language svelte-1xupfpx" required><option class="svelte-1xupfpx">--Select language--</option><!></select></span> <!> <span class="svelte-1xupfpx"><label for="level">* Select level of content:</label> <select class="level svelte-1xupfpx" required><option class="svelte-1xupfpx">--Select a level--</option><option class="svelte-1xupfpx">ð£ A1</option><option class="svelte-1xupfpx">ð¥ A2</option><option class="svelte-1xupfpx">ð¦ B1</option><option class="svelte-1xupfpx">ð¦ B2</option><option class="svelte-1xupfpx">ð¦ C1</option><option class="svelte-1xupfpx">ð¦ C2</option></select></span> <span class="svelte-1xupfpx"><label for="category">* Select category of content:</label> <select class="category svelte-1xupfpx" required><option class="svelte-1xupfpx">--Select category--</option><!></select></span></div> <span class="svelte-1xupfpx"><label for="url">Link to medium:</label> <input class="url svelte-1xupfpx" type="url" placeholder="Enter media URL"/></span> <button type="submit" class="push-btn svelte-1xupfpx"><span class="front-push-btn svelte-1xupfpx">Upload</span></button> <!></form></section></section></main>');function hf(t,e){Ue(e,!0);let r=T(H({name:"",type:""})),s=T(""),n=T(""),a=T(""),i=T(""),o=T(""),l=T(""),c=T(H([])),h=T(H([])),p=T(""),d=T(""),f=T(void 0),g=T(void 0);Oe(()=>{var te;m(f,u(c).find(pe=>pe.short===u(a)),!0),m(g,(te=u(f))==null?void 0:te.sub_options,!0),console.log(u(g))});async function w(){const{data:te,error:pe}=await me.from("categories").select("*");m(h,te,!0)}w();function v(){ws({particleCount:600,spread:100,origin:{y:0}})}ft(async()=>{x(),k()});async function k(){const{data:te,error:pe}=await me.from("languages").select("*");if(te)return m(c,te,!0),console.log(u(c)),te;if(pe)throw pe}async function R(te,pe,we,F,Q){try{if(await E(pe)){m(r,{type:"warn",name:"This has already been uploaded to Loquela"},!0);return}te==="video"||te==="music"?(await O(pe,we,te,F,Q),m(r,{type:"success",name:"Beginning upload..."},!0),v()):m(r,{type:"error",name:"Error in link validation"},!0)}catch(_e){console.error("Upload error:",_e),m(r,{type:"error",name:"Error in upload process"},!0)}}async function O(te,pe,we,F,Q){const _e=me.channel("subtitles");await _e.subscribe();const De=await _e.send({type:"broadcast",event:"subtitle-update",payload:{id:1,url:te,lang:pe,type:we,level:F,author:u(p),author_username:u(d),category:Q}});console.log("Broadcast result:",De)}async function E(te){const{data:pe,error:we}=await me.from("media").select("*").eq("video_link",te).single();if(we){if(we.details&&we.details.includes("0 rows"))return!1;console.error("Database error:",we)}return!!pe}async function A(te,pe,we,F,Q){try{const _e=await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(te)}&format=json`);return console.log(_e),console.log(te),!_e.ok||!te.startsWith("https://www.youtube.com/watch?v=")?(m(r,{type:"error",name:"Invalid URL. Must be in format 'https://www.youtube.com/watch?v='"},!0),!1):(await R(pe,te,we,F,Q),!0)}catch(_e){return console.error("Validation error:",_e),m(r,{type:"error",name:"Error validating URL"},!0),!1}}async function x(){const{data:te,error:pe}=await me.auth.getSession(),we=te;if(pe)console.error("Error fetching session:",pe);else if(we){m(p,we.session.user.id,!0);const{data:F,error:Q}=await me.from("profiles").select("username").eq("user_id",u(p)).single();F&&m(d,F.username,!0),Q&&console.log(Q)}pe&&console.error("Error fetching userID:",pe)}Oe(()=>{u(i)?m(i,u(i),!0):m(i,u(a),!0)});var j=uf(),I=b(j);Jt(I,{currentPage:"/upload"});var P=y(I,2),M=y(b(P),4),G=b(M),W=b(G),$=b(W),L=y(b($),2),q=b(L);q.value=q.__value="";var J=y(q);J.value=J.__value="video";var ae=y(J);ae.value=ae.__value="music";var B=y($,2),Z=y(b(B),2),S=b(Z);S.value=S.__value="";var _=y(S);Me(_,17,()=>u(c),$e,(te,pe)=>{var we=af(),F=b(we),Q={};fe(()=>{re(F,`${u(pe).emoji??""} ${u(pe).name??""}`),Q!==(Q=u(pe).short)&&(we.value=(we.__value=u(pe).short)??"")}),N(te,we)});var U=y(B,2);{var K=te=>{var pe=lf(),we=y(b(pe),2),F=b(we);F.value=F.__value="";var Q=y(F);Me(Q,17,()=>u(g),$e,(_e,De)=>{var be=of(),Ae=b(be),Ye={};fe(()=>{re(Ae,u(De).name),Ye!==(Ye=u(De).codes)&&(be.value=(be.__value=u(De).codes)??"")}),N(_e,be)}),at(we,()=>u(i),_e=>m(i,_e)),N(te,pe)};ve(U,te=>{u(a).length>1&&te(K)})}var Y=y(U,2),X=y(b(Y),2),ne=b(X);ne.value=ne.__value="";var D=y(ne);D.value=D.__value="A1";var V=y(D);V.value=V.__value="A2";var se=y(V);se.value=se.__value="B1";var ie=y(se);ie.value=ie.__value="B2";var oe=y(ie);oe.value=oe.__value="C1";var ue=y(oe);ue.value=ue.__value="C2";var Te=y(Y,2),he=y(b(Te),2),je=b(he);je.value=je.__value="";var We=y(je);Me(We,17,()=>u(h),$e,(te,pe)=>{var we=cf(),F=b(we),Q={};fe(()=>{re(F,`${u(pe).emoji??""} ${u(pe).name??""}`),Q!==(Q=u(pe).name)&&(we.value=(we.__value=u(pe).name)??"")}),N(te,we)});var qe=y(W,2),Ge=y(b(qe),2),Je=y(qe,4);{var Fe=te=>{ar(te,{get type(){return u(r).type},get message(){return u(r).name},width:"16em"})};ve(Je,te=>{u(r).name&&te(Fe)})}lt("submit",G,te=>{te.preventDefault(),A(u(n),u(s),u(i),u(o),u(l))}),at(L,()=>u(s),te=>m(s,te)),at(Z,()=>u(a),te=>m(a,te)),at(X,()=>u(o),te=>m(o,te)),at(he,()=>u(l),te=>m(l,te)),Rt(Ge,()=>u(n),te=>m(n,te)),N(t,j),Le()}var df=z('<section class="svelte-i5t88f"><span class="text-container svelte-i5t88f"><a class="svelte-i5t88f"><h1 class="name svelte-i5t88f"> </h1></a> <p class="terms svelte-i5t88f"> </p> <p class="author svelte-i5t88f"> </p></span> <span class="language-image-container svelte-i5t88f"><img class="svelte-i5t88f"/></span></section>');function ff(t,e){var r=df(),s=b(r),n=b(s),a=b(n),i=b(a),o=y(n,2),l=b(o),c=y(o,2),h=b(c),p=y(s,2),d=b(p);fe(()=>{He(n,"href",`#/app/flashcards/${e.id}`),re(i,e.name),re(l,`Terms: ${e.terms??""}`),re(h,`@${e.author??""}`),He(d,"src",`https://hatscripts.github.io/circle-flags/flags/${e.country??""}.svg`)}),N(t,r)}var vf=z('<p class="not-found svelte-3pf8ly">:/ Oops! No flashcards found; try uploading your own or try again later.</p>'),pf=z("<option> </option>"),gf=z('<main class="route svelte-3pf8ly"><!> <section class="main-page"><h1 class="page-header">Flashcards</h1> <section class="main-content svelte-3pf8ly"><button class="create-flashcard-deck svelte-3pf8ly">+ Create Flashcard Deck</button> <section class="flashcard-decks svelte-3pf8ly"><!> <!></section></section></section></main> <dialog class="svelte-3pf8ly"><div class="dialog-container svelte-3pf8ly"><div><h2>Create Flashcard Deck</h2> <h1> </h1> <form class="svelte-3pf8ly"><label>Deck name:</label> <input class="name svelte-3pf8ly"/> <label>Language:</label> <select class="language svelte-3pf8ly"><option>--Select language--</option><!></select> <input type="Submit" class="svelte-3pf8ly"/></form></div> <button class="close-dialog-button svelte-3pf8ly">Close</button></div></dialog>',1);function mf(t,e){Ue(e,!0);let r,s=T(""),n=T(""),a=T(H([])),i=T(void 0),o=T(""),l=T(H([]));ft(async()=>{p(),c(),r.close()}),Oe(async()=>{if(u(i)){const{data:B,error:Z}=await me.from("flashcard_decks").select("*");Z&&console.error("Error fetching flashcard decks:",Z),m(l,B||[],!0),console.log(u(l))}});async function c(){const{data:B,error:Z}=await me.from("languages").select("*");if(B)return m(a,B,!0),console.log(u(a)),B;if(Z)throw Z}async function h(B,Z,S,_,U){const{error:K}=await me.from("flashcard_decks").insert({name:B,author:Z,author_username:U,language:S,country_code:_,content:[]});console.log(K),location.reload()}async function p(){const{data:B,error:Z}=await me.auth.getSession(),S=B;if(Z)console.error("Error fetching session:",Z);else if(S){m(i,S.session.user.id,!0);const{data:_,error:U}=await me.from("profiles").select("username").eq("user_id",u(i)).single();_&&m(o,_.username,!0),U&&console.log(U)}}var d=gf(),f=Re(d),g=b(f);Jt(g,{currentPage:"/flashcards"});var w=y(g,2),v=y(b(w),2),k=b(v);k.__click=()=>r.showModal();var R=y(k,2),O=b(R);{var E=B=>{var Z=vf();N(B,Z)};ve(O,B=>{u(l)[0]||B(E)})}var A=y(O,2);Me(A,17,()=>u(l),$e,(B,Z)=>{ff(B,{get name(){return u(Z).name},get author(){return u(Z).author_username},get terms(){return u(Z).content.length},get country(){return u(Z).country_code},get id(){return u(Z).id}})});var x=y(f,2),j=b(x),I=b(j),P=y(b(I),2),M=b(P),G=y(P,2),W=y(b(G),2),$=y(W,4),L=b($);L.value=L.__value="";var q=y(L);{var J=B=>{var Z=nr(),S=Re(Z);Me(S,17,()=>u(a),$e,(_,U,K)=>{var Y=pf(),X=b(Y);Y.value=Y.__value=K,fe(()=>re(X,`${u(U).emoji??""} ${u(U).name??""}`)),N(_,Y)}),N(B,Z)};ve(q,B=>{u(a)&&B(J)})}var ae=y(I,2);ae.__click=()=>r.close(),zt(x,B=>r=B,()=>r),fe(()=>re(M,u(a)[u(n)])),lt("submit",G,B=>{h(u(s),u(i),u(a)[u(n)].short,u(a)[u(n)].country_code,u(o))}),Rt(W,()=>u(s),B=>m(s,B)),at($,()=>u(n),B=>m(n,B)),N(t,d),Le()}Fr(["click"]);var _f=z('<div class="title-author-container svelte-baker"><h1 class="deck-name-heading svelte-baker"> </h1> <p class="deck-name-author svelte-baker">Uploaded by: <b> </b></p></div>'),wf=z('<i><p class="romanisation svelte-baker"> </p></i>'),yf=z('<span class="card-count-container svelte-baker"><span class="unsure-count card-count svelte-baker"> </span> <span class="known-count card-count svelte-baker"> </span></span> <div class="flashcard svelte-baker"><h1 class="word svelte-baker"> </h1> <span class="word-details svelte-baker"><!> <p class="part-of-speech svelte-baker"> </p></span> <p class="definition svelte-baker"> </p></div> <span class="buttons svelte-baker"><button class="dont-know flashcard-button svelte-baker"><span class="material-symbols-rounded svelte-baker">do_not_disturb</span>Unsure</button> <button class="flip flashcard-button svelte-baker"><span class="material-symbols-rounded svelte-baker">autorenew</span>Flip</button> <button class="know flashcard-button svelte-baker"><span class="material-symbols-rounded svelte-baker">check_circle</span>Know</button></span>',1),bf=z('<button class="flashcard-continue svelte-baker"><span class="material-symbols-rounded svelte-baker">expand_circle_right</span> Continue with unknown terms</button>'),kf=z('<p class="svelte-baker">Congratulations! You know all the terms in this deck!</p>'),Sf=z('<div class="flashcard svelte-baker"><p class="known-percentage svelte-baker"> </p> <!> <!></div>'),Ef=z('<main class="svelte-baker"><!> <!> <!></main>');function Tf(t,e){Ue(e,!0);const r=Ee(e,"backContent",19,()=>[]),s=Ee(e,"author",3,"");let n=T(0),a=T(H([])),i=T(H([])),o="",l=T(H(o.word)),c=T(H(o.definition)),h=T(H(o.partOfSpeech)),p=T(H(o.romanisation)),d=T(0);Oe(()=>{m(d,Math.round(u(i).length/(u(a).length+u(i).length)*100),!0)}),console.log(e.content),ft(()=>{Oe(()=>{if(e.content&&Array.isArray(e.content)&&e.content[u(n)]){const M=JSON.parse(e.content[u(n)]);console.log(M),m(l,M.word,!0),m(c,M.definition,!0),m(h,M.partOfSpeech,!0),m(p,M.romanisation,!0),f()}})});function f(){r().forEach(M=>{const G=document.getElementsByClassName(M);G&&Array.from(G).forEach(W=>{W.classList.add("hidden")})})}function g(){r().forEach(M=>{const G=document.getElementsByClassName(M);G&&Array.from(G).forEach(W=>{W.classList.remove("hidden")})})}function w(){e.content[u(n)]&&(u(a).push(e.content[u(n)]),qa(n))}function v(){e.content[u(n)]&&(u(i).push(e.content[u(n)]),qa(n)),u(d)===100&&R()}function k(){m(n,0),m(a,[],!0),u(i).forEach(M=>{e.content.splice(e.content.indexOf(M),1)}),m(i,[],!0)}function R(){ws({particleCount:200,spread:70,origin:{y:0}})}var O=Ef(),E=b(O);{var A=M=>{var G=_f(),W=b(G),$=b(W),L=y(W,2),q=y(b(L)),J=b(q);fe(()=>{re($,e.deckName),re(J,`@${s()??""}`)}),N(M,G)};ve(E,M=>{s()&&e.deckName&&M(A)})}var x=y(E,2);{var j=M=>{var G=yf(),W=Re(G),$=b(W),L=b($),q=y($,2),J=b(q),ae=y(W,2),B=b(ae),Z=b(B),S=y(B,2),_=b(S);{var U=oe=>{var ue=wf(),Te=b(ue),he=b(Te);fe(()=>re(he,u(p))),N(oe,ue)};ve(_,oe=>{u(p)&&oe(U)})}var K=y(_,2),Y=b(K),X=y(S,2),ne=b(X),D=y(ae,2),V=b(D);V.__click=w;var se=y(V,2);se.__click=g;var ie=y(se,2);ie.__click=v,fe(()=>{re(L,u(a).length),re(J,u(i).length),re(Z,u(l)),re(Y,u(h)),re(ne,u(c))}),N(M,G)};ve(x,M=>{u(n)!==e.content.length&&M(j)})}var I=y(x,2);{var P=M=>{var G=Sf(),W=b(G),$=b(W),L=y(W,2);{var q=B=>{var Z=bf();Z.__click=k,N(B,Z)};ve(L,B=>{u(d)!==100&&B(q)})}var J=y(L,2);{var ae=B=>{var Z=kf();N(B,Z)};ve(J,B=>{u(d)===100&&B(ae)})}fe(()=>re($,`Known: ${u(d)??""}%`)),N(M,G)};ve(I,M=>{u(n)===e.content.length&&M(P)})}N(t,O),Le()}Fr(["click"]);var Of=z("<h3>Oops! Looks like there are no cards in this deck. Try going to a video, song or AI Chat and add some!</h3>"),Af=z('<main class="route svelte-967ptl"><!> <section class="main-page"><h1 class="page-header">Flashcards</h1> <section class="main-content svelte-967ptl"><!> <!></section></section></main>');function xf(t,e){Ue(e,!0);const r=()=>ms(ys,"$location",s),[s,n]=_s();let a=H(r().split("/").pop()),i=T(H([])),o=T(0),l="",c=T(H(l.flashcardDeckName)),h=T(H(l.flashcardDeckAuthor));ft(async()=>{const E=await p(a);E?(m(c,E.name,!0),m(h,E.author_username,!0),m(i,E.content,!0),m(o,u(i).length,!0),console.log(u(o))):console.error("Flashcards not found")});async function p(E){const{data:A,error:x}=await me.from("flashcard_decks").select("*").eq("id",E).single();if(x){console.error(x);return}return A}var d=Af(),f=b(d);Jt(f,{currentPage:"/flashcards"});var g=y(f,2),w=y(b(g),2),v=b(w);{var k=E=>{Tf(E,{get content(){return u(i)},backContent:["part-of-speech","definition"],get deckName(){return u(c)},get author(){return u(h)}})};ve(v,E=>{u(i)&&u(i).length>0&&E(k)})}var R=y(v,2);{var O=E=>{var A=Of();N(E,A)};ve(R,E=>{!u(i).length>0&&E(O)})}N(t,d),Le(),n()}var Rf=z("<option> </option>"),Cf=z("<option> </option>"),If=z('<span><label for="language">Select further detail:</label> <select class="language" required><option>--Select--</option><!></select></span>'),jf=z("<p>Try selecting a language to show media. If no languages show up, come back later as the servers may be down.</p>"),Pf=z('<h1 class="category-title svelte-yxunt"> </h1> <section class="category-section svelte-yxunt"></section>',1),$f=z('<main class="route svelte-yxunt"><!> <section class="main-page"><h1 class="page-header">Videos</h1> <section class="main-content svelte-yxunt"><select></select> <!> <section class="media-container svelte-yxunt"><!> <!> <section class="categories-section svelte-yxunt"></section></section></section></section></main>');function Mf(t,e){Ue(e,!0);let r=T(H([])),s=T(H([])),n="",a=T(""),i=T(""),o=T(""),l=T(""),c=T(H({}));async function h(){const{data:$,error:L}=await me.from("categories").select("*");m(l,$,!0)}ft(()=>{h()}),Oe(()=>{console.log(u(l))});async function p($){const{data:L,error:q}=await me.from("media").select("*").eq("language",$).eq("media_type","video");q?console.error("Error fetching videos:",q):(console.log(u(r)),console.log(L),L.forEach(J=>{u(r).push(J||[])}),console.log(u(r)),m(c,[],!0),await f(u(r)))}function d($){const L=u(l).find(q=>q.name===$);return L?L.emoji:"ð·ï¸"}async function f($){$.forEach(L=>{if(L){let q=L.category;q||(q="Uncategorised"),!u(c)[q]&&q&&(u(c)[q]=[]),u(c)[q].push(L)}console.log(u(c))})}Oe(()=>{console.log(u(r))});async function g(){const{data:$,error:L}=await me.from("languages").select("*");if($)return m(s,$,!0),console.log(u(s)),$;if(L)throw L}ft(()=>{g()}),Oe(()=>{m(r,[],!0),Array.isArray(u(a))&&u(a).forEach($=>{console.log($),p($)})});let w=T(void 0),v=T(void 0);Oe(()=>{var $;m(w,u(s).find(L=>L.short===u(i)),!0),m(v,($=u(w))==null?void 0:$.sub_options,!0),console.log(u(v))}),Oe(()=>{u(i).length===1?m(a,u(i),!0):m(a,u(o),!0)});var k=$f(),R=b(k);Jt(R,{currentPage:"/videos"});var O=y(R,2),E=y(b(O),2),A=b(E);Me(A,21,()=>u(s),$e,($,L,q,J)=>{var ae=Rf(),B=b(ae),Z={};fe(()=>{re(B,`${u(L).emoji??""} ${u(L).name??""}`),Z!==(Z=u(L).short)&&(ae.value=(ae.__value=u(L).short)??"")}),N($,ae)});var x=y(A,2);{var j=$=>{var L=If(),q=y(b(L),2),J=b(q);J.value=J.__value="";var ae=y(J);Me(ae,17,()=>u(v),$e,(B,Z)=>{var S=Cf(),_=b(S),U={};fe(()=>{re(_,u(Z).name),U!==(U=u(Z).codes)&&(S.value=(S.__value=u(Z).codes)??"")}),N(B,S)}),at(q,()=>u(o),B=>m(o,B)),N($,L)};ve(x,$=>{u(i).length>1&&$(j)})}var I=y(x,2),P=b(I);ve(P,$=>{u(r)[0]});var M=y(P,2);{var G=$=>{var L=jf();N($,L)};ve(M,$=>{u(i)||$(G)})}var W=y(M,2);Me(W,21,()=>Object.entries(u(c)),$e,($,L,q,J)=>{var ae=us(()=>sl(u(L),2));let B=()=>u(ae)[0],Z=()=>u(ae)[1];var S=Pf(),_=Re(S),U=b(_),K=y(_,2);Me(K,21,Z,$e,(Y,X)=>{{let ne=us(()=>`#/app/videos/${u(X).id}`);Wo(Y,{get name(){return u(X).name},get artist(){return u(X).artist},get cover(){return u(X).cover},get level(){return u(X).level},get rating(){return u(X).rating},get link(){return u(ne)},type:"video"})}}),fe(Y=>re(U,`${Y??""} ${B()??""}`),[()=>d(B())]),N($,S)}),at(A,()=>u(i),$=>m(i,$)),N(t,k),Le()}var Df=Sa(z('<script src="https://www.youtube.com/iframe_api"><\/script><!>',1)),Nf=z("<p>Oops. Loquelis is struggling to the media - it may be invalid or unavailable.</p>"),Uf=z('<main class="route svelte-1ml0pbe"><!> <section class="main-page svelte-1ml0pbe"><h1 class="page-header svelte-1ml0pbe">Videos</h1> <section class="main-content svelte-1ml0pbe"><span class="heading svelte-1ml0pbe"><!> <!></span> <iframe id="player" frameborder="0" allowfullscreen="" class="svelte-1ml0pbe"></iframe> <!> <!></section></section></main>');function Lf(t,e){Ue(e,!0);const r=()=>ms(ys,"$location",s),[s,n]=_s();let a=T(H(r().split("/").pop())),i,o=T("Loading..."),l=T("Loading..."),c=T("Loading..."),h=T("Loading..."),p=T("https://img.youtube.com/vi/loquela/maxresdefault.jpg"),d=T("Unknown Level"),f=T("No Rating"),g=T(""),w=T(H([])),v=T(void 0),k=T("https://youtu.be/zabswqP6xEM");Oe(()=>{const J=r().split("/").pop();J!=u(a)&&m(a,J,!0),R().then(()=>{window.YT?E():window.onYouTubeIframeAPIReady=E})});async function R(){const{data:J,error:ae}=await me.from("media").select("*").eq("id",u(a)).single();if(J){const B=J;m(o,B.name,!0),m(h,B.artist,!0),m(l,B.author_username,!0),m(c,B.author_username,!0),m(p,B.cover,!0),m(d,B.level,!0),m(f,B.rating,!0),m(g,B.language,!0),m(k,B.embed_link,!0),m(w,B.content.events,!0),console.log(u(w)),console.log(`${u(k)}?enablejsapi=1`)}else m(o,"Unknown Video"),m(h,"Unknown Artist"),m(p,"https://img.youtube.com/vi/loquela/maxresdefault.jpg"),m(d,"Unknown Level"),m(f,"No Rating"),m(k,"https://youtu.be/zabswqP6xEM")}function O(J){let ae=0;u(w).forEach(B=>{J>B.tStartMs&&J<u(w)[ae+1].tStartMs&&B.segs.forEach(Z=>{u(v)!==Z.utf8&&m(v,Z.utf8,!0)}),ae++})}function E(){i=new YT.Player("player",{events:{onReady:()=>{setInterval(()=>{const J=i.getCurrentTime(),ae=Math.round(J*1e3);O(ae)},1)}}})}var A=Uf();Ea("1ml0pbe",J=>{var ae=Df();y(Re(ae)),N(J,ae)});var x=b(A);Jt(x,{currentPage:"/videos"});var j=y(x,2),I=y(b(j),2),P=b(I),M=b(P);Ko(M,{get song(){return u(o)},get artist(){return u(h)}});var G=y(M,2);Go(G,{get author(){return u(l)}});var W=y(P,2),$=y(W,2);{var L=J=>{var ae=Nf();N(J,ae)};ve($,J=>{u(k)==="https://youtu.be/zabswqP6xEM"&&J(L)})}var q=y($,2);Pa(q,{get currentLine(){return u(v)},get targetLanguage(){return u(g)}}),fe(()=>{He(W,"src",`${u(k)}?enablejsapi=1`),He(W,"title",u(o))}),N(t,A),Le(),n()}var qf=z('<img class="svelte-1afzn3p"/>'),Bf=z('<section class="ai-chat-box svelte-1afzn3p"><div class="pfp-name-occupation-container svelte-1afzn3p"><!> <div class="text svelte-1afzn3p"><a class="svelte-1afzn3p"><h2 class="svelte-1afzn3p"> </h2></a> <p class="occupation svelte-1afzn3p"> </p></div></div> <div class="flag-tags-container svelte-1afzn3p"><img class="lang-flag svelte-1afzn3p"/> <span class="traits svelte-1afzn3p"><p class="trait-tag svelte-1afzn3p"> </p></span></div></section>');function Ff(t,e){var r=Bf(),s=b(r),n=b(s);{var a=k=>{var R=qf();fe(()=>{He(R,"src",e.image),He(R,"alt",e.firstName)}),N(k,R)};ve(n,k=>{e.image&&k(a)})}var i=y(n,2),o=b(i),l=b(o),c=b(l),h=y(o,2),p=b(h),d=y(s,2),f=b(d),g=y(f,2),w=b(g),v=b(w);fe(()=>{He(o,"href",`/#/app/ai-chat/${e.id}`),re(c,e.firstName),re(p,e.occupation),He(f,"src",`https://hatscripts.github.io/circle-flags/flags/${e.lang}.svg`),He(f,"alt",e.lang),re(v,e.trait)}),N(t,r)}var zf=z('<p class="not-found svelte-javkzk">:/ Oops! No flashcards found; try uploading your own or try again later.</p>'),Vf=z("<option> </option>"),Wf=z("<option> </option>"),Kf=z('<span><label for="language" class="svelte-javkzk">* Select further detail:</label> <select class="language svelte-javkzk" required><option>--Select--</option><!></select></span>'),Hf=z("<option> </option>"),Gf=z("<option> </option>"),Jf=z('<main class="route svelte-javkzk"><!> <section class="main-page"><h1 class="page-header">AI Chat</h1> <section class="main-content svelte-javkzk"><button class="create-ai-character svelte-javkzk"><span class="material-symbols-rounded svelte-javkzk">person_add</span>Create AI Character</button> <div class="chats svelte-javkzk"><!> <!></div></section></section></main> <dialog class="svelte-javkzk"><div class="dialog-container svelte-javkzk"><h2 class="dialog-header svelte-javkzk">Create AI Character</h2> <form class="svelte-javkzk"><label class="svelte-javkzk">ðªª Character name:</label> <input class="name svelte-javkzk" required/> <span class="label-input-container svelte-javkzk"><label class="svelte-javkzk">ð¬ Language:</label> <select class="language svelte-javkzk" required><option>--Select language--</option><!></select></span> <!> <span class="label-input-container svelte-javkzk"><label class="svelte-javkzk">ð Occupation:</label> <select class="occupation svelte-javkzk" required><option>--Select occupation--</option><!></select></span> <span class="label-input-container svelte-javkzk"><label class="svelte-javkzk">ð§  Trait:</label> <select class="traits svelte-javkzk" required><option>--Select trait--</option><!></select></span> <!> <input class="submit-btn svelte-javkzk" type="Submit"/></form> <button class="close-dialog-btn svelte-javkzk">Close</button></div></dialog>',1);function Yf(t,e){Ue(e,!0),Ee(e,"occupation",3,"Knight"),Ee(e,"image",3,"https://image.pollinations.ai/prompt/Generate%20a%20pixar-style%20image%20of%20a%20knight%20called%20Hansel%20with%20traits%20of%20brave,%20adventurous%20who%20is%20dressed%20in%20traditional%20attire%20of%20German"),Ee(e,"firstName",3,"Hansel"),Ee(e,"trait",3,"Friendly"),Ee(e,"lang",3,"de");let r="",s=T(H(r.characterName)),n=T(H(r.characterTrait)),a=T(H(r.characterOccupation)),i=T(H([])),o=T(H([])),l=T(null),c=T(H([])),h=H([]),p=H([]),d=T(H([])),f=T(H([])),g=T(H([])),w="",v=T(H(w.characterCreateStatus)),k=T(H(w.characterCreateMessage));ft(async()=>{await x(),await j(),O(),E(),R()});async function R(){const{data:F,error:Q}=await me.from("ai_characters").select("*");F&&m(d,F,!0),Q&&console.error(Q)}function O(){Array.from(u(c)).forEach(F=>{console.log("gabo"),F.type==="occupation"?h.push(F.name):console.error("Error finding occupations")})}function E(){Array.from(u(c)).forEach(F=>{console.log("gabo"),F.type==="trait"?p.push(F.name):console.error("Error finding traits")})}async function A(F,Q,_e,De,be){m(v,""),m(k,""),console.log(be);const{error:Ae}=await me.from("ai_characters").insert([{name:F,trait:Q,occupation:_e,language:De,country:be,image:`https://image.pollinations.ai/prompt/Generate a pixar-style image of a ${_e} called ${F} with trait of ${Q} who is dressed in traditional attire of ${De}.`}]);Ae||(m(v,"success"),m(k,"Created! Reload the page to see your character!")),Ae&&(m(v,"error"),m(k,"Error adding character"),console.error(Ae))}async function x(){const{data:F,error:Q}=await me.from("languages").select("*");if(F)return m(o,F,!0),console.log(u(o)),F;if(Q)throw Q}async function j(){const{data:F,error:Q}=await me.from("character_fields").select("*");if(F)return m(c,F,!0),console.log(u(c)),F;if(Q)throw Q}let I=T(void 0),P=T(void 0),M=T("");Oe(()=>{var F,Q;m(I,u(o).find(_e=>_e.short===u(i)),!0),m(P,(F=u(I))==null?void 0:F.sub_options,!0),m(M,(Q=u(I))==null?void 0:Q.country_code,!0),console.log(u(M))}),Oe(()=>{u(i).length===1?m(f,u(i),!0):m(f,u(g),!0),console.log(u(f))});var G=Jf(),W=Re(G),$=b(W);Jt($,{currentPage:"/ai-chat"});var L=y($,2),q=y(b(L),2),J=b(q);J.__click=()=>u(l).showModal();var ae=y(J,2),B=b(ae);{var Z=F=>{var Q=zf();N(F,Q)};ve(B,F=>{u(d)[0]||F(Z)})}var S=y(B,2);Me(S,17,()=>u(d),$e,(F,Q)=>{Ff(F,{get id(){return u(Q).id},get image(){return u(Q).image},get firstName(){return u(Q).name},get trait(){return u(Q).trait},get lang(){return u(Q).country},get occupation(){return u(Q).occupation}})});var _=y(W,2),U=b(_),K=y(b(U),2),Y=y(b(K),2),X=y(Y,2),ne=y(b(X),2),D=b(ne);D.value=D.__value="";var V=y(D);{var se=F=>{var Q=nr(),_e=Re(Q);Me(_e,17,()=>u(o),$e,(De,be)=>{var Ae=Vf(),Ye=b(Ae),Ce={};fe(()=>{re(Ye,`${u(be).emoji??""} ${u(be).name??""}`),Ce!==(Ce=u(be).short)&&(Ae.value=(Ae.__value=u(be).short)??"")}),N(De,Ae)}),N(F,Q)};ve(V,F=>{u(o)&&F(se)})}var ie=y(X,2);{var oe=F=>{var Q=Kf(),_e=y(b(Q),2),De=b(_e);De.value=De.__value="";var be=y(De);Me(be,17,()=>u(P),$e,(Ae,Ye)=>{var Ce=Wf(),Yt=b(Ce),kt={};fe(()=>{re(Yt,u(Ye).name),kt!==(kt=u(Ye).codes)&&(Ce.value=(Ce.__value=u(Ye).codes)??"")}),N(Ae,Ce)}),at(_e,()=>u(g),Ae=>m(g,Ae)),N(F,Q)};ve(ie,F=>{u(i).length>1&&F(oe)})}var ue=y(ie,2),Te=y(b(ue),2),he=b(Te);he.value=he.__value="";var je=y(he);{var We=F=>{var Q=nr(),_e=Re(Q);Me(_e,17,()=>h,$e,(De,be,Ae,Ye)=>{var Ce=Hf(),Yt=b(Ce),kt={};fe(()=>{re(Yt,u(be)),kt!==(kt=u(be))&&(Ce.value=(Ce.__value=u(be))??"")}),N(De,Ce)}),N(F,Q)};ve(je,F=>{h&&F(We)})}var qe=y(ue,2),Ge=y(b(qe),2),Je=b(Ge);Je.value=Je.__value="";var Fe=y(Je);{var te=F=>{var Q=nr(),_e=Re(Q);Me(_e,17,()=>p,$e,(De,be,Ae,Ye)=>{var Ce=Gf(),Yt=b(Ce),kt={};fe(()=>{re(Yt,u(be)),kt!==(kt=u(be))&&(Ce.value=(Ce.__value=u(be))??"")}),N(De,Ce)}),N(F,Q)};ve(Fe,F=>{p&&F(te)})}var pe=y(qe,2);ar(pe,{get type(){return u(v)},get message(){return u(k)}});var we=y(K,2);we.__click=()=>u(l).close(),zt(_,F=>m(l,F),()=>u(l)),lt("submit",K,F=>{F.preventDefault(),A(u(s),u(n),u(a),u(f),u(M))}),Rt(Y,()=>u(s),F=>m(s,F)),at(ne,()=>u(i),F=>m(i,F)),at(Te,()=>u(a),F=>m(a,F)),at(Ge,()=>u(n),F=>m(n,F)),N(t,G),Le()}Fr(["click"]);var Zf=z('<p class="ai-word svelte-1g4eeoh"> </p>'),Xf=z('<div class="message ai-sent svelte-1g4eeoh"></div>'),Qf=z('<div class="message user-sent svelte-1g4eeoh"> </div>'),ev=z("<!> <!>",1),tv=z('<span class="deck-label svelte-1g4eeoh">Deck: <b> </b></span>'),rv=z('<div class="chat-container svelte-1g4eeoh"><section class="header-messages-container svelte-1g4eeoh"><span class="chat-header svelte-1g4eeoh"><span class="pfp-name-container svelte-1g4eeoh"><img class="character-header-image svelte-1g4eeoh"/> <h3 class="svelte-1g4eeoh"> </h3> <p> </p> <p class="trait-tag svelte-1g4eeoh"> </p></span> <button class="ai-analysis-btn svelte-1g4eeoh">Get AI analysis of chat</button></span> <button class="test-deck-btn svelte-1g4eeoh">Get tested on a deck</button> <div class="messages-container svelte-1g4eeoh"></div></section> <div class="input-deck-label-container svelte-1g4eeoh"><!> <span class="send-container svelte-1g4eeoh"><input class="send-message-input svelte-1g4eeoh"/> <button class="send-message-btn svelte-1g4eeoh"><span class="material-symbols-rounded">send</span></button></span></div></div>'),sv=z('<span class="sentence-container svelte-1g4eeoh"><span class="corrected_sentence_label_container svelte-1g4eeoh">ð <p class="original_sentence_label svelte-1g4eeoh">Original sentence:</p></span> <p class="original_sentence svelte-1g4eeoh"> </p></span> <span class="sentence-container svelte-1g4eeoh"><span class="corrected_sentence_label_container svelte-1g4eeoh">â <p class="corrected_sentence_label svelte-1g4eeoh">Corrected sentence:</p></span> <p class="corrected_sentence svelte-1g4eeoh"> </p></span>',1),nv=z('<span class="analysis-character-container svelte-1g4eeoh"><img class="analysis-image svelte-1g4eeoh"/> <h1 class="analysis-header svelte-1g4eeoh"> </h1></span> <div class="stats-container svelte-1g4eeoh"><div class="ai-chat-analysis-container svelte-1g4eeoh"><h3 class="ai-chat-analysis-header svelte-1g4eeoh">ð¡ AI Chat Analysis</h3> <p class="ai-chat-analysis svelte-1g4eeoh"> </p></div> <!></div>',1),av=z("<option required> </option>"),iv=z('<main class="route svelte-1g4eeoh"><!> <section class="main-page svelte-1g4eeoh"><h1 class="page-header">AI Chat</h1> <section class="main-content svelte-1g4eeoh"><!> <!> <!></section></section></main> <dialog class="svelte-1g4eeoh"><div class="dialog-container svelte-1g4eeoh"><h2 class="dialog-header svelte-1g4eeoh">Select deck to be tested on:</h2> <form class="svelte-1g4eeoh"><select class="deck-select svelte-1g4eeoh"></select> <span class="deck-buttons-container svelte-1g4eeoh"><input type="Submit" class="submit-deck-btn svelte-1g4eeoh"/> <button class="close-deck-btn svelte-1g4eeoh">Close</button></span></form></div></dialog>',1);function ov(t,e){Ue(e,!0);const r=()=>ms(ys,"$location",s),[s,n]=_s();let a=H(r().split("/").pop()),i=T(H(Object)),o=T(""),l=T(H([])),c=H([]),h=T(""),p=HTMLObjectElement,d=T(H(p.messagesContainer)),f=T(H(p.dialogBox)),g=T(void 0),w="",v=T(H(w.term)),k=T(H(w.definition)),R=T(H(w.partOfSpeech)),O=T(H(w.romanisation)),E=T("");ft(async()=>{await A()}),Oe(async()=>{const{data:D,error:V}=await me.from("ai_characters").select("*").eq("id",a).single();V&&console.error(V),D&&m(i,D,!0)});async function A(){const{data:D,error:V}=await me.auth.getSession(),se=D;V?console.error("Error fetching session:",V):se&&m(E,se.session.user.id,!0),V&&console.error("Error fetching username:",V)}async function x(D,V){let se="";V.push({sender:"User",content:D}),u(l)!=[]?(print(u(l)),se=`You are an AI chatbot for a language learning app. 
                your name is ${u(i).name} - but you dont need to append that before your response
        Give short and simple responses and only respond in ISO CODE ${u(i).language} 
        Your job is a ${u(i).occupation} Even if the user gets something wrong, try to interperet it and don't give corrections 
        Base all your response lightly on the selected flashcard deck as the user selected the deck for you, the AI character to test me on. You dont need all words in one response. You can see which words you've used and haven't in chat history. Take it slow and but the words in at any order but they must make sense in context
        only respond in ISO ${u(i).language}
        your personality is ${u(i).trait} for character engagement reasons.
        Here is the deck content:
        ${u(l)[u(g)]}
        Here is the user response: 
        ${D}. 
        Here is the chat history:
       ${V.map(ue=>`SENT BY ${ue.sender}: ${ue.content}`)}`):se=`You are an AI chatbot for a language learning app. 
        your name is ${u(i).name} - but you dont need to append that before your response
        Give short and simple responses and only respond in ISO ${u(i).language} and and your personality is very exaggerated ${u(i).trait} . 
        Your job is a ${u(i).occupation} Even if the user gets something wrong, try to interperet it and don't give corrections 
        only respond in ISO ${u(i).language}
        Here is the user response: 
        ${D}. 
        Here is the chat history:
        ${V.map(ue=>`SENT BY ${ue.sender}: ${ue.content}`)}`,console.log(se);const ie=await fetch(`https://text.pollinations.ai/prompt/${se}`);ie.ok||console.error("AI API error:",ie.statusText);const oe=await ie.text();V.push({sender:"AI",content:oe}),console.log("AI Response:",oe)}async function j(){const D=`
    You are an AI for a language learning app. The user and AI are having a conversation in ${u(i).language}. The user's messages are marked with "User :". Your task is to return a pure JSON object as your response will be directly parsed into JSON and use no markdown annotates and the response has two fields:

    1. "analysis" â A strict critique in English aimed at helping the user improve. Also if flashcards deck is valid it means teh user wants to use or see all those deck words. So take that into your anaylisis account - pw well did they respond or did they use any flashcard words?
    2. "mistakes" â An array of objects. Each object must include:

    {
    "original_sentence": <user sentence>,
    "corrected_sentence": <correct version, even if its the same as original if no issues found>
    }

    â ï¸ Include **every single sentence** spoken by the user â even if it's 100% correct â so we can evaluate all usage. Do not skip or omit any. Assume all are full sentences. Do not return markdown, just raw JSON.

    Here is the deck content:
    ${u(l)[u(g)]}
    Conversation:
    ${c.map(oe=>`SENT BY ${oe.sender}: ${oe.content}`)}`,V=encodeURIComponent(D);console.log(D);const ie=await(await fetch(`https://text.pollinations.ai/prompt/${V}`)).json();m(h,ie,!0),console.log(u(h))}async function I(){if(!u(l)){const{data:D,error:V}=await me.from("flashcards").select("*").eq("author",u(E)).eq("language",u(i).language);V&&console.error("Error fetching flashcard decks:",V),D?m(l,D,!0):m(l,[],!0),console.log(u(l))}}function P(){u(f).close()}async function M(D,V){let se=V;Array.isArray(V)&&(se=V.join(" "));const ie=`you are being used as an AI to give a definition of a word based of context for a language learning software the language of the word and context is ISO code ${u(i).language} and the user's native language is english the word is ${D} and the context is ${se} so give your definition in ENGLISH and as part of your just definition NOT the partOfSpeech add helpful notes such as if its plural and its singular or its case/tense and its infintive etc. but keep it simple and short return as raw json with no backtick MD markers as your respone will be directly parsed into json respond with attributes word, partOfSpeech, romanisation and definition but do NOT return romanisation where it is not necessary`,oe=await fetch(`https://text.pollinations.ai/${ie}`),ue=await oe.json();console.log(oe),m(v,ue.word,!0),m(k,ue.definition,!0),m(R,ue.partOfSpeech,!0),m(O,ue.romanisation,!0)}var G=iv(),W=Re(G),$=b(W);Jt($,{currentPage:"/ai-chat"});var L=y($,2),q=y(b(L),2),J=b(q);{var ae=D=>{var V=rv(),se=b(V),ie=b(se),oe=b(ie),ue=b(oe),Te=y(ue,2),he=b(Te),je=y(Te,2),We=b(je),qe=y(je,2),Ge=b(qe),Je=y(oe,2);Je.__click=async()=>await j();var Fe=y(ie,2);Fe.__click=()=>{u(f).showModal(),I()};var te=y(Fe,2);Me(te,21,()=>c,$e,(be,Ae)=>{var Ye=ev(),Ce=Re(Ye);{var Yt=wr=>{var bs=Xf();Me(bs,21,()=>u(Ae).content.split(" "),$e,(xn,Ma)=>{var Rn=Zf();Rn.__click=()=>M(u(Ma),u(Ae));var Yo=b(Rn);fe(()=>re(Yo,u(Ma))),N(xn,Rn)}),N(wr,bs)};ve(Ce,wr=>{u(Ae).sender==="AI"&&wr(Yt)})}var kt=y(Ce,2);{var Jo=wr=>{var bs=Qf(),xn=b(bs);fe(()=>re(xn,u(Ae).content)),N(wr,bs)};ve(kt,wr=>{u(Ae).sender==="User"&&wr(Jo)})}N(be,Ye)}),zt(te,be=>m(d,be),()=>u(d));var pe=y(se,2),we=b(pe);{var F=be=>{var Ae=tv(),Ye=y(b(Ae)),Ce=b(Ye);fe(()=>re(Ce,u(l)[u(g)].name)),N(be,Ae)};ve(we,be=>{(u(g)||u(g)===0)&&be(F)})}var Q=y(we,2),_e=b(Q),De=y(_e,2);De.__click=()=>x(u(o),c),fe(()=>{He(ue,"src",u(i).image),He(ue,"alt",`Image of charater ${u(i).name}`),re(he,u(i).name),re(We,u(i).occupation),re(Ge,u(i).trait)}),Rt(_e,()=>u(o),be=>m(o,be)),N(D,V)};ve(J,D=>{u(h)||D(ae)})}var B=y(J,2);Ho(B,{get word(){return u(v)},get definition(){return u(k)},get partOfSpeech(){return u(R)},get romanisation(){return u(O)},get language(){return u(i).language}});var Z=y(B,2);{var S=D=>{var V=nv(),se=Re(V),ie=b(se),oe=y(ie,2),ue=b(oe),Te=y(se,2),he=b(Te),je=y(b(he),2),We=b(je),qe=y(he,2);Me(qe,17,()=>u(h).mistakes,$e,(Ge,Je)=>{var Fe=sv(),te=Re(Fe),pe=y(b(te),2),we=b(pe),F=y(te,2),Q=y(b(F),2),_e=b(Q);fe(()=>{re(we,u(Je).original_sentence),re(_e,u(Je).corrected_sentence)}),N(Ge,Fe)}),fe(()=>{He(ie,"src",u(i).image),He(ie,"alt",u(i).name),re(ue,u(i).name),re(We,u(h).analysis)}),N(D,V)};ve(Z,D=>{u(h)&&D(S)})}var _=y(W,2),U=b(_),K=y(b(U),2),Y=b(K);Me(Y,21,()=>u(l),$e,(D,V,se)=>{var ie=av(),oe=b(ie);ie.value=ie.__value=se,fe(()=>re(oe,u(V).name)),N(D,ie)});var X=y(Y,2),ne=y(b(X),2);ne.__click=()=>u(f).close(),zt(_,D=>m(f,D),()=>u(f)),lt("submit",K,D=>{D.preventDefault(),P()}),at(Y,()=>u(g),D=>m(g,D)),N(t,G),Le(),n()}Fr(["click"]);var lv=Sa(z('<script src="https://www.youtube.com/iframe_api" class="svelte-1krhhra"><\/script><!>',1)),cv=z(`<main class="svelte-1krhhra"><section class="page-1 page svelte-1krhhra"><div class="media-scroller svelte-1krhhra"><div class="media-list svelte-1krhhra"><span class="media-box music-media-box svelte-1krhhra"><span class="emoji music-emoji svelte-1krhhra">ð§</span> Music</span> <span class="media-box videos-media-box svelte-1krhhra"><span class="emoji videos-emoji svelte-1krhhra">ð¹</span> Videos</span> <span class="media-box flashcards-media-box svelte-1krhhra"><span class="emoji flashcards-emoji svelte-1krhhra">ðï¸</span> Flashcards</span> <span class="media-box ai-chats-media-box svelte-1krhhra"><span class="emoji ai-chats-emoji svelte-1krhhra">ð¬</span> AI Chats</span> <span class="media-box music-media-box svelte-1krhhra"><span class="emoji music-emoji svelte-1krhhra">ð§</span> Music</span> <span class="media-box videos-media-box svelte-1krhhra"><span class="emoji videos-emoji svelte-1krhhra">ð¹</span> Videos</span> <span class="media-box flashcards-media-box svelte-1krhhra"><span class="emoji flashcards-emoji svelte-1krhhra">ðï¸</span> Flashcards</span> <span class="media-box ai-chats-media-box svelte-1krhhra"><span class="emoji ai-chats-emoji svelte-1krhhra">ð¬</span> AI Chats</span></div></div> <section class="hero-1 svelte-1krhhra"><h1 class="welcome svelte-1krhhra">Welcome to Loquelis!!!</h1> <p class="welcome-message svelte-1krhhra">ð¤ Happy to see you!</p></section> <button class="get-started-btn svelte-1krhhra"><a href="./#/app/signup/" class="svelte-1krhhra">Let's get started! â</a></button></section> <section class="page-2 page svelte-1krhhra"><h1 class="svelte-1krhhra">Let's get started with a language-learning favourite - Peppa Pig! ð·</h1> <span class="video-info-box info-box svelte-1krhhra"><p class="icon svelte-1krhhra">ð¡</p>Click on a word for a definition based off context, part of speech and romanisation.</span> <span class="video-info-box info-box svelte-1krhhra"><p class="icon svelte-1krhhra">ð</p>Play the video and watch the live subtitles flow through!</span> <section class="video-container svelte-1krhhra"><iframe id="player" frameborder="0" allowfullscreen="" class="svelte-1krhhra"></iframe> <!></section></section> <hr class="svelte-1krhhra"/> <section class="page-3 page svelte-1krhhra"><h2 class="svelte-1krhhra">Learn with user curated/ custom:</h2> <div class="media-container svelte-1krhhra"><span class="media-box music-media-box svelte-1krhhra"><span class="emoji music-emoji svelte-1krhhra">ð§</span> Music</span> <span class="media-box videos-media-box svelte-1krhhra"><span class="emoji videos-emoji svelte-1krhhra">ð¹</span> Videos</span> <span class="media-box flashcards-media-box svelte-1krhhra"><span class="emoji flashcards-emoji svelte-1krhhra">ðï¸</span> Flashcards</span> <span class="media-box ai-chats-media-box svelte-1krhhra"><span class="emoji ai-chats-emoji svelte-1krhhra">ð¬</span> AI Chats</span></div></section> <hr class="svelte-1krhhra"/> <section class="page-4 page svelte-1krhhra"><h1 class="media-header svelte-1krhhra">ð§ Music</h1> <p class="media-p svelte-1krhhra">Learn through user curated music options and immerse yourself in the culture of the region of your chosen language</p> <div class="media-image-container svelte-1krhhra"><img src="https://upload.wikimedia.org/wikipedia/en/b/bc/Molchat_Doma_-_Etazhi.png" alt="Molchat Doma music" class="media-img svelte-1krhhra"/> <img src="https://upload.wikimedia.org/wikipedia/en/4/40/99_Luftballons_single_cover.jpg" alt="99 Luftballons Music" class="media-img svelte-1krhhra"/> <img src="https://upload.wikimedia.org/wikipedia/en/f/fa/RammsteinRadioSingleCover.jpg" alt="Rammstein Music" class="media-img svelte-1krhhra"/> <img src="https://upload.wikimedia.org/wikipedia/en/2/20/Fortuna_Wheel.jpg" alt="Rammstein Music" class="media-img svelte-1krhhra"/></div> <hr class="svelte-1krhhra"/> <h1 class="media-header svelte-1krhhra">ð¹ Video</h1> <p class="media-p svelte-1krhhra">Learn through user curated video options and finally switch from textbooks to shows, documentaries, news and YouTubers</p> <div class="media-image-container svelte-1krhhra"><img src="https://i.ytimg.com/vi/WYqIlqp2_9c/sddefault.jpg" alt="coca cola documentary in german" class="vid-media-img media-img svelte-1krhhra"/> <img src="https://i.ytimg.com/vi/_fPXQnfCWqI/sddefault.jpg" class="vid-media-img media-img svelte-1krhhra" alt="french news"/> <img src="https://i.ytimg.com/vi/ZzfeHWgEVDs/sddefault.jpg" alt="vlog video" class="vid-media-img media-img svelte-1krhhra"/></div> <hr class="svelte-1krhhra"/> <h1 class="media-header svelte-1krhhra">ðï¸ Flashcards</h1> <p class="media-p svelte-1krhhra">Create your own decks from words saved from songs, videos and AI Chats</p> <div class="media-image-container svelte-1krhhra"><img src="https://raw.githubusercontent.com/Ewan-Dev/ewan.is-a.dev/refs/heads/main/frontend/static/food-deck.png" class="deck-media-img media-img svelte-1krhhra" alt="deck"/> <img src="https://raw.githubusercontent.com/Ewan-Dev/ewan.is-a.dev/refs/heads/main/frontend/static/animals-deck.png" alt="deck" class="deck-media-img media-img svelte-1krhhra"/> <img src="https://raw.githubusercontent.com/Ewan-Dev/ewan.is-a.dev/refs/heads/main/frontend/static/flashcards.png" alt="flashcards" class="deck-media-img media-img svelte-1krhhra"/></div> <hr class="svelte-1krhhra"/> <h1 class="media-header svelte-1krhhra">ð¬ AI Chat</h1> <p class="media-p svelte-1krhhra">Create your own AI character to practise your language skills and decks with.</p> <div class="media-image-container svelte-1krhhra"><img src="https://raw.githubusercontent.com/Ewan-Dev/ewan.is-a.dev/refs/heads/main/frontend/static/ai-chat.png" alt="ai chat" class="ai-chat-img media-img svelte-1krhhra"/></div></section> <hr class="svelte-1krhhra"/> <section class="page-5 page svelte-1krhhra"><h1 class="svelte-1krhhra">Start your journey. <p class="blue svelte-1krhhra">Today.</p></h1> <div class="sign-up-contact-container svelte-1krhhra"><button class="big-get-started-btn svelte-1krhhra"><a href="./#/app/signup/" class="svelte-1krhhra">Get started! â</a></button> <button class="big-contact-btn svelte-1krhhra"><span class="material-symbols-rounded svelte-1krhhra">login</span><a href="./#/app/login/" class="contact-p svelte-1krhhra">Sign in</a></button></div></section></main>`);function uv(t,e){Ue(e,!0);const r=()=>ms(ys,"$location",s),[s,n]=_s(),i={events:[{tStartMs:10791,dDurationMs:1508,segs:[{utf8:"Herr Vogelscheuche"}]},{tStartMs:15535,dDurationMs:4067,segs:[{utf8:"Peppa und Schorsch sind heute zu Besuch bei Oma und Opa Wutz."}]},{tStartMs:23350,dDurationMs:1641,segs:[{utf8:"Hallo Opa Wutz."}]},{tStartMs:25960,dDurationMs:3547,segs:[{utf8:"Huhu Hallo Peppa Hallo Schorsch."}]},{tStartMs:29571,dDurationMs:2317,segs:[{utf8:"Opa was machst du denn da?"}]},{tStartMs:31897,dDurationMs:2158,segs:[{utf8:"Ich pflanze einen Blumengarten."}]},{tStartMs:34072,dDurationMs:1579,segs:[{utf8:"Oh!"}]},{tStartMs:35675,dDurationMs:3720,segs:[{utf8:"Aus diesen Samen wachsen wunderschÃ¶ne Blumen."}]},{tStartMs:40090,dDurationMs:3153,segs:[{utf8:"Ich streue die SamenkÃ¶rner auf den Boden."}]},{tStartMs:44163,dDurationMs:2722,segs:[{utf8:"Dann decke ich sie mit Erde zu."}]},{tStartMs:47211,dDurationMs:1841,segs:[{utf8:"Oh wo sind sie denn?"}]},{tStartMs:49110,dDurationMs:1865,segs:[{utf8:"Die SamenkÃ¶rner sind verschwunden."}]},{tStartMs:50999,dDurationMs:4049,segs:[{utf8:`Wie merkwÃ¼rdig! 
Ich bin sicher dass ich hier Samen verstaut hatte.`}]},{tStartMs:55076,dDurationMs:2456,segs:[{utf8:`Ja Opa.
Wir haben es gesehen.`}]},{tStartMs:57932,dDurationMs:1598,segs:[{utf8:`Ja!
Jetzt sind sie weg.`}]},{tStartMs:60167,dDurationMs:3047,segs:[{utf8:"Na gut dann muss ich eben noch welche nehmen."}]},{tStartMs:63522,dDurationMs:4459,segs:[{utf8:"Wie schon sagte, ich treue die SamenkÃ¶rner einfach auf den Boden."}]},{tStartMs:70334,dDurationMs:3534,segs:[{utf8:"Ein kleiner Vogel pickt die SamenkÃ¶rner von Opa Wutz auf."}]},{tStartMs:73960,dDurationMs:765,segs:[{utf8:"Heyy!"}]},{tStartMs:74776,dDurationMs:1962,segs:[{utf8:"Lass meine SamenkÃ¶rner!"}]},{tStartMs:77137,dDurationMs:2561,segs:[{utf8:"Also da sind meine ganzen Samen hin."}]},{tStartMs:79709,dDurationMs:3240,segs:[{utf8:"Im Bauch von dem kleinen Vogel."}]},{tStartMs:83320,dDurationMs:3741,segs:[{utf8:"Und noch zwei kleine VÃ¶gel picken Opa wird SamenkÃ¶rner auf."}]},{tStartMs:87180,dDurationMs:1319,segs:[{utf8:"Oh Guck!"}]},{tStartMs:88507,dDurationMs:1987,segs:[{utf8:"Ah! Weg da Weg da!"}]},{tStartMs:91405,dDurationMs:1666,segs:[{utf8:"Was ist das fÃ¼r ein LÃ¤rm."}]},{tStartMs:93256,dDurationMs:3800,segs:[{utf8:`Oma Wutz!
Die VÃ¶gel picken meine ganzen Blumensamen weg.`}]},{tStartMs:97138,dDurationMs:2397,segs:[{utf8:"Und jetzt werden die VÃ¶gel weg."}]},{tStartMs:99765,dDurationMs:3239,segs:[{utf8:"Wegjagen hat keinen Zweck! Sie kommen einfach wieder."}]},{tStartMs:103020,dDurationMs:959,segs:[{utf8:"Guck!"}]},{tStartMs:104823,dDurationMs:2133,segs:[{utf8:"Wir brauchen eine Vogelscheuche."}]},{tStartMs:106990,dDurationMs:1964,segs:[{utf8:"Was ist eine Vogelscheuche?"}]},{tStartMs:109017,dDurationMs:3719,segs:[{utf8:"Eine Vogelscheuche ist ein Mann aus Stroh der den VÃ¶geln Angst macht."}]},{tStartMs:112761,dDurationMs:2916,segs:[{utf8:"Das ist eine gute Idee Oma Wutz."}]},{tStartMs:115697,dDurationMs:1305,segs:[{utf8:"Ich baue eine."}]},{tStartMs:117038,dDurationMs:1663,segs:[{utf8:"Kommt alle mit."}]},{tStartMs:119901,dDurationMs:6213,segs:[{utf8:"Wiedersehen kleine VÃ¶gel. Wir bauen eine Vogelscheuche."}]},{tStartMs:126387,dDurationMs:2133,segs:[{utf8:"Das ist Opa Wutz Gartenschuppen."}]},{tStartMs:128928,dDurationMs:4022,segs:[{utf8:"Hier drin gibt es eine Menge Sachen um eine Vogelscheuche zu bauen."}]},{tStartMs:133306,dDurationMs:3583,segs:[{utf8:"Zuerst brauchen wir zwei StÃ¶cke und etwas Kordel."}]},{tStartMs:136913,dDurationMs:2023,segs:[{utf8:"Das besorgen wir."}]},{tStartMs:140720,dDurationMs:4139,segs:[{utf8:"Peppa hat zwei StÃ¼cke gefunden Schorsch hat etwas Kordel gefunden."}]},{tStartMs:144900,dDurationMs:1090,segs:[{utf8:"Gut!"}]},{tStartMs:146042,dDurationMs:3400,segs:[{utf8:"Ich binde die StÃ¶cke zusammen. Das wird der KÃ¶rper."}]},{tStartMs:149529,dDurationMs:3666,segs:[{utf8:"Oma Wutz hat etwas Stroh gefunden und einen alten Sack."}]},{tStartMs:153237,dDurationMs:5544,segs:[{utf8:`GroÃartig!
Ich stecke das Stroh in den Sack. Das wird der Kopf.`}]},{tStartMs:158817,dDurationMs:3276,segs:[{utf8:"Jetzt braucht die Vogelscheuche was zum anziehen."}]},{tStartMs:162146,dDurationMs:2129,segs:[{utf8:"Hier ist eine Tasche mit alten Kleidern."}]},{tStartMs:164334,dDurationMs:5122,segs:[{utf8:`Oh!
Schorsch hat ein Kleid gefunden.`}]},{tStartMs:170717,dDurationMs:6222,segs:[{utf8:`Dumber Schorsch!
Herr Vogelscheuche hat doch kein Kleid an.`}]},{tStartMs:177184,dDurationMs:2503,segs:[{utf8:"Peppa hat einen Mantel gefunden."}]},{tStartMs:179918,dDurationMs:1875,segs:[{utf8:"Sehr gut Peppa!"}]},{tStartMs:183037,dDurationMs:1961,segs:[{utf8:"Schorsch hat einen Hut gefunden."}]},{tStartMs:185023,dDurationMs:1709,segs:[{utf8:"Sehr gut Schorsch."}]},{tStartMs:187126,dDurationMs:2881,segs:[{utf8:"Herr Vogelscheuche braucht ein Gesicht."}]},{tStartMs:190015,dDurationMs:1e3,segs:[{utf8:"Das Stimmt."}]},{tStartMs:191285,dDurationMs:2564,segs:[{utf8:"Willst du mit Schorch ein Gesicht fÃ¼r ihn malen."}]},{tStartMs:193911,dDurationMs:2596,segs:[{utf8:"Ja bitte."}]},{tStartMs:196794,dDurationMs:2467,segs:[{utf8:"Schorsch malt die Augen und die Nase."}]},{tStartMs:199643,dDurationMs:2004,segs:[{utf8:"Peppa malt den Mund."}]},{tStartMs:202331,dDurationMs:1949,segs:[{utf8:"Fantastisch!"}]},{tStartMs:204305,dDurationMs:1352,segs:[{utf8:"Herr Vogelscheuche ist fertig."}]},{tStartMs:205689,dDurationMs:1750,segs:[{utf8:"Hurraa"}]},{tStartMs:208970,dDurationMs:2877,segs:[{utf8:"Die kleinen VÃ¶gel suchen nach Opa Wutz Blumensamen."}]},{tStartMs:211985,dDurationMs:2704,segs:[{utf8:`Guck!
Die kleinen VÃ¶gel sind wieder da.`}]},{tStartMs:214706,dDurationMs:1327,segs:[{utf8:"Keine Sorge Peppa."}]},{tStartMs:216041,dDurationMs:2345,segs:[{utf8:"Die Vogelscheuche wird sie feucht."}]},{tStartMs:223868,dDurationMs:1266,segs:[{utf8:"Es funktioniert!"}]},{tStartMs:225194,dDurationMs:2491,segs:[{utf8:"Die Vogelscheuche hat die VÃ¶gel verscheucht."}]},{tStartMs:227757,dDurationMs:1528,segs:[{utf8:"Hurra!"}]},{tStartMs:229296,dDurationMs:726,segs:[{utf8:" Gut!"}]},{tStartMs:230099,dDurationMs:3049,segs:[{utf8:"Jetzt werden meine Blumensamen nicht mehr gefressen."}]},{tStartMs:234964,dDurationMs:4325,segs:[{utf8:"Oh Opa die kleinen VÃ¶gel sehen sehr traurig aus."}]},{tStartMs:239329,dDurationMs:2435,segs:[{utf8:"Ja sie haben sicher Hunger."}]},{tStartMs:241820,dDurationMs:1730,segs:[{utf8:"DafÃ¼r habe ich das hier."}]},{tStartMs:243594,dDurationMs:1951,segs:[{utf8:"Das ist das Oma?"}]},{tStartMs:245561,dDurationMs:1721,segs:[{utf8:"Eine Futterstation."}]},{tStartMs:247307,dDurationMs:5499,segs:[{utf8:"Opa gibst du mir bitte etwas von den Samen."}]},{tStartMs:254689,dDurationMs:3828,segs:[{utf8:"Kommt ihr VÃ¶gelchen. Essen Zeit."}]},{tStartMs:259175,dDurationMs:2599,segs:[{utf8:"Jetzt haben die VÃ¶gel ihre eigenen Samen."}]},{tStartMs:262604,dDurationMs:2274,segs:[{utf8:"Die kleinen VÃ¶gel sind wieder glÃ¼cklich."}]},{tStartMs:264903,dDurationMs:3639,segs:[{utf8:"Peppa ist froh dass Opas Blumensamen nicht gefressen werden."}]},{tStartMs:268644,dDurationMs:8125,segs:[{utf8:"Aber noch vor ist sie dass die kleinen VÃ¶gel auch etwas zu fressen haben."}]}]}.events;console.log(i);let o=T(void 0),l=T(void 0),c=T(void 0),h=T(void 0);H([]);let p,d=T("Peppa Wutz");Oe(()=>{r().split("/").pop()==="welcome"&&(f(),window.YT?g():window.onYouTubeIframeAPIReady=g)});function f(){ws({particleCount:1e3,spread:150,origin:{y:0}})}function g(){p=new YT.Player("player",{events:{onReady:()=>{setInterval(()=>{const q=p.getCurrentTime(),J=Math.round(q*1e3);w(J)},1)}}})}function w(q){let J=0;i.forEach(ae=>{q>ae.tStartMs&&q<i[J+1].tStartMs&&ae.segs.forEach(B=>{u(d)!==B.utf8&&(m(d,B.utf8,!0),console.log(B.utf8))}),J++})}var v=cv();Ea("1krhhra",q=>{var J=lv();y(Re(J)),N(q,J)});var k=y(b(v),2),R=y(b(k),6),O=b(R);He(O,"src","https://www.youtube.com/embed/Q_sqR4aLLu0?enablejsapi=1"),He(O,"title","peppapig");var E=y(O,2);Pa(E,{get currentLine(){return u(d)},targetLanguage:"de"});var A=y(k,4),x=y(b(A),2),j=b(x);j.__click=()=>u(o).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});var I=y(j,2);I.__click=()=>u(l).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});var P=y(I,2);P.__click=()=>u(c).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});var M=y(P,2);M.__click=()=>u(h).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});var G=y(A,4),W=y(b(G),6);zt(W,q=>m(l,q),()=>u(l));var $=y(W,8);zt($,q=>m(c,q),()=>u(c));var L=y($,10);zt(L,q=>m(h,q),()=>u(h)),zt(G,q=>m(o,q),()=>u(o)),N(t,v),Le(),n()}Fr(["click"]);var hv=z('<input placeholder="Ask AI..."/> <button>Send</button> <p> </p>',1);function dv(t,e){Ue(e,!1);let r=mr(""),s=mr("");async function n(){try{const h=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:u(r)})});if(!h.ok){const d=await h.text();throw new Error(`Server returned ${h.status}: ${d}`)}const p=await h.json();m(s,p.text)}catch(h){m(s,"Error: "+h.message)}}Ta();var a=hv(),i=Re(a),o=y(i,2),l=y(o,2),c=b(l);fe(()=>re(c,u(s))),Rt(i,()=>u(r),h=>m(r,h)),lt("click",o,n),N(t,a),Le()}var fv=z('<head><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@400" rel="stylesheet"/></head> <main class="svelte-1n46o8q"><dialog class="svelte-1n46o8q"><form class="svelte-1n46o8q"><label class="username-header svelte-1n46o8q">ð¤ Set a username:</label> <span class="input-container svelte-1n46o8q"><p class="at-symbol svelte-1n46o8q">@</p><input placeholder="username" class="username-input svelte-1n46o8q"/></span> <input type="Submit" class="svelte-1n46o8q"/> <button class="close-button-username svelte-1n46o8q">Close</button> <!></form></dialog> <!></main>',1);function vv(t,e){Ue(e,!0);const r=()=>ms(ys,"$location",s),[s,n]=_s(),a={"/":Ti,"/welcome":uv,"/app/ai-chat/:slug":ov,"/app/ai-chat":Yf,"/app/videos/:slug":Lf,"/app/videos":Mf,"/app/flashcards/:slug":xf,"/app/flashcards":mf,"/app/upload":hf,"/app/music/:slug":nf,"/app/music":Vd,"/app/login":Ti,"/app/login/:slug":Md,"/app/signup":Cd,"/app/home":Td,"/app/aiapi":dv};let i=T(""),o=T(""),l="",c=T(H(l.statusMessage)),h=T(H(l.statusType)),p=T(""),d,f=T(H(r()));ft(()=>{d==null||d.close(),m(f,r(),!0)}),Oe(()=>{m(f,r(),!0)}),Oe(async()=>{console.log(u(f)),await w(),g()});function g(){!u(i)&&u(p)?d==null||d.showModal():d==null||d.close()}async function w(){var q,J;const{data:W,error:$}=await me.auth.getSession(),L=W;if($)console.error("Error fetching session:",$);else if(L){m(p,(J=(q=L==null?void 0:L.session)==null?void 0:q.user)==null?void 0:J.id,!0);const{data:ae,error:B}=await me.from("profiles").select("username").eq("user_id",u(p)).single();ae&&(console.log(ae),m(i,ae.username,!0),console.log("User: ",u(i)))}}async function v(W){if(W){const{error:$}=await me.from("profiles").update({username:W}).eq("user_id",u(p));$?(console.error($.message),m(c,""),m(h,""),$.message.includes("duplicate")&&$.message.includes("username")?(m(c,""),m(h,""),m(c,"Account with username already exists"),m(h,"error")):(m(c,""),m(h,""),m(c,$.message,!0),m(h,"error")),$.message==='Column "username" cannot be modified once set'&&(m(c,""),m(h,""),m(c,"Username already set!"),m(h,"warn"))):(m(c,""),m(h,""),m(c,"success"),m(h,"success"),m(i,W,!0))}else m(c,""),m(h,""),m(c,"No username typed"),m(h,"warn")}var k=fv(),R=y(Re(k),2),O=b(R),E=b(O),A=y(b(E),2),x=y(b(A)),j=y(A,4),I=us(g);j.__click=function(...W){var $;($=u(I))==null||$.apply(this,W)};var P=y(j,2);{var M=W=>{ar(W,{get message(){return u(c)},get type(){return u(h)}})};ve(P,W=>{u(c)&&W(M)})}zt(O,W=>d=W,()=>d);var G=y(O,2);tf(G,{get routes(){return a}}),lt("submit",E,W=>{W.preventDefault(),v(u(o))}),Rt(x,()=>u(o),W=>m(o,W)),N(t,k),Le(),n()}Fr(["click"]);pc(vv,{target:document.getElementById("app")});
